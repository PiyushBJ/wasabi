"use strict";var ctrlModule=angular.module("wasabi.controllers",["config"]),svcModule=angular.module("wasabi.services",["ngResource"]);angular.module("wasabi.directives",["ngCookies"]),ctrlModule.config(["$controllerProvider",function(a){ctrlModule.controllerProvider=a}]),svcModule.config(["$provide",function(a){svcModule.provide=a}]),angular.module("wasabi",["ui.bootstrap","ui.router","wasabi.services","wasabi.controllers","wasabi.directives","angularSpinner","config","ngTagsInput"]).config(["$stateProvider","$urlRouterProvider","USER_ROLES",function(a,b,c){b.when("/","/experiments").when("/#/priorities","/priorities").when("/#/users","/users").otherwise("/"),a.state("signin",{url:"/signin",templateUrl:"views/SignIn.html",controller:"SignInCtrl",data:{authorizedRoles:null}}).state("experiments",{url:"/experiments",templateUrl:"views/ExperimentTable.html",data:{authorizedRoles:[c.user,c.admin]}}).state("experiment",{url:"/experiments/{experimentId}/{readonly}/{openedFromModal}",templateUrl:"views/ExperimentDetails.html",data:{authorizedRoles:[c.user,c.admin]}}).state("priorities",{url:"/priorities/{appname}",templateUrl:"views/PrioritiesTable.html",data:{authorizedRoles:[c.user,c.admin]}}).state("users",{url:"/users",templateUrl:"views/UsersTable.html",data:{authorizedRoles:[c.admin]}}).state("applications",{url:"/applications",templateUrl:"views/ApplicationsTable.html",data:{authorizedRoles:[c.admin]}}).state("plugins",{url:"/plugins",templateUrl:"views/PluginsTable.html",data:{authorizedRoles:[c.admin]}}).state("logs",{url:"/logs/{appname}",templateUrl:"views/LogsTable.html",data:{authorizedRoles:[c.admin]}}).state("pages",{url:"/pages/{appname}",templateUrl:"views/PageManagementTable.html",data:{authorizedRoles:[c.user,c.admin]}}).state("superadmins",{url:"/superadmins",templateUrl:"views/SuperadminsTable.html",data:{authorizedRoles:[c.admin]}}).state("feedbackReader",{url:"/feedbackReader",templateUrl:"views/FeedbackTable.html",data:{authorizedRoles:[c.admin]}}).state("userAccess",{url:"/userAccess/{username}/{appname}/{access}",templateUrl:"views/UserPage.html",controller:"UserCtrl",data:{authorizedRoles:[c.admin]}})}]).config(["$httpProvider","authnType",function(a,b){a.interceptors.push("HttpInterceptor"),"sso"===b&&(a.defaults.withCredentials=!0),a.defaults.useXDomain=!0,delete a.defaults.headers.common["X-Requested-With"]}]).constant("AUTH_EVENTS",{loginSuccess:"auth-login-success",loginFailed:"auth-login-failed",logoutSuccess:"auth-logout-success",sessionTimeout:"auth-session-timeout",notAuthenticated:"auth-not-authenticated",notAuthorized:"auth-not-authorized"}).constant("USER_ROLES",{user:"user",admin:"admin"}).constant("PERMISSIONS",{createPerm:"CREATE",readPerm:"READ",updatePerm:"UPDATE",deletePerm:"DELETE",adminPerm:"ADMIN",superAdminPerm:"SUPERADMIN"}).run(["$rootScope","$state","AUTH_EVENTS","AuthUtilsFactory","ConfigFactory","DialogsFactory","Session","AuthFactory","$stateParams","$window","UtilitiesFactory","StateFactory",function(a,b,c,d,e,f,g,h,i,j,k,l){if(a.plugins||(a.plugins=[]),wasabiUIPlugins&&wasabiUIPlugins.length>0)for(var m=0;m<wasabiUIPlugins.length;m++)a.plugins.push(wasabiUIPlugins[m]),k.loadExternalFile(wasabiUIPlugins[m].ctrl,"script","text/javascript");a.$on("$stateChangeStart",function(e,f){var g=f.data.authorizedRoles;g&&(d.isAuthorized(g)||(e.preventDefault(),d.isAuthenticated()?a.$broadcast(c.notAuthorized):(a.originalPage=f.name,a.originalURI=j.location.hash,a.$broadcast(c.notAuthenticated),b.go("signin"))))}),a.confirmDialog=function(a,b,c,d,e,g){return f.confirmDialog(a,b,c,d,e,g)},a.goToSignin=function(){"sso"===e.authnType()?window.location=e.noAuthRedirect():b.go("signin")},a.keepAlive=function(){"sso"!==e.authnType&&h.verifyToken()},a.multiply100=function(a){return parseFloat((100*a).toFixed(8))}}]);var wasabiUIPlugins=[];!function(a){function b(b){function c(a,b){var c=void 0===b||b;e.addClass("editing"),a.attr("tempTabIndex",a.attr("tabIndex")||0).attr("tabIndex",-1).animate({opacity:.2},300),f.css("opacity",0).animate({left:0,opacity:1},300,function(){}),c&&e.trigger("editStart")}function d(a){g.attr("tabIndex",g.attr("tempTabIndex")).animate({opacity:1},300),f.eq(0).animate({left:60,opacity:0},300),f.eq(1).animate({left:30,opacity:0},300),e.removeClass("editing").trigger(a)}var e=a(b).html('<a href="#" class="dynamicSave" title="Save"><span></span>Save</a><a href="#" class="dynamicCancel" title="Cancel"><span></span>Cancel</a><a href="#" class="dynamicEdit" title="Edit"><span></span>Edit</a>'),f=e.find(".dynamicSave, .dynamicCancel"),g=e.find(".dynamicEdit");return e.on("click","a",function(){var b=a(this);return b.hasClass("dynamicEdit")?c(b):b.hasClass("dynamicCancel")?d("editCancel"):b.hasClass("dynamicSave")&&d("editSave"),!1}),{displayWidgets:c}}a.fn.extend({dynamicEdit:function(){return this.each(function(){a(this).data("dynamicEdit")||a(this).data("dynamicEdit",new b(this))})}})}(jQuery),function(a){var b,c=a(document),d=a("head"),e=null,f=[],g=0,h="id",i="px",j="JColResizer",k="JCLRFlex",l=parseInt,m=Math,n=navigator.userAgent.indexOf("Trident/4.0")>0;try{b=sessionStorage}catch(a){}d.append("<style type='text/css'>  .JColResizer{table-layout:fixed;} .JColResizer td, .JColResizer th{overflow:hidden;padding-left:0!important; padding-right:0!important;}  .JCLRgrips{ height:0px; position:relative;} .JCLRgrip{margin-left:-5px; position:absolute; z-index:5; } .JCLRgrip .JColResizer{position:absolute;background-color:red;filter:alpha(opacity=1);opacity:0;width:10px;height:100%;cursor: e-resize;top:0px} .JCLRLastGrip{position:absolute; width:1px; } .JCLRgripDrag{ border-left:1px dotted black;\t} .JCLRFlex{width:auto!important;}</style>");var o=function(b,c){var d=a(b);if(d.opt=c,d.opt.disable)return p(d);var e=d.id=d.attr(h)||j+g++;d.p=d.opt.postbackSafe,!d.is("table")||f[e]&&!d.opt.partialRefresh||(d.addClass(j).attr(h,e).before('<div class="JCLRgrips"/>'),d.g=[],d.c=[],d.w=d.width(),d.gc=d.prev(),d.f=d.opt.fixed,c.marginLeft&&d.gc.css("marginLeft",c.marginLeft),c.marginRight&&d.gc.css("marginRight",c.marginRight),d.cs=l(n?b.cellSpacing||b.currentStyle.borderSpacing:d.css("border-spacing"))||2,d.b=l(n?b.border||b.currentStyle.borderLeftWidth:d.css("border-left-width"))||1,f[e]=d,q(d))},p=function(a){var b=a.attr(h),a=f[b];a&&a.is("table")&&(a.removeClass(j+" "+k).gc.remove(),delete f[b])},q=function(c){var d=c.find(">thead>tr>th,>thead>tr>td");d.length||(d=c.find(">tbody>tr:first>th,>tr:first>th,>tbody>tr:first>td, >tr:first>td")),d=d.filter(":visible"),c.cg=c.find("col"),c.ln=d.length,c.p&&b&&b[c.id]&&r(c,d),d.each(function(b){var d=a(this),e=a(c.gc.append('<div class="JCLRgrip"></div>')[0].lastChild);e.append(c.opt.gripInnerHtml).append('<div class="'+j+'"></div>'),b==c.ln-1&&(e.addClass("JCLRLastGrip"),c.f&&e.html("")),e.bind("touchstart mousedown",x),e.t=c,e.i=b,e.c=d,d.w=d.width(),c.g.push(e),c.c.push(d),d.width(d.w).removeAttr("width"),e.data(j,{i:b,t:c.attr(h),last:b==c.ln-1})}),c.cg.removeAttr("width"),s(c),c.find("td, th").not(d).not("table th, table td").each(function(){a(this).removeAttr("width")}),c.f||c.removeAttr("width").addClass(k)},r=function(a,c){var d,e,f=0,g=0,h=[];if(c){if(a.cg.removeAttr("width"),a.opt.flush)return void(b[a.id]="");for(d=b[a.id].split(";"),e=d[a.ln+1],!a.f&&e&&a.width(e);g<a.ln;g++)h.push(100*d[g]/d[a.ln]+"%"),c.eq(g).css("width",h[g]);for(g=0;g<a.ln;g++)a.cg.eq(g).css("width",h[g])}else{for(b[a.id]="";g<a.c.length;g++)d=a.c[g].width(),b[a.id]+=d+";",f+=d;b[a.id]+=f,a.f||(b[a.id]+=";"+a.width())}},s=function(a){a.gc.width(a.w);for(var b=0;b<a.ln;b++){var c=a.c[b];a.g[b].css({left:c.offset().left-a.offset().left+c.outerWidth(!1)+a.cs/2+i,height:a.opt.headerOnly?a.c[0].outerHeight(!1):a.outerHeight(!1)})}},t=function(a,b,c){var d=e.x-e.l,f=a.c[b],g=a.c[b+1],h=f.w+d,j=g.w-d;f.width(h+i),a.cg.eq(b).width(h+i),a.f&&(g.width(j+i),a.cg.eq(b+1).width(j+i)),c&&(f.w=h,g.w=a.f?j:g.w)},u=function(b){var c=a.map(b.c,function(a){return a.width()});b.width(b.width()).removeClass(k),a.each(b.c,function(a,b){b.width(c[a]).w=c[a]}),b.addClass(k)},v=function(a){if(e){var b=e.t,c=a.originalEvent.touches,d=c?c[0].pageX:a.pageX,f=d-e.ox+e.l,g=b.opt.minWidth,h=e.i,j=1.5*b.cs+g+b.b,k=h==b.ln-1,l=h?b.g[h-1].position().left+b.cs+g:j,n=b.f?h==b.ln-1?b.w-j:b.g[h+1].position().left-b.cs-g:1/0;if(f=m.max(l,m.min(n,f)),e.x=f,e.css("left",f+i),k){var o=b.c[e.i];e.w=o.w+f-e.l}if(b.opt.liveDrag){k?(o.width(e.w),b.w=b.width()):t(b,h),s(b);var p=b.opt.onDrag;p&&(a.currentTarget=b[0],p(a))}return!1}},w=function(d){if(c.unbind("touchend."+j+" mouseup."+j).unbind("touchmove."+j+" mousemove."+j),a("head :last-child").remove(),e){e.removeClass(e.t.opt.draggingClass);var f=e.t,g=f.opt.onResize,h=e.i,i=h==f.ln-1,k=f.g[h].c;i?(k.width(e.w),k.w=e.w):t(f,h,!0),f.f||u(f),s(f),g&&(d.currentTarget=f[0],g(d)),f.p&&b&&r(f),e=null}},x=function(b){var g=a(this).data(j),h=f[g.t],i=h.g[g.i],k=b.originalEvent.touches;if(i.ox=k?k[0].pageX:b.pageX,i.l=i.position().left,c.bind("touchmove."+j+" mousemove."+j,v).bind("touchend."+j+" mouseup."+j,w),d.append("<style type='text/css'>*{cursor:"+h.opt.dragCursor+"!important}</style>"),i.addClass(h.opt.draggingClass),e=i,h.c[g.i].l)for(var l,m=0;m<h.ln;m++)l=h.c[m],l.l=!1,l.w=l.width();return!1},y=function(){for(b in f){var a,b=f[b],c=0;if(b.removeClass(j),b.f&&b.w!=b.width()){for(b.w=b.width(),a=0;a<b.ln;a++)c+=b.c[a].w;for(a=0;a<b.ln;a++)b.c[a].css("width",m.round(1e3*b.c[a].w/c)/10+"%").l=!0}s(b.addClass(j))}};a(window).bind("resize."+j,y),a.fn.extend({colResizable:function(b){var c={draggingClass:"JCLRgripDrag",gripInnerHtml:"",liveDrag:!1,fixed:!0,minWidth:15,headerOnly:!1,hoverCursor:"e-resize",dragCursor:"e-resize",postbackSafe:!1,flush:!1,marginLeft:null,marginRight:null,disable:!1,partialRefresh:!1,onDrag:null,onResize:null},b=a.extend(c,b);return this.each(function(){o(this,b)})}})}(jQuery),angular.module("wasabi.services").factory("ConfigFactory",["apiHostBaseUrlValue","authnType","noAuthRedirect","ssoLogoutRedirect","apiAuthInfo","downloadBaseUrlValue",function(a,b,c,d,e,f){return{baseUrl:function(){return"DEFAULT"===a?window.location.protocol+"//"+window.location.host+"/api/v1":a},downloadBaseUrl:function(){return"DEFAULT"===f?window.location.protocol+"//"+window.location.host+"/api/v1":f},authnType:function(){return b},noAuthRedirect:function(){return c},ssoLogoutRedirect:function(){return d},apiAuthInfo:function(){return e},loginTimeoutWarningTime:33e5,loginTimeoutTime:36e5,labelStrings:{switchToTextView:"Switch to text view...",switchToFormView:"Switch to form view...",rememberSegmentationViewChoice:"Always show the text view"},newApplicationNamePrompt:"New application...",help:{closeBucket:"<h1>What is Close Bucket?</h1><div>When you close a bucket, we set the bucket allocation percentage of the bucket to ZERO and redistribute the allocation percentage of that bucket proportionally among the other remaining buckets. By doing this, we will make sure no new users are put into this bucket. We still retain existing users that are part of this bucket and return assignments for existing users.</div>",emptyBucket:"<h1>What is Empty Bucket?</h1><div>When you empty a bucket, we set the bucket allocation percentage of the bucket to ZERO and redistribute the allocation percentage of that bucket proportionally among the other remaining buckets. By doing this, we will make sure no new users are put into this bucket. We also make sure all users that are already assigned to this bucket are cleared.  They will be given new assignments the next time they come in.</div>",controlBucket:"<h1>What is a control group?</h1><div>A control group is the bucket that you want your other buckets compared to. Typically, this is your existing experience. If you don't have an existing experience, just pick one as a control group. If you don't pick any bucket as a control group, we will pick the first bucket you add as the control group.</div>",bucketPayload:"<h1>What is a bucket payload?</h1><div>A bucket payload is a piece of text that is returned to the caller with every assignment made to this bucket. It could contain CSS, Javascript code, a URL so you can alter the look and feel for your experiment or redirect the user to a different URL depending on the assignment. This is just a pass through. Whatever information you put in this field will be returned to the caller each time an assignment is made to this bucket.</div>",trophy:"<h1>What does the trophy mean?</h1><div>Trophy next to a bucket means that the bucket is the A/B Test winner.</div>",totalImpressions:"Count of the number of times users were shown a treatment. Logged via the Events API as impressions.",totalActions:"Count of the number of times users took a particular action that you are recording, e.g. clicking on a button, making a purchase, etc. Logged via the Events API as actions.",assignedUsers:"The total number of users who have been assigned to this experiment.",uniqueImpressions:"Count of the number of unique users who were presented a particular treatment. This number is the denominator for calculating action rates and may be lower than Impression Counts if some users saw the treatment more than once.",uniqueActions:"Count of the number of unique users who were took a particular action. This number is the numerator for calculating action rates. This number may be lower than Action Counts if some users took the same action more than once.",samplingPercentage:"The percentage of all users who visit your application that will be assigned to this experiment.",bucketActions:"<h1>What are actions?</h1><div>Of all the users who see an impression of a particular user experience, some subset of those may take one or more actions that you are interested in logging and measuring as metrics for the success of that particular treatment. Each different kind of action gives rise to an action rate (roughly actions divided by impressions, usually restricting to unique users). Measuring these action rates and determining when they differ in a statistically significant way is the object of AB testing.</div>",bucketImpressions:"<h1>What are impressions?</h1><div>Once a user is assigned to a bucket and has been shown the first part of the corresponding user experience or treatment, you record an impression for that user. They become part of the denominator for calculating statistics. This is logically separate from assignment, because in some situations you may assign a user to a bucket before they get to the part of your product where they see the impression of the user experience.</div>",bucketActionRate:"<h1>What is the action rate?</h1><div>The count of the unique users with an action divided by the count of unique users with an impression. E.g. this is usually a click-through rate. If you have defined multiple different action types, the default UI shows only the cumulative action rate (e.g. the numerator is the count of unique users with at least one action of any action type). The individual action rates for each action type are available via the APIs.</div>",bucketImprovement:"<h1>What is improvement?</h1><div>Indicates the improvement (or not) with 95% confidence interval compared to the control bucket. If there is no control bucket specified, then comparisons are made vs. the first bucket in the list.</div>",performanceGraph:"<h1>What is the performance graph?</h1><div>The graph shows the cumulative action rate for each bucket over time. This helps you visualize the relative performance of buckets.</div>",experimentName:"<h1>Experiment Name</h1><div>Unique experiment identifier within the context of an application. Must be unique together with &quot;Application Name.&quot; No spaces allowed.</div>",applicationName:"<h1>Application Name</h1><div>Globally unique application identifier. Must be unique together with &quot;Experiment Name&quot;. No spaces allowed.</div>",samplingRate:"<h1>What is Sampling Percentage?</h1><div>This is the percentage of users for whom an assignment is requested who will be placed into one of the experiment buckets. In most experiments, the sampling % is relatively small, and only a fraction of the user traffic is put into one of the buckets or experiment variations. The rest of the users receive the default experience. Users who are not assigned to a bucket will be given the assignment value “NULL” from the AB Testing service assignment API.</div>",buckets:"<h1>What are buckets?</h1><div>Users going through an experiment are randomly assigned to a bucket (bucket A, bucket B, etc.) which determines which user experience they will be offered. This is often called by other, equivalent names such as variation, treatment, or recipe. For example: Let's say you want to test how a &quot;Blue&quot; button performs compared to a &quot;Green&quot; button. &quot;Blue_button&quot; and &quot;Green_button&quot; will be your buckets.<br/><br/>When you first start your test, and for the first seven days, you will see an icon next to each bucket that indicates the results are inconclusive for that bucket.  That is because you must gather enough data before any predictions can be accurately made regarding which bucket is performing better.<br/><br/>However, after seven days, if you are recording impressions and actions in your experiment, you may see other icons next to the buckets.  If you see a trophy icon, that bucket is performing statistically better than other buckets.  If you see a red X icon next to a bucket, that bucket is performing statistically worse than other buckets.</div>",mutualExclusion:"<h1>What is Mutual Exclusion?</h1><div>Mutually exclusive experiments mean that a user can be assigned to only one of the experiments that are mutually exclusive to each other. For example: If experiment A is mutually exclusive to experiment B, then a user can be part of either A or B but not both.  Setup Mutual Exclusion rules by clicking on the Mutual Exclusion tab. Here you can select the other experiments running in your application which are mutually exclusive. The AB Testing Service will ensure that the same user is not put into mutually exclusive experiments. Click the &quot;Add Experiment&quot; link to start picking experiments.</div>",segmentationRule:'<h1>What is Segmentation?</h1><div>You can give some targeting rules for these experiments. You can choose which segment of users will see this experiment. If you want to target your experiment to a set of users that meet certain criteria, you can define the criteria here. For example, for my experiment I want to target users whose salary is greater than $80,000 and who live in California, my segmentation rule would be: salary > 80000 & state = &quot;CA&quot;.<br/><br/>Rules are constructed from rule segments, e.g., variable-name operator value .  These are represented in the UI by a set of controls that allow you to specify the variable name, the variable type (string, number or boolean), the relational operator (e.g., less than), and the value to compare to.  You may combine multiple rule segments with an "and" or an "or".<br/><br/>When you call the server from your application to assign a user to the test, you need to pass the values that will be used in the rule, for example, in my rule above, you would need to pass a value for "salary" and one for "state".<br/><br/>You can also choose to specify the rule as a string, which will be similar to the example above.<br/><br/>The valid types and operators are:<br/><ul><li><span>String</span><ul><li><span>Equals (=)</span></li><li><span>Does Not Equal (!=)</span></li><li><span>Equals, Same Case (^=)</span></li><li><span>Matches Using Regular Expresion (=~)</span></li><li><span>Does Not Match (!~)</span></li></ul></li><li><span>Number</span><ul><li><span>Equals (=)</span></li><li><span>Does Not Equal (!=)</span></li><li><span>Is Less Than (&lt;)</span></li><li><span>Is Greater Than (&gt;)</span></li><li><span>Is Less Than Or Equal To (&lt;=)</span></li><li><span>Is Greater Than Or Equal To (&gt;=)</span></li></ul></li><li><span>Boolean</span><ul><li><span>Equals (=)</span></li></ul></li></ul></div>',pages:'<h1>Pages</h1><div>The pages feature enables you to make batch assignment calls. What this means is that you can request assignments for your users for more than one experiment at a time.<br/><br/><span style="font-weight: bold;">For example:</span> Let\'s say you have two experiments <span style="font-weight: bold;">exp1</span> and <span style="font-weight: bold;">exp2</span>. Now suppose they have the same Page mentioned on their Pages tab, say <span style="font-weight: bold;">page1</span>.  If you now make a batch assignment call mentioning page1, the system will attempt to assign the user to both exp1 and exp2.<br/><br/> In order to use the Pages feature with batch assignments:<br/><br/><ol><li>On the Pages tab for each experiment you want to batch together, type a page name in the &quot;Add Page&quot; text box. If you already have a page with the same name in that application, you may select it from the list of pages that appears as you type.  If not, we will create it.</li> <li>If the &quot;Allow Assignment&quot; checkbox is checked (it is checked by default), that experiment will be included in the batch call.  If you don\'t want to include the experiment in the batch call, then uncheck the checkbox.</li><li>Now that you have grouped your experiments with Pages, you need to call the batch assignment API to request assignments.  The service will automatically find all the experiments on the page you mentioned in the API call and attempt to assign users to those experiments.</li><li>The batch API call is of the form:  /v1/assignments/applications<br/>/{applicationName}/pages/{pageName}<br/>/users/{userID}</li></ol><br/>Note: You may still explicitly request an assignment for an individual experiment even if it has a Page associated with it.  In order to do so, you use this API:<br/>/v1/assignments/applications<br/>/{applicationName}/experiments<br/>/{experimentLabel}/users/{userID}</div>',status:'<h1>What do the statuses mean?</h1><br/><ul><li><span style="font-weight: bold;">Draft:</span> An experiment which has been created but is not yet running. An experiment collects no data in draft mode and cannot accept incoming assignment or event calls. An experiment in draft mode can still be edited (e.g. you can add more buckets, change bucket allocation percentages, etc.). Most experiment parameters cannot be edited outside of draft mode. The experiment remains in draft mode until it is manually started even if it is past the experiment start date.<br/>&nbsp;</li><li><span style="font-weight: bold;">Running:</span> An experiment moves from draft to running when you press the start button (as long as the current date is past the start date). A running experiment returns assignments when called, and collects event data (impressions and actions).<br/>&nbsp;</li><li><span style="font-weight: bold;">Stopped:</span> A running experiment can be stopped, during which time it continues to return existing assignments for UserIds that have already been assigned, but it does not create any new assignments. It continues to collect event data (impressions and actions) for UserIds that have already been assigned to a bucket. A stopped experiment may be set back to the running state.<br/>&nbsp;</li><li><span style="font-weight: bold;">Terminated:</span> A running or stopped experiment can be terminated either by explicitly pressing the Terminate button, or calling the API, or automatically terminated when the experiment End Date is reached. A terminated experiment cannot be re-started. It may only be archived.<br/>&nbsp;</li><li><span style="font-weight: bold;">Delete:</span> Terminated experiments may be deleted. We archive the experiment when you delete. Archived experiments can have their experiment name re-used. Archived experiments no longer appear in the experiment list UI.</li></ul>',priority:"<h1>What is priority?</h1><div>In setting up an experiment, there are eligibility rules associated with each experiment.  Some experiments have rules which are fairly easy to satisfy (e.g. mobile users only), while others have much more stringent rules (e.g. mobile users between the age of 25-39 in states with no income tax and who have previously used snaptax).  Those experiments with more stringent rules will oftentimes have an issue with getting enough users in the experiments for it to reach the desired level of statistical confidence.  Priority is how we allow the user a way to manage their experiments such that these experiments with more stringent eligibility rules will still be able to acquire enough users to produce meaningful results.<br/><br/>Priority will be considered only during a batch assignment call (Pages API).<br/><br/>In the priority UI, you can change the priority in two ways:<br/>&nbsp;<ol><li>Just type in the number you want in the priority box and the list will re-arrange according to the new priority.<br/>&nbsp;</li><li>Manually drag the row you want to the desired priority location and the priority numbers will be updated automatically.</li></ol><br/>Priority rankings should be used in conjunction with mutual exclusion and Pages, this allows for efficient user assignment management.</div>",rapidExperimentMaxUsers:'<h1>What is a Rapid Experiment?</h1><div>Usually, for an A/B test, you want to have users randomly assigned to buckets and run the test for a period of time to try to get statistically significant results.<br/><br/>However, sometimes you just want to try out a test on a few people.  Rather than picking a certain sampling percentage and trying to monitor the experiment until you have a sufficiently large number of assignments, you can make the experiment a "rapid experiment".  Specify the number of users you want in the experiment and when that number of assignments have been made, the experiment will Stop (meaning users will stop being assigned to the experiment, but users who have been assigned will still receive those assignments).<br/><br/>For a stopped experiment, you can increase the maximum number of users and restart the experiment.  New users will then start being assigned to the experiment, again, until you\'ve reached the newly entered number of users.<br/><br/>If the experiment is a rapid experiment, the target number of users is displayed.  If it is not a rapid experiment, "N/A" (not applicable) is displayed.</div>',actionAnalysis:'<h1>What does the Actions table show?</h1><div>You can use impressions and actions to track the behavior of the users in your test.  Each time you show an experience to your users, related to a bucket, you can record an impression (see the API Calls tab for an example).  When a user performs an activity or reaches an end state that is significant you can record an action which defines "success".  This is also known as a conversion event.  The ratio of the number of users who see a given impression and then perform the associated action is the action rate, which is a measure of the success of that experience.<br/><br/>The simplest way to use actions and impressions are to have one impression and one action and to record them for both the test experience(s) and for the control experience.  If you do that, then the overall bucket action rate is a good measure of the success of a given experience.<br/><br/>However, if it is interesting to your test, you can record multiple actions for each bucket while the user is interacting with a given experience.  The event name that you pass to the action API call is completely defined by you.  If you record actions with the same names for each of your test and control buckets, then you perform a comparison of each of the actions for each of the test experiences as compared to your control experience.  This comparison is expressed as the improvement of the action rate for a given action and bucket versus the same action and the control bucket.<br/><br/>The performance of each action for each bucket, as compared to the same action for the control bucket, is shown in the table.  If the improvement of one of your buckets is statistically significant, as compared to the performance of the same action for the control bucket, the action rate and improvement for that action will be highlighted in green.  If the control bucket is performing better for that action, then the test buckets will be highlighted in red.<br/><br/>One thing to note about actions and this table are that actions only appear in the table once they have been recorded by a user.  That is, until your code has actually called the API to record a given action for a user in a given bucket, nothing will show in the row for that action and for that bucket.  And if that action has not been recorded for any bucket, there will not even be a row for that action.  Don\'t be surprised if some of your actions are missing from the table immediately after you start your experiment.</div>',pageManagement:'<h1>What does the Page Management tool do?</h1><div>The "pages" feature of Wasabi allows you to assign a user to a group of experiments in one call.  The Page Management tool allows you to easily determine which experiments are associated with a given page and to easily add or remove experiments from a page.<br/><br/>A page does not exist without being associated with at least one experiment, so the first step toward managing a page  is to create the page by associating it with the first experiment.<br/><br/>The next step is to select which application\'s pages you will be managing, since pages are managed within the context of an application. So the next step is to select the application whose pages you want to manage. If you are authorized to administer more than one application within Wasabi, you must select the application in which you are interested from a menu of all those applications.  If you are only authorized to administer one application, you will see that application displayed at the top of the Page Management screen.</div>',pageManagementSelectPage:"<h1>Select the page to manage</h1><div>Once you have selected the application in which you are interested, the Step 1 list will populate with a list of the pages associated with any experiments within that application.  You can manage the experiments associated with that page by selecting the page in the list.  This will populate the Step 2 list.</div>",pageManagementManagePage:'<h1>Manage your page</h1><div>Once you have selected the page that you wish to manage in Step 1, the Step 2 list will populate with the names of the experiments that are currently associated with that page.  These are the experiments that a user will be assigned to if you call the pages API (sometimes called the "batch API") for that page.  You can add experiments to the page or remove them from the page:<br/><br/>In order to add an experiment to a page:<br/><br/> <ol><li>Click on the "plus" button below the Step 2 list</li><li>You will be presented with a dialog containing the list of experiments in this application that are not currently associated with this page</li><li>Select the experiment(s) that you want to add to the page and click Add</li></ol><br/>In order to remove an experiment from a page:<br/><br/> <ol><li>Click on the experiment(s) that you want to remove from the page</li><li>Click on the "minus" button below the Step 2 list</li><li>You will be prompted to confirm that you want to remove those experiments from the page</li><li>Click on Remove Experiments to remove them from the page</li></ol></div>'}}}]);var myRegExp=function(a){var b=new RegExp(a);return b};angular.module("mocks",["ngMockE2E","wasabi.services"]).run(["$httpBackend","ConfigFactory",function(a,b){a.when("GET",/.*/).passThrough(),a.when("POST",/.*/).passThrough(),a.when("PUT",/.*/).passThrough(),a.when("DELETE",/.*/).passThrough()}]);var globalPageSuccessMessageFadeOutTimer=null;angular.module("wasabi.services").factory("UtilitiesFactory",["Session","$state","authnType","AuthFactory","$rootScope","AUTH_EVENTS","PERMISSIONS","USER_ROLES","$filter","AuthzFactory","BucketsFactory","DialogsFactory","ExperimentsFactory","WasabiFactory","$uibModal","$injector","FavoritesFactory","StateFactory","AllTagsFactory","usSpinnerService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){
return{stateImgUrl:function(a){return a?"images/status_"+this.stateName(a.toLowerCase())+".png":""},stateName:function(a){if(!a)return"";var b=a.toLowerCase();return"paused"===b&&(b="stopped"),b},capitalizeFirstLetter:function(a){return a.charAt(0).toUpperCase()+a.toLowerCase().slice(1)},arrayToString:function(a){return a.charAt(0).toUpperCase()+a.toLowerCase().slice(1)},hideAdminTabs:function(b){var c=void 0===b||b;c?(this.hideTopLevelTab("Users"),this.hideTopLevelTab("Applications"),this.hideTopLevelTab("Plugins"),this.hideTopLevelTabMenuChoice("Logs"),this.hideTopLevelTabMenuChoice("Feedback",!0),this.hideTopLevelTabMenuChoice("Superadmins",!0),this.hideTopLevelTab("Tools",!0)):(this.hideTopLevelTab("Users",!1),this.hideTopLevelTab("Applications",!1),this.hideTopLevelTab("Plugins",!1),this.hideTopLevelTabMenuChoice("Logs",!1),this.hideTopLevelTabMenuChoice("Feedback",!a.isSuperadmin),this.hideTopLevelTabMenuChoice("Superadmins",!a.isSuperadmin),this.hideTopLevelTab("Tools",!1))},selectTopLevelTab:function(b,c){this.hasAdmin(this._isTesting===!0?c:a.permissions)?this.hideAdminTabs(!1):(this.hideAdminTabs(),"Users"!==b&&"Applications"!==b||(b="Experiments")),"experiments"!==b.toLowerCase()&&(localStorage.removeItem("wasabiLastSearch"),r.currentExperimentsPage=1,r.currentCardViewPage=1),$(".main li").removeClass("sel"),$(".main li.navLink a:contains("+b+")").closest("li.navLink").addClass("sel"),$("#welcomeMsg").text("Welcome, "+a.userID).css("display","inline")},hideTopLevelTab:function(a,b){var c=void 0===b||b;c?$(".main li.navLink a:contains("+a+")").closest("li.navLink").hide():$(".main li.navLink a:contains("+a+")").closest("li.navLink").show()},hideTopLevelTabMenuChoice:function(a,b){var c=void 0===b||b;c?$(".main li.navLink a:contains("+a+")").closest("li").hide():$(".main li.navLink a:contains("+a+")").closest("li").show()},deselectAllTabs:function(){$(".main li").removeClass("sel")},displayPageError:function(a,b,c){var d=void 0===c||c;return d?(0===$(".pageError").length&&($("body").append('<div class="pageError">        <h2>Alert</h2>        <span></span>        <a href="#" class="closePageError">Close</a><span class="icon"></span>    </div>'),$(".closePageError").on("click",function(){return $(this).parent().fadeOut(120),!1})),$(".pageError h2").text(a),$(".pageError").find("span").eq(0).html(b),void($(".pageError").is(":visible")?$(".pageError").fadeOut(120,function(){$(this).fadeIn(250)}):$(".pageError").fadeIn())):void $(".pageError").hide()},displayPageSuccessMessage:function(a,b,c){var d=void 0===c||c;return d?(0===$(".pageSuccess").length&&($("body").append('<div class="pageSuccess">        <h2>Alert</h2>        <span></span>        <a href="#" class="closePageSuccess">Close</a><span class="icon"></span>    </div>'),$(".closePageSuccess").on("click",function(){return $(this).parent().fadeOut(120),!1})),$("pageSuccess").stop(),null!==globalPageSuccessMessageFadeOutTimer&&clearTimeout(globalPageSuccessMessageFadeOutTimer),$(".pageSuccess h2").text(a),$(".pageSuccess").find("span").eq(0).html(b),$(".pageSuccess").is(":visible")?$(".pageSuccess").fadeOut(120,function(){$(this).fadeIn(250)}):$(".pageSuccess").fadeIn(),void(globalPageSuccessMessageFadeOutTimer=setTimeout(function(){$(".pageSuccess").fadeOut(1500),globalPageSuccessMessageFadeOutTimer=null},6e3))):void $(".pageSuccess").hide()},hideHeading:function(a){a?$("header").hide():$("header").show()},handleGlobalError:function(c,d){switch(c.status){case 400:this.displayPageError("Error: "+c.status,c.data.error.message);break;case 401:a.destroy(),b.go("signin");break;default:var e=")";c.data&&c.data.error&&c.data.error.message&&(e=", message: "+c.data.error.message+")"),this.displayPageError("Error",d+" (code: "+c.status+e)}},extractErrorFromResponse:function(c){var d=null;switch(c.data&&c.data.error&&c.data.error.message&&c.data.error.message.length>0&&(d=c.data.error.message),c.status){case 400:return d.indexOf("unique constraint violation")>=0?"nonUnique":d.indexOf("Invalid rule")>=0||d.indexOf("Invalid condition format")>=0?"invalidRule":"genericSubmitError";case 401:return e.$broadcast(f.notAuthenticated),a.destroy(),b.go("signin"),"unauthenticated";default:return"genericSubmitError"}},failIfTokenExpired:function(g){"sso"!==c&&d.verifyToken().$promise.then(function(){},function(){g&&g.close(),e.$broadcast(f.notAuthenticated),a.destroy(),b.go("signin")})},trackEvent:function(a,b,c,d,f){if(e.plugins){var g=this.getTrackingPlugin(e.plugins);if(g&&g.hasOwnProperty("trackEvent"))try{g.trackEvent(a,b,c,d,f)}catch(a){console.log("Problem with the tracking plugin trackEvent function")}}},doTrackingInit:function(){if(e.plugins){var a=this.getTrackingPlugin(e.plugins);if(a&&a.hasOwnProperty("reset"))try{a.reset()}catch(a){console.log("Problem with the tracking plugin reset function")}}},getTrackingPlugin:function(a){if(a){var b=a.filter(function(a){return a.hasOwnProperty("pluginType")&&"contributeClickTracking"===a.pluginType});if(b&&b.length>0)return b[0]}return null},formatApplicationList:function(a){if(!a||0===a.length)return"";var b="";return a.forEach(function(a){0!==b.length&&(b+=","),b+=a.label}),b},filterAppsForUser:function(a,b){var c=a.map(function(a){return $.extend({},a)}),d=null;return b.forEach(function(a){d=$.map(c,function(b){return b.label===a.label?null:b}),c=d}),c},hasPermission:function(b,c){var d=!1;return!(!a||!a.isSuperadmin)||(a&&a.permissions&&a.permissions.forEach(function(a){a.applicationName===b&&(d=a.permissions.indexOf(c.toUpperCase())>=0)}),d)},hasAdmin:function(a){var b=!1;return a&&a.forEach(function(a){a.hasOwnProperty("permissions")&&a.permissions.forEach(function(a){a.toUpperCase()===g.adminPerm&&(b=!0)})}),b},getAppsWithAnyPermissions:function(){var b=[];return a.permissions instanceof Array?(a.permissions.forEach(function(a){b.push(a.applicationName)}),b.sort(function(a,b){return a.toLowerCase().localeCompare(b.toLowerCase())})):[]},getAdministeredApplications:function(){var b=[];return a&&a.permissions&&a.permissions.forEach(function(a){a.permissions.indexOf(g.adminPerm)>=0&&b.push({label:a.applicationName})}),b.sort(function(a,b){return a.label.toLowerCase().localeCompare(b.label.toLowerCase())}),b},userHasRole:function(a,b){var c=!1;return a.applications&&a.applications.forEach(function(a){"write"===b&&("READWRITE"!==a.role&&"ADMIN"!==a.role||(c=!0)),"admin"===b&&"ADMIN"===a.role&&(c=!0)}),c},userHasRoleForApplication:function(a,b,c){var d=!1;return a.applications&&a.applications.forEach(function(a){a.label===b&&("write"===c&&("READWRITE"!==a.role&&"ADMIN"!==a.role||(d=!0)),"admin"===c&&"ADMIN"===a.role&&(d=!0))}),d},sortByHeadingValue:function(a,b,c){var d=b,e=this;return"admin"===b||"write"===b?d=function(a){return!e.userHasRole(a,b)}:"applications"===b&&(d=function(a){return!e.formatApplicationList(a.applications)}),i("orderBy")(a,d,c)},actionRate:function(a,b){if(!b[a]||isNaN(b[a].jointActionRate.estimate))return 0;var c=100*b[a].jointActionRate.estimate;return Math.round(10*c)/10},actionDiff:function(a,b){if(isNaN(b[a].jointActionRate.estimate))return 0;var c=(b[a].jointActionRate.upperBound-b[a].jointActionRate.lowerBound)/2*100;return Math.round(10*c)/10},actionDiffForCardView:function(a){if(isNaN(a.actionRate))return 0;var b=(a.upperBound-a.lowerBound)/2*100;return Math.round(10*b)/10},improvement:function(a,b){if(b.controlBucketLabel!==a)for(var c in b.statistics.buckets[a].bucketComparisons)if(b.statistics.buckets[a].bucketComparisons[c].otherLabel===b.controlBucketLabel){if(isNaN(b.statistics.buckets[a].bucketComparisons[c].jointActionComparison.actionRateDifference.estimate))return 0;var d=100*b.statistics.buckets[a].bucketComparisons[c].jointActionComparison.actionRateDifference.estimate;return Math.round(10*d)/10}},improvementDiff:function(a,b){if(b.controlBucketLabel!==a)for(var c in b.statistics.buckets[a].bucketComparisons)if(b.statistics.buckets[a].bucketComparisons[c].otherLabel===b.controlBucketLabel){if(isNaN(b.statistics.buckets[a].bucketComparisons[c].jointActionComparison.actionRateDifference.estimate))return 0;var d=100*(b.statistics.buckets[a].bucketComparisons[c].jointActionComparison.actionRateDifference.upperBound-b.statistics.buckets[a].bucketComparisons[c].jointActionComparison.actionRateDifference.lowerBound)/2;return Math.round(10*d)/10}},significance:function(a,b){return $.inArray(a,b.jointProgress.winnersSoFar)!==-1?"winner so far":$.inArray(a,b.jointProgress.losersSoFar)!==-1?"loser so far":"undetermined"},saveFavorite:function(a,b){var c=this;q.create({id:a}).$promise.then(function(d){d&&d.experimentIDs&&(b.favorites=d.experimentIDs),c.trackEvent("saveItemSuccess",{key:"dialog_name",value:"createFavorite"},{key:"experiment_id",value:a})},function(a){c.handleGlobalError(a,"The favorite could not be created.")})},removeFavorite:function(a,b){var c=this;q.delete({id:a}).$promise.then(function(d){d&&d.experimentIDs&&(b.favorites=d.experimentIDs),c.trackEvent("saveItemSuccess",{key:"dialog_name",value:"deleteFavorite"},{key:"experiment_id",value:a})},function(a){c.handleGlobalError(a,"The favorite could not be delete.")})},retrieveFavorites:function(){return q.query()},getBucket:function(a,b){if(b&&b.buckets)for(var c=0;c<b.buckets.length;c++){var d=b.buckets[c];if(d.label===a)return d}return null},getFormattedStartAndEndDates:function(a){var b=moment(a.startTime,["YYYY-MM-DDTHH:mm:ssZ","ddd MMM DD YYYY HH:mm:ss ZZ"]),c=moment(a.endTime,["YYYY-MM-DDTHH:mm:ssZ","ddd MMM DD YYYY HH:mm:ss ZZ"]);a.formattedStart=b,a.formattedEnd=c},rapidExperimentLabel:function(a){return a.isRapidExperiment?a.userCap:"N/A"},determineBucketImprovementClass:function(a){var b=this,c=[];for(var d in a.statistics.buckets){var e=this.getBucket(d,a);e&&(a.statistics.buckets[d].homePageTooltip=e.homePageTooltip),c.push(a.statistics.buckets[d]);for(var f=0;f<a.buckets.length;f++)a.buckets[f].label===d&&(a.statistics.buckets[d].count=a.buckets[f].count)}a.statistics.sortedBuckets=i("orderBy")(c,function(c){return b.actionRate(c.label,a.statistics.buckets)},!0);var g=0,h=-1;if(a.statistics.sortedBucketsActiveOnly=[],a.statistics.sortedBuckets&&a.statistics.sortedBuckets.length>0){for(var j=!1,k=0;k<a.statistics.sortedBuckets.length;k++)if("OPEN"===this.getBucket(a.statistics.sortedBuckets[k].label,a).state&&a.statistics.sortedBucketsActiveOnly.push(a.statistics.sortedBuckets[k]),moment().subtract(7,"days").isAfter(moment(a.startTime,["YYYY-MM-DDTHH:mm:ssZ","ddd MMM DD YYYY HH:mm:ss ZZ"]))){var l=this.significance(a.statistics.sortedBuckets[k].label,a.statistics);"winner so far"===l?(j=!0,a.statistics.buckets[a.statistics.sortedBuckets[k].label].improvementClass="winner",a.statistics.buckets[a.statistics.sortedBuckets[k].label].toolTip="This bucket has shown the best performance of all variations.  Consider switching to this experience.",g+=1,g>1&&(a.statistics.buckets[a.statistics.sortedBuckets[k].label].toolTip=a.statistics.buckets[a.statistics.sortedBuckets[h].label].toolTip="You have multiple buckets that performed best.  Consider a deeper analysis prior to switching to an experience."),h=k):"loser so far"===l?(a.statistics.buckets[a.statistics.sortedBuckets[k].label].improvementClass="loser",a.statistics.buckets[a.statistics.sortedBuckets[k].label].toolTip="This bucket has not shown the best performance of all variations."):(a.statistics.buckets[a.statistics.sortedBuckets[k].label].improvementClass="indeterminate",a.statistics.buckets[a.statistics.sortedBuckets[k].label].toolTip="This bucket's performance is not statistically distinguishable from other variations.")}else a.statistics.buckets[a.statistics.sortedBuckets[k].label].toolTip="There is an insufficient number of users to identify a winning variation.";if(!j)for(var m=0;m<a.statistics.sortedBuckets.length;m++)a.statistics.buckets[a.statistics.sortedBuckets[m].label].improvementClass="no-winner"}},determineCardViewBucketImprovementClass:function(a){a.sortedBuckets=i("orderBy")(a.buckets,function(a){return a.actionRate},!0);var b=0,c=-1;if(a.sortedBuckets&&a.sortedBuckets.length>0){for(var d=!1,e=0;e<a.sortedBuckets.length;e++)if(moment().subtract(7,"days").isAfter(moment(a.startTime,["YYYY-MM-DDTHH:mm:ssZ","ddd MMM DD YYYY HH:mm:ss ZZ"]))){var f="undetermined";a.sortedBuckets[e].winnerSoFar?f="winner so far":a.sortedBuckets[e].loserSoFar&&(f="loser so far"),"winner so far"===f?(d=!0,a.sortedBuckets[e].improvementClass="winner",a.sortedBuckets[e].toolTip="This bucket has shown the best performance of all variations.  Consider switching to this experience.",b+=1,b>1&&(a.sortedBuckets[e].toolTip=a.sortedBuckets[c].toolTip="You have multiple buckets that performed best.  Consider a deeper analysis prior to switching to an experience."),c=e):"loser so far"===f?(a.sortedBuckets[e].improvementClass="loser",a.sortedBuckets[e].toolTip="This bucket has not shown the best performance of all variations."):(a.sortedBuckets[e].improvementClass="indeterminate",a.sortedBuckets[e].toolTip="This bucket's performance is not statistically distinguishable from other variations.")}else a.sortedBuckets[e].toolTip="There is an insufficient number of users to identify a winning variation.";if(!d)for(var g=0;g<a.sortedBuckets.length;g++)a.sortedBuckets[g].improvementClass="no-winner"}},filterNonExpiredExperiments:function(a){return i("filter")(a,function(a){var b=moment(a.endTime,["YYYY-MM-DDTHH:mm:ssZ","ddd MMM DD YYYY HH:mm:ss ZZ"]),c=moment();return"PAUSED"===a.state||"RUNNING"===a.state||!b.isBefore(c)})},ruleValueValidationError:function(a){var b="Enter a valid number";switch(a){case"boolean":b="Enter true or false";break;case"date":b="Enter YYYY-MM-DD";break;case"string":b="Enter a quoted string"}return b},validateRuleChunk:function(a,b){var c=/[0-9]{4}-(0|1)[0-9]-[0-3][0-9]/,d=!1;switch(b){case"number":d=$.isNumeric(a);break;case"boolean":d=a===!0||a===!1||"string"==typeof a&&("true"===a.toLowerCase()||"false"===a.toLowerCase());break;case"date":d=c.test(a);break;case"string":if(a.length>=3&&a[0]===a[a.length-1]&&("'"===a[0]||'"'===a[0])){for(var e=!1,f=1;f<a.length-1;f++)if(a[f]===a[0]){e=!0;break}d=!e}else 2!==a.length||'""'!==a&&"''"!==a||(d=!0)}return{isValid:d,tooltipText:this.ruleValueValidationError(b)}},firstPageEncoded:function(a){return a&&a.pages&&a.pages.length>0?encodeURIComponent(a.pages[0].name):""},getPermissions:function(b,c){var d=this;j.getPermissions({userId:b.username}).$promise.then(function(e){var f=!1,g={userID:b.username,accessToken:b.access_token,tokenType:b.token_type,permissions:e.permissionsList,isSuperadmin:!1};e.permissionsList&&e.permissionsList.length>0&&e.permissionsList[0].permissions.indexOf("SUPERADMIN")>=0&&(f=!0,g.isSuperadmin=!0),f||d.hasAdmin(e.permissionsList)?(g.userRole=h.admin,d.hideAdminTabs(!1)):(g.userRole=h.user,d.hideAdminTabs()),a.create(g),r.currentExperimentsPage=1,r.currentCardViewPage=1,d.checkBooleanSwitch("ShowCardView","CardViewTest",!1,null,function(){c()},function(){c()})},function(){console.log("Problem getting authorization permissions.")})},updatePermissionsAndAppList:function(b){var c=this,d=[];j.getPermissions({userId:a.userID}).$promise.then(function(e){a.update({permissions:e.permissionsList}),d=[],a.permissions.forEach(function(a){c.hasPermission(a.applicationName,g.createPerm)&&d.push(a.applicationName)}),d.length>1&&d.sort(function(a,b){return a.toLowerCase().localeCompare(b.toLowerCase())}),b&&b(d),c.hasAdmin(e.permissionsList)&&(a.update({userRole:h.admin}),c.hideAdminTabs(!1))},function(){console.log("Problem getting authorization permissions.")})},balanceBuckets:function(a,b,c){if(a&&a.length>0){for(var d=0,e=0,f=!1,g=[],h=0,i=this,j=0;j<a.length;j++)"CLOSED"!==a[j].state&&"EMPTY"!==a[j].state&&d++;e=parseFloat((1/d).toFixed(4)),f=1-e*d!==0;for(var m=0;m<a.length;m++)"CLOSED"!==a[m].state&&"EMPTY"!==a[m].state?(g[m]=e,h=m):g[m]=a[m].allocationPercent;if(f){var n=parseFloat((1-e*d).toFixed(4));g[h]+=n}l.confirmDialog("Are you sure you want to change the bucket allocations so they are all the same?","Confirm Bucket Balancing",function(){for(var d=[],e=0;e<g.length;e++)d.push({label:a[e].label,allocationPercent:g[e]}),a[e].allocationPercent=g[e];d.length&&k.updateList({experimentId:b.id,buckets:d}).$promise.then(function(){i.trackEvent("saveItemSuccess",{key:"dialog_name",value:"balanceBucketAssignments"},{key:"experiment_id",value:b.id}),c&&c()},function(a){i.handleGlobalError(a)})},function(){})}return!1},totalBucketAllocation:function(a){var b=0;if(a.experiment.buckets&&a.experiment.buckets.length>0)for(var c=0;c<a.experiment.buckets.length;c++)b+=Math.round(1e4*a.experiment.buckets[c].allocationPercent);return a.bucketTotalsValid=1e4===b,b/1e4},transferMatchingValues:function(a,b,c,d,e){return $.each(a,function(a,f){f[c]=0;for(var g=0;g<b.length;g++)if(f[d]===b[g][e]){f[c]=b[g][c];break}}),a},getControlBucketLabel:function(a,b){for(var c in a)a[c].isControl&&(b.hasControlBucket=!0,b.controlBucketLabel=a[c].label);b.hasControlBucket||(b.controlBucketLabel=a[0].label,a[0].isBaseLine=!0)},convertValuesFromPre:function(a){var b=$("<pre />").html(a);return $.browser={},$.browser.msie=/msie/.test(navigator.userAgent.toLowerCase()),$.browser.mozilla=/firefox/.test(navigator.userAgent.toLowerCase()),$.browser.webkit=/webkit/.test(navigator.userAgent.toLowerCase())||/chrome/.test(navigator.userAgent.toLowerCase()),$.browser.webkit&&b.find("div").replaceWith(function(){return"\n"+this.innerHTML}),$.browser.msie&&b.find("p").replaceWith(function(){return this.innerHTML+"<br>"}),($.browser.mozilla||$.browser.opera||$.browser.msie)&&b.find("br").replaceWith("\n"),$.trim(b.text())},changeState:function(a,b,c){var d="start",e=this,f="Confirm State Change";switch(b.toLowerCase()){case"paused":d="stop";break;case"terminated":d="terminate",f="Permanently Terminate Experiment"}var g="Are you sure you want to "+d+" the experiment "+a.label+"?",h=null;"terminated"===b.toLowerCase()&&(g=null,h='Are you sure you want to <span style="font-weight: bold;">PERMANENTLY TERMINATE</span> the experiment '+a.label+"?"),l.confirmDialog(g,f,function(){m.update({id:a.id,state:b}).$promise.then(function(){e.trackEvent("changeItemStateSuccess",{key:"dialog_name",value:"changeExperimentState"},{key:"experiment_id",value:a.id},{key:"item_id",value:b}),c&&c===Object(c)&&"function"!=typeof c?c.hasOwnProperty(b)&&c[b](a):c()},function(a){e.handleGlobalError(a,"The state of your experiment could not be changed.")})},function(){},null,null,h)},deleteExperiment:function(a,b){var c=this;l.confirmDialog("Delete experiment "+a.applicationName+", "+a.label+"?","Delete Experiment",function(){m.delete({id:a.id}).$promise.then(function(){c.trackEvent("deleteItemSuccess",{key:"dialog_name",value:"deleteExperiment"},{key:"experiment_id",value:a.id}),b()},function(a){c.handleGlobalError(a,"Your experiment could not be deleted.")})})},checkBooleanSwitch:function(b,c,d,e,f,g){a.restore();var h=a.switches;h[b]=d,a.update({switches:h}),n.getAssignment({expName:c,userId:a.userID}).$promise.then(function(c){c&&(c.assignment||null===c.assignment)&&(h[b]=c.assignment===e,a.update({switches:h})),f&&f()},function(){console.log("Problem getting Wasabi switches."),g&&g()})},loadExternalFile:function(a,b,c){var d=document.createElement(b);"link"===b?(d.setAttribute("rel","stylesheet"),d.setAttribute("href",a)):"script"===b&&(d.setAttribute("type",c),d.setAttribute("src",a)),document.getElementsByTagName("head")[0].appendChild(d)},openPluginModal:function(a,b){var c=void 0!==b?b:null,d=o.open({templateUrl:a.templateUrl,controller:a.ctrlName,windowClass:"xxx-dialog",backdrop:"static",resolve:{experiment:function(){return c}}});return d.result.then(function(){}),!1},openResultsModal:function(a,b,c){var d=o.open({templateUrl:"views/ResultsModal.html",controller:"ResultsModalCtrl",windowClass:"xxx-dialog",backdrop:"static",resolve:{experiment:function(){return a},readOnly:function(){return b}}});d.result.then(function(){c&&c()})},createNameList:function(a,b){var c=a[0][b];if(a.length>1)for(var d=1;d<a.length;d++)c+=d===a.length-1?" and ":", ",c+=a[d][b];return c},updateApplicationRoles:function(a,b){var c=this;j.getUserRoles({userId:a}).$promise.then(function(a){if(a){var c=[];return a.forEach(function(a){c.push({label:a.applicationName,role:a.role})}),b&&b(),c}},function(a){c.handleGlobalError(a,"The roles for this user could not be retrieved.")})},displaySuccessWithCacheWarning:function(a,b){var c=b+"  PLEASE NOTE that this change may not be available for assignment calls for up to 5 minutes.";this.displayPageSuccessMessage(a,c)},loadAllTags:function(a,b){var c=this;a.allTags=[],(!b||a.experiment.applicationName&&0!==a.experiment.applicationName.length)&&s.query().$promise.then(function(c){if(c){var d=[];if(b)c.hasOwnProperty(a.experiment.applicationName)&&(d=c[a.experiment.applicationName]);else for(var e in c)if(c.hasOwnProperty(e)&&Array.isArray(c[e]))for(var f=0;f<c[e].length;f++)d.includes(c[e][f])||d.push(c[e][f]);a.allTags=d.sort(function(a,b){return a.toLowerCase().localeCompare(b.toLowerCase())})}},function(a){c.handleGlobalError(a,"The list of all tags could not be retrieved.")})},queryTags:function(a,b){var c=function(a,b){return!b||a.toLowerCase().indexOf(b.toLowerCase())!==-1};return b?i("filter")(b,function(b){return c(b,a)}):[]},transferTags:function(a,b){var c=0;if(a){if(b.experiment&&b.experiment.tags&&b.experiment.tags.length>0)for(b.tags=[],c=0;c<b.experiment.tags.length;c++)b.tags.push({text:b.experiment.tags[c]})}else for(b.experiment.tags=[],c=0;c<b.tags.length;c++)b.experiment.tags.push(b.tags[c].text)},startSpin:function(){t.spin("spinner-1")},stopSpin:function(){t.stop("spinner-1")}}}]),angular.module("wasabi.services").factory("StateFactory",[function(){return{currentExperimentsPage:1,currentCardViewPage:1,currentUsersPage:0,currentUsersInApplicationPage:0}}]),angular.module("wasabi.services").factory("ExperimentsFactory",["$resource","ConfigFactory",function(a,b){return a(b.baseUrl()+"/experiments/:id",{},{query:{method:"GET",params:{perPage:"@perPage",page:"@page",filter:"@filter",sort:"@sort",prefix:"@prefix"},url:b.baseUrl()+"/experiments?page=:page&per_page=:perPage&filter=:filter&sort=:sort&timezone="+(new Date).toString().match(/([-\+][0-9]+)\s/)[1].replace("+","%2B"),transformResponse:function(a){var b=$.parseJSON(a);if(b&&b.error)return b;for(var c=0;c<b.experiments.length;c++)b.experiments[c]||delete b.experiments[c];return b}},getPages:{method:"GET",params:{id:"@id"},url:b.baseUrl()+"/experiments/:id/pages",transformResponse:function(a){var b=$.parseJSON(a).pages;return b},isArray:!0},getTraffic:{method:"GET",params:{id:"@id",start:"@start",end:"@end"},url:b.baseUrl()+"/experiments/:id/assignments/traffic/:start/:end?per_page=-1&timezone="+(new Date).toString().match(/([-\+][0-9]+)\s/)[1].replace("+","%2B"),transformResponse:function(a){var b=$.parseJSON(a);return b}},create:{method:"POST",transformRequest:function(a){return"string"==typeof a?a:JSON.stringify(a)}},savePages:{method:"POST",params:{id:"@id"},url:b.baseUrl()+"/experiments/:id/pages",transformRequest:function(a){return delete a.id,"string"==typeof a?a:JSON.stringify(a)}},createWithNewApplication:{method:"POST",url:b.baseUrl()+"/experiments/?createNewApplication=true",transformRequest:function(a){return delete a.id,"string"==typeof a?a:JSON.stringify(a)}},show:{method:"GET",transformResponse:function(a){return $.parseJSON(a)}},update:{method:"PUT",params:{id:"@id"},transformRequest:function(a){return delete a.id,"string"==typeof a?a:JSON.stringify(a)}},updateWithNewApplication:{method:"PUT",params:{id:"@id"},url:b.baseUrl()+"/experiments/:id/?createNewApplication=true",transformRequest:function(a){return delete a.id,"string"==typeof a?a:JSON.stringify(a)}},delete:{method:"DELETE",params:{id:"@id"}},removePage:{method:"DELETE",params:{id:"@id",pageName:"@pageName"},url:b.baseUrl()+"/experiments/:id/pages/:pageName"}})}]),angular.module("wasabi.services").factory("ExperimentStatisticsFactory",["$resource","ConfigFactory",function(a,b){return a(b.baseUrl()+"/analytics/experiments/:experimentId/statistics",{},{query:{method:"GET",transformResponse:function(a){return $.parseJSON(a)},isArray:!1},cardViewData:{method:"GET",params:{perPage:"@perPage",page:"@page",filter:"@filter",sort:"@sort"},url:b.baseUrl()+"/analytics/experiments?page=:page&per_page=:perPage&filter=:filter&sort=:sort&timezone="+(new Date).toString().match(/([-\+][0-9]+)\s/)[1].replace("+","%2B"),transformResponse:function(a){return $.parseJSON(a)},isArray:!1},dailies:{method:"GET",url:b.baseUrl()+"/analytics/experiments/:experimentId/statistics/dailies",transformResponse:function(a){return $.parseJSON(a)},isArray:!1},dailiesWithRange:{method:"POST",params:{experimentId:"@experimentId"},url:b.baseUrl()+"/analytics/experiments/:experimentId/statistics/dailies",transformRequest:function(a){return delete a.experimentId,"string"==typeof a?a:JSON.stringify(a)}}})}]),angular.module("wasabi.services").factory("BucketsFactory",["$resource","ConfigFactory",function(a,b){return a(b.baseUrl()+"/experiments/:experimentId/buckets/:bucketLabel/:dest/:state",{},{query:{method:"GET",params:{experimentId:"@experimentId"},transformResponse:function(a){return $.parseJSON(a).buckets},isArray:!0},create:{method:"POST",params:{experimentId:"@experimentId"},transformRequest:function(a){return delete a.experimentId,"string"==typeof a?a:JSON.stringify(a)}},show:{method:"GET",params:{experimentId:"@experimentId",bucketLabel:"@bucketLabel"},transformResponse:function(a){return $.parseJSON(a)}},update:{method:"PUT",params:{experimentId:"@experimentId",bucketLabel:"@label"},transformRequest:function(a){return delete a.experimentId,"string"==typeof a?a:JSON.stringify(a)}},updateList:{method:"PUT",params:{experimentId:"@experimentId"},transformRequest:function(a){return delete a.experimentId,"string"==typeof a?a:JSON.stringify(a)}},delete:{method:"DELETE",params:{experimentId:"@experimentId",bucketLabel:"@bucketLabel"}},close:{method:"PUT",params:{experimentId:"@experimentId",bucketLabel:"@label",dest:"state",state:"CLOSED"},transformRequest:function(a){return"string"==typeof a?a:JSON.stringify(a)}},empty:{method:"PUT",params:{experimentId:"@experimentId",bucketLabel:"@label",dest:"state",state:"EMPTY"},transformRequest:function(a){return"string"==typeof a?a:JSON.stringify(a)}}})}]),angular.module("wasabi.services").factory("MutualExclusionsFactory",["$resource","ConfigFactory",function(a,b){return a(b.baseUrl()+"/experiments/:experimentId/exclusions/:exclusionUUID",{},{create:{method:"POST",params:{experimentId:"@experimentId"},transformRequest:function(a){return delete a.experimentId,"string"==typeof a?a:JSON.stringify(a)}},query:{method:"GET",params:{experimentId:"@experimentId",exclusiveFlag:"@exclusiveFlag"},url:b.baseUrl()+"/experiments/:experimentId/exclusions/?showAll=true&exclusive=:exclusiveFlag",transformResponse:function(a){return a&&a.length>0?$.parseJSON(a).experiments:[]},isArray:!0},delete:{method:"DELETE",params:{experimentId1:"@experimentId1",experimentId2:"@experimentId2"},url:b.baseUrl()+"/experiments/exclusions/experiment1/:experimentId1/experiment2/:experimentId2"}})}]),angular.module("wasabi.services").factory("PrioritiesFactory",["$resource","ConfigFactory",function(a,b){return a(b.baseUrl()+"/applications/:applicationName/priorities",{},{query:{method:"GET",params:{applicationName:"@applicationName"},transformResponse:function(a){return $.parseJSON(a).prioritizedExperiments},isArray:!0},create:{method:"POST",transformRequest:function(a){return"string"==typeof a?a:JSON.stringify(a)}},show:{method:"GET",transformResponse:function(a){return $.parseJSON(a)}},update:{method:"PUT",params:{applicationName:"@applicationName"},transformRequest:function(a){return delete a.applicationName,JSON.stringify(a)}},delete:{method:"DELETE",params:{id:"@id"}}})}]),angular.module("wasabi.services").factory("ApplicationsFactory",["$resource","ConfigFactory",function(a,b){return a(b.baseUrl()+"/applications/:appName",{},{query:{method:"GET",transformResponse:function(a){var b=$.parseJSON(a);if(b&&b.error)return b;for(var c=[],d=0;d<b.length;d++)b[d]?c.push({applicationName:b[d]}):delete b[d];return c},isArray:!0},getAdmins:{method:"GET",params:{appName:"@appName"},url:b.baseUrl()+"/applications/:appName/users",transformResponse:function(a){var b=$.parseJSON(a).users;return b},isArray:!0},getPages:{method:"GET",params:{appName:"@appName"},url:b.baseUrl()+"/applications/:appName/pages",transformResponse:function(a){var b=$.parseJSON(a).pages;return b},isArray:!0},getExperiments:{method:"GET",params:{appName:"@appName"},url:b.baseUrl()+"/applications/:appName/experiments",transformResponse:function(a){var b=$.parseJSON(a);return b},isArray:!0},testRule:{method:"POST",params:{appName:"@appName",expName:"@expName"},url:b.baseUrl()+"/assignments/applications/:appName/experiments/:expName/ruletest",transformRequest:function(a){return delete a.appName,delete a.expName,"string"==typeof a?a:JSON.stringify(a)}}})}]),angular.module("wasabi.services").factory("DialogsFactory",["$uibModal",function(a){return{alertDialog:function(b,c,d){var e=a.open({templateUrl:"views/DialogModal.html",controller:"DialogModalCtrl",windowClass:"xxxx-dialog",backdrop:"static",resolve:{options:function(){return{description:b,header:c,okLabel:"Close",okCallback:d}}}});e.result.then(function(){})},confirmDialog:function(b,c,d,e,f,g,h){var i=a.open({templateUrl:"views/DialogModal.html",controller:"DialogModalCtrl",windowClass:"xxxx-dialog",backdrop:"static",resolve:{options:function(){var a={description:b,descriptionWithHTML:h,header:c,okCallback:d,showCancel:!0};return e&&(a.cancelCallback=e),f&&(a.okLabel=f),g&&(a.cancelLabel=g),a}}});return i.result.then(function(){}),i}}}]),angular.module("wasabi.services").factory("HttpInterceptor",["$rootScope","$q","Session","AUTH_EVENTS","$timeout","ConfigFactory",function(a,b,c,d,e,f){return{request:function(b){var g=function(){e.cancel(a.isSetTimeout),a.isSetTimeout=void 0,e.cancel(a.isLogoutTimeout),a.isLogoutTimeout=void 0},h=function(){g(),a.keepAlive()},i=function(){c.destroy(),a.$broadcast(d.notAuthenticated),a.goToSignin(),g()},j=function(){a.timeoutDialog&&a.timeoutDialog.close(),i()},k=function(){a.timeoutDialog=a.confirmDialog("Your login is about to expire.  Would you like to continue working?","Login Expiring",h,i,"Yes","No")};return c.accessToken&&!/\/savefeedback/.test(b.url)?"sso"!==f.authnType()?(b.headers.Authorization=c.tokenType+" "+c.accessToken,(!a.isSetTimeout||b.url&&"http"===b.url.substring(0,4))&&(a.isSetTimeout&&g(),/\/logout$/.test(b.url)||(a.isSetTimeout=e(k,f.loginTimeoutWarningTime),a.isLogoutTimeout=e(j,f.loginTimeoutTime)))):f.apiAuthInfo&&f.apiAuthInfo().length>0&&(b.headers.Authorization=f.apiAuthInfo()):/\/login$/.test(b.url)&&sessionStorage.getItem("wasabiSession")&&("sso"!==f.authnType()?b.headers.Authorization="Basic "+btoa(JSON.parse(sessionStorage.getItem("wasabiSession")).username+":"+JSON.parse(sessionStorage.getItem("wasabiSession")).password):f.apiAuthInfo&&f.apiAuthInfo().length>0&&(b.headers.Authorization=f.apiAuthInfo()),b.data={},sessionStorage.removeItem("wasabiSession")),b},response:function(a){return a&&a.config&&a.config.data&&a.config.data.password&&(a.config.data.password=""),a||b.when(a)}}}]),angular.module("wasabi.services").factory("AuthFactory",["$resource","Session","ConfigFactory",function(a,b,c){return a(c.baseUrl()+"/authentication/login",{},{signIn:{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},timeout:3e4,transformRequest:function(a){return a={grant_type:"client_credentials"},$.param(a)},transformResponse:function(a){return(!a||a.length<=0)&&(a='{"error": true}'),sessionStorage.removeItem("wasabiSession"),$.parseJSON(a)}},verifyToken:{method:"GET",url:c.baseUrl()+"/authentication/verifyToken",transformResponse:function(a){return a&&(a=$.parseJSON(a),a.error&&b.destroy()),a}},signOut:{method:"GET",url:c.baseUrl()+"/authentication/logout"
},checkValidUser:{method:"GET",params:{email:"@email"},url:c.baseUrl()+"/authentication/users/:email",transformResponse:function(a){var b=null;return a&&(b=$.parseJSON(a)),b}}})}]),angular.module("wasabi.services").factory("AuthzFactory",["$resource","Session","ConfigFactory",function(a,b,c){return a(c.baseUrl()+"/authorization",{},{getPermissions:{method:"GET",url:c.baseUrl()+"/authorization/users/:userId/permissions",params:{userId:"@userId"},transformResponse:function(a){return a&&(a=$.parseJSON(a)),a}},getUserRoles:{method:"GET",url:c.baseUrl()+"/authorization/users/:userId/roles",params:{userId:"@userId"},transformResponse:function(a){return a&&(a=$.parseJSON(a).roleList),a},isArray:!0},assignRole:{method:"POST",url:c.baseUrl()+"/authorization/roles",transformRequest:function(a){return"string"==typeof a?a:JSON.stringify(a)}},getUsersForApplication:{method:"GET",params:{appName:"@appName"},url:c.baseUrl()+"/authorization/applications/:appName",transformResponse:function(a){var b=$.parseJSON(a).roleList;return b},isArray:!0},getUsersRoles:{method:"GET",url:c.baseUrl()+"/authorization/applications",transformResponse:function(a){var b=$.parseJSON(a);return b},isArray:!0},deleteRoleForApplication:{method:"DELETE",params:{appName:"@appName",userID:"@userID"},url:c.baseUrl()+"/authorization/applications/:appName/users/:userID/roles"}})}]),angular.module("wasabi.services").factory("AuthUtilsFactory",["Session",function(a){return{isAuthenticated:function(){return a.restore(),!!a.accessToken},isAuthorized:function(b){return angular.isArray(b)||(b=[b]),this.isAuthenticated()&&b.indexOf(a.userRole)!==-1}}}]),angular.module("wasabi.services").factory("ApplicationStatisticsFactory",["$resource","ConfigFactory",function(a,b){return a(b.baseUrl()+"/analytics/experiments/:experimentId/assignments/counts",{},{query:{method:"GET",params:{experimentId:"@experimentId"},transformResponse:function(a){return a?$.parseJSON(a):null},isArray:!1}})}]),angular.module("wasabi.services").factory("TooltipFactory",[function(){return{createAndShowTooltip:function(a,b){if(!a||0===a.length)return null;var c,d,e=0,f=$(b),g=f.offset().left,h=f.offset().top,i=b.offsetHeight,j=b.offsetWidth,k=null;return k=$('<div class="tooltip"><span class="arrow"></span>'+a+"</div>").appendTo($("body")),f.attr("tipwidth")&&k.css("width",f.attr("tipwidth")),f.attr("displayRight")?(c=g+j+6,d=h+i/2-k[0].offsetHeight/2,k.find(".arrow").css({width:5,marginTop:-4,top:"50%",left:-5})):f.attr("displayLeft")?(c=g-k[0].offsetWidth-6,d=h+i/2-k[0].offsetHeight/2,k.find(".arrow").css({width:5,marginTop:-4,top:"50%",right:-5,backgroundPosition:"right 0"})):(c=g+j/2-k[0].offsetWidth/2,d=h+i+6,c<1&&(e=c,c=1),k.find(".arrow").css({height:5,marginLeft:-4+e,left:"50%",top:-5})),k.css({left:c,top:d}).animate({opacity:1},200),k},hideTooltip:function(a){a&&a.length&&(a.remove(),a=null)}}}]),angular.module("wasabi.services").factory("RuleEditFactory",["UtilitiesFactory",function(a){return{types:["boolean","number","string"],placeholders:{boolean:"e.g., true or false",number:"e.g., 10000",string:'e.g., "iphone6"'},stringTypeOperators:[{menuLabel:"equals",stringForm:"=",jsonForm:"equals"},{menuLabel:"does not equal",stringForm:"!=",jsonForm:"notEquals"},{menuLabel:"equals (same case)",stringForm:"^=",jsonForm:"stringEqualsExact"},{menuLabel:"matches (regexp)",stringForm:"=~",jsonForm:"stringMatchesRegEx"},{menuLabel:"does not match",stringForm:"!~",jsonForm:"stringNotMatchesRegEx"}],numberTypeOperators:[{menuLabel:"equals",stringForm:"=",jsonForm:"equals"},{menuLabel:"does not equal",stringForm:"!=",jsonForm:"notEquals"},{menuLabel:"is greater than",stringForm:">",jsonForm:"greaterThan"},{menuLabel:"is less than",stringForm:"<",jsonForm:"lessThan"},{menuLabel:"is greater than or equal to",stringForm:">=",jsonForm:"greaterThanEquals"},{menuLabel:"is less than or equal to",stringForm:"<=",jsonForm:"lessThanEquals"}],booleanTypeOperators:[{menuLabel:"is",stringForm:"=",jsonForm:"equals"}],operators:function(){return{boolean:this.booleanTypeOperators,number:this.numberTypeOperators,string:this.stringTypeOperators}},booleanOperators:[{menuLabel:"and",stringForm:"&",jsonForm:"and"},{menuLabel:"or",stringForm:"|",jsonForm:"or"}],toggleAdvanced:function(a){return a.disableSimple||(a.experiment.rule=this.convertRuleControlsToRuleString(a.rules,a.tabs),null!==a.experiment.rule)?(a.simpleRuleEditing=!a.simpleRuleEditing,a):null},convertRuleControlsToRuleString:function(b,c){function d(a,b){var c=$.grep(b,function(b){return b.menuLabel===a});return c&&c.length>0?c[0].stringForm:""}function e(a,b){for(var c=0;c<a.length;c++)if(a[c].menuLabel===b)return a[c].stringForm;return""}for(var f="",g=0;g<b.length;g++){var h=b[g];if(h.subject&&!($.trim(h.subject).length<=0)||h.value&&!($.trim(h.value).length<=0)){if(!h.subject||$.trim(h.subject).length<=0||"string"==typeof h.value&&(!h.value||$.trim(h.value).length<=0)||0===h.type.length||0===h.operator.length)return a.displayPageError("Incomplete Rule","Some parts of a rule expression are missing."),c[2].active=!0,null;var i=a.validateRuleChunk(h.value,h.type);if(!i.isValid)return a.displayPageError("Invalid Rule Value","The value is invalid for the rule type in the highlighted fields."),c[2].active=!0,null;h.booleanOperator.length>0&&(f+=" "+d(h.booleanOperator,this.booleanOperators));var j=this.stringTypeOperators;switch(h.type){case"number":j=this.numberTypeOperators;break;case"boolean":j=this.booleanTypeOperators}f.length>0&&(f+=" "),f+=h.subject+" "+e(j,h.operator)+" ",f+=h.value}}return f},typeChanged:function(b,c){b.operator=this.operators()[b.type][0].menuLabel;var d=a.validateRuleChunk(b.value,b.type);b.errorMessage=d.tooltipText,c.ruleValue.$setValidity("validRuleValue",d.isValid),c.ruleValue.$setViewValue(c.ruleValue.$viewValue)},addRule:function(a){var b={booleanOperator:"",type:"string",subject:"",operator:"equals",value:"",showDelete:!0,errorMessage:"Enter a quoted string"};a.length>0&&(b.booleanOperator="and"),a.push(b)},removeRule:function(a,b){1===b.length?b[0]={booleanOperator:"",type:"string",subject:"",operator:"equals",value:"",showDelete:!0,errorMessage:"Enter a quoted string"}:(b.splice(a,1),1===b.length&&(b[0].booleanOperator=""))},determineOperandValue:function(a,b){var c={type:void 0,value:void 0};return!b&&a.hasOwnProperty("attribute")?c.value=a.attribute:("boolean"===(typeof a.constant).toLowerCase()?c.type="boolean":"number"===(typeof a.constant).toLowerCase()?c.type="number":c.type="string",c.value=a.constant),c},populateExpression:function(b,c){var d={booleanOperator:"",type:"",subject:"",operator:"equals",value:"",showDelete:!0,errorMessage:"Value not valid for type"},e=this.determineOperandValue(c[b][0],!1),f=this.determineOperandValue(c[b][1],!0);if(["equals","notEquals"].indexOf(b)>=0){d.type=e.type?e.type:f.type;var g=this.numberTypeOperators;"boolean"===d.type?g=this.booleanTypeOperators:"string"===d.type&&(g=this.stringTypeOperators),d.operator=$.grep(g,function(a){return a.jsonForm===b})[0].menuLabel}else["greaterThan","greaterThanEquals","lessThan","lessThanEquals"].indexOf(b)>=0?(d.type="number",d.operator=$.grep(this.numberTypeOperators,function(a){return a.jsonForm===b})[0].menuLabel):["stringEqualsExact","stringMatchesRegEx","stringNotMatchesRegEx","contains","notContains"].indexOf(b)>=0&&(d.type="string",d.operator=$.grep(this.stringTypeOperators,function(a){return a.jsonForm===b})[0].menuLabel);return d.subject=e.value,d.value="string"===d.type?'"'+f.value+'"':f.value,d.errorMessage=a.ruleValueValidationError(d.type),d},getOperator:function(a){var b=null;for(b in a)if(a.hasOwnProperty(b))break;return b},populatePartialRule:function(a,b,c){var d=this.getOperator(a);if("or"===d.toLowerCase()||"and"===d.toLowerCase()){var e=a[d][0],f=a[d][1],g=this.getOperator(e),h=this.getOperator(f);if("or"===h.toLowerCase()||"and"===h.toLowerCase())throw"Bad rule JSON";"or"===g.toLowerCase()||"and"===g.toLowerCase()?(this.populatePartialRule(e,b,c),this.populatePartialRule(f,b,d)):(this.populatePartialRule(e,b,c),this.populatePartialRule(f,b,d))}else{var i=this.populateExpression(d,a);c&&(i.booleanOperator=c),b.push(i)}},populateRuleControlsFromJSON:function(a,b,c){try{var d=jQuery.parseJSON(a);this.populatePartialRule(d,b)}catch(a){c.simpleRuleEditing=!1,c.disableSimple=!0}return c},checkForRule:function(a){return!(a&&a.rule&&a.rule.length>0)}}}]),angular.module("wasabi.services").factory("FeedbackFactory",["$resource","ConfigFactory",function(a,b){return a(b.baseUrl()+"/feedback",{},{sendFeedback:{method:"POST",transformRequest:function(a){return"string"==typeof a?a:JSON.stringify(a)}},getFeedback:{method:"GET",transformResponse:function(a){var b=$.parseJSON(a).feedback;return b},isArray:!0}})}]),angular.module("wasabi.services").factory("LogsFactory",["$resource","ConfigFactory",function(a,b){return a(b.baseUrl()+"/logs/applications/:applicationName?page=:page&per_page=10&filter=:filter&sort=:sort&timezone="+(new Date).toString().match(/([-\+][0-9]+)\s/)[1].replace("+","%2B"),{},{query:{method:"GET",params:{applicationName:"@applicationName",page:"@page",filter:"@filter",sort:"@sort"},transformResponse:function(a){return $.parseJSON(a)}}})}]),angular.module("wasabi.services").factory("EmailFactory",["$resource","ConfigFactory",function(a,b){return a(b.baseUrl()+"/email",{},{sendEmail:{method:"POST",params:{appName:"@appName",userName:"@userName"},url:b.baseUrl()+"/email/applications/:appName/users/:userName",transformRequest:function(a){return delete a.appName,delete a.userName,"string"==typeof a?a:JSON.stringify(a)}}})}]),angular.module("wasabi.services").factory("WasabiFactory",["$resource","Session","ConfigFactory",function(a,b,c){return a(c.baseUrl()+"/assignments/applications/WasabiUI/experiments/:expName/users/:userId",{},{getAssignment:{method:"GET",params:{expName:"@expName",userId:"@userId"},timeout:1500,transformResponse:function(a){return a&&(a=$.parseJSON(a)),a}}})}]),angular.module("wasabi.services").factory("FavoritesFactory",["$resource","ConfigFactory",function(a,b){return a(b.baseUrl()+"/favorites",{},{create:{method:"POST",transformRequest:function(a){return"string"==typeof a?a:JSON.stringify(a)}},query:{method:"GET",transformResponse:function(a){var b=$.parseJSON(a);return b}},delete:{method:"DELETE",url:b.baseUrl()+"/favorites/:id",params:{id:"@id"}}})}]),angular.module("wasabi.services").factory("PagesFactory",["$resource","ConfigFactory",function(a,b){return a(b.baseUrl()+"/applications/:applicationName/pages",{},{query:{method:"GET",params:{applicationName:"@applicationName"},transformResponse:function(a){var b=$.parseJSON(a).pages;return b},isArray:!0},getExperimentsWithPage:{method:"GET",params:{applicationName:"@applicationName",id:"@id"},url:b.baseUrl()+"/applications/:applicationName/pages/:id/experiments",transformResponse:function(a){var b=$.parseJSON(a).experiments;return b},isArray:!0}})}]),angular.module("wasabi.services").factory("SuperadminsFactory",["$resource","ConfigFactory",function(a,b){return a(b.baseUrl()+"/authorization/superadmins/:id",{},{create:{method:"POST",params:{id:"@id"}},query:{method:"GET",transformResponse:function(a){var b=$.parseJSON(a);return b},isArray:!0},delete:{method:"DELETE",params:{id:"@id"}}})}]),angular.module("wasabi.services").factory("AllTagsFactory",["$resource","ConfigFactory",function(a,b){return a(b.baseUrl()+"/applications/tags",{},{query:{method:"GET",transformResponse:function(a){if(a){var b=$.parseJSON(a);return b}return{}}}})}]),angular.module("wasabi.services").factory("Session",[function(){return this.create=function(a){this.userID=a.userID,this.accessToken=a.accessToken,this.tokenType=a.tokenType,this.userRole=a.userRole,this.isSuperadmin=a.isSuperadmin,this.permissions=a.permissions,a.switches?this.switches=a.switches:this.switches=a.switches={},sessionStorage.setItem("session",JSON.stringify(a))},this.update=function(a){var b=JSON.parse(sessionStorage.getItem("session"));if(b){for(var c in a)a.hasOwnProperty(c)&&(this[c]=b[c]=a[c]);sessionStorage.setItem("session",JSON.stringify(b))}},this.destroy=function(){this.userID=null,this.accessToken=null,this.tokenType=null,this.userRole=null,this.permissions=null,this.isSuperadmin=!1,this.switches={},sessionStorage.removeItem("session")},this.restore=function(){var a=JSON.parse(sessionStorage.getItem("session"));a&&(this.userID=a.userID,this.accessToken=a.accessToken,this.tokenType=a.tokenType,this.userRole=a.userRole,this.permissions=a.permissions,this.isSuperadmin=a.isSuperadmin,this.switches=a.switches)},this}]),angular.module("wasabi.controllers").controller("ExperimentsCtrl",["$scope","$filter","$http","$timeout","ExperimentsFactory","$uibModal","UtilitiesFactory","$rootScope","StateFactory","DialogsFactory","AUTH_EVENTS","Session","PERMISSIONS","ConfigFactory","AuthzFactory","USER_ROLES","ApplicationsFactory","BucketsFactory","ExperimentStatisticsFactory","ApplicationStatisticsFactory","FavoritesFactory","$cookies",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){var w=moment().format("MM/DD/YYYY");a.data={query:"",advStatus:"notTerminated",advApplicationName:"",advExperimentName:"",adv1stDateSearchType:"isAny",advTxtSearchDateOne:w,advTxtSearchDateTwo:w,advEnd1stDateSearchType:"isAny",advEndTxtSearchDateOne:w,advEndTxtSearchDateTwo:w,advSearchTags:[],showGrid:!1,showingGrid:!1,showAdvancedSearch:!1,filtersApplied:!1,hideTerminated:!0,enableCardView:!1},a.tempAdvancedSearchValues={advStatus:"notTerminated",advApplicationName:"",advExperimentName:"",adv1stDateSearchType:"isAny",advTxtSearchDateOne:w,advTxtSearchDateTwo:w,advEnd1stDateSearchType:"isAny",advEndTxtSearchDateOne:w,advEndTxtSearchDateTwo:w,advSearchTags:[]},a.showFilterPopover=!1,a.dynamicPopover={templateUrl:"views/AdvancedFiltersPopover.html"},a.pagedData={pagedItems:[]},a.orderByField="applicationName",a.reverseSort=!1,a.itemsPerPage=10,a.groupedItems=[],a.filteredItems=[],a.currentPage=i.currentExperimentsPage,a.initialPage=i.currentExperimentsPage,a.totalItems=0,a.hasAnyCreatePermissions=!1,a.noExperiments=!1,a.applicationsLoaded=!1,a.favoritesObj={favorites:null},a.experiments=[],a.applications=[],a.cardViewExperiments=[],a.cardViewTotalItems=0,a.cardViewItemsPerPage=8,a.initialCardViewPage=i.currentCardViewPage,a.cardViewData={cardViewCurrentPage:i.currentCardViewPage},a.applicationsWithReadOrBetterAccess=[],a.needDataForThese=[],a.disableShowAsGrid=!1,a.initialGridsShown=12,a.gridsShown=0,a.gridDataLoaded=0,a.help=n.help,a.actionDiffForCardView=function(a){return g.actionDiffForCardView(a)},a.convertOrderByField=function(){switch(a.orderByField){case"applicationName":return"application_name";case"label":return"experiment_label";case"creatorID":return"created_by";case"samplingPercent":return"sampling_percent";case"startTime":return"start_time";case"endTime":return"end_time";case"modificationTime":return"modification_time";case"state":return"state";default:return"application_name"}},a.doFavorites=function(b,c){function d(b){if(a.favoritesObj.favorites&&a.favoritesObj.favorites.length&&b)for(var c=0;c<b.length;c++)b[c].isFavorite=a.favoritesObj.favorites.indexOf(b[c].id)>=0}c?u.query().$promise.then(function(c){a.favoritesObj.favorites=c&&c.experimentIDs?c.experimentIDs:[],d(b)},function(a){g.handleGlobalError(a,"The list of favorites could not be retrieved.")}):d(b)},a.loadAllTags=function(){g.loadAllTags(a,!1)},a.queryTags=function(b){return g.queryTags(b,a.allTags)},a.doLoadExperiments=function(b,c,d,f){function h(a,b){return a.length>0&&(a+=","),a+=b}g.startSpin();var i={perPage:c,page:d,sort:(a.reverseSort?"-":"")+a.convertOrderByField(),filter:""};if(a.data.query&&0!==a.data.query.length&&(i.filter=encodeURIComponent(a.data.query)),a.data.filtersApplied){if(a.data.advApplicationName&&a.data.advApplicationName.length>0&&(i.filter=h(i.filter,"application_name_exact="+a.data.advApplicationName)),"any"!==a.data.advStatus&&(i.filter=h(i.filter,"state_exact="+a.data.advStatus)),a.data.advExperimentName&&$.trim(a.data.advExperimentName).length>0&&(i.filter=h(i.filter,"experiment_label="+$.trim(a.data.advExperimentName))),"isAny"!==a.data.adv1stDateSearchType){if(0===a.data.advTxtSearchDateOne.length||"isBetween"===a.data.adv1stDateSearchType&&0===a.data.advTxtSearchDateTwo.length)return g.displayPageError("Missing Date","You must provide a value for the search date."),!1;i.filter=h(i.filter,"date_constraint_start="+a.data.adv1stDateSearchType+":"+a.data.advTxtSearchDateOne+("isBetween"===a.data.adv1stDateSearchType?":"+a.data.advTxtSearchDateTwo:""))}if(a.data.advEnd1stDateSearchType&&"isAny"!==a.data.advEnd1stDateSearchType){if(0===a.data.advEndTxtSearchDateOne.length||"isBetween"===a.data.advEnd1stDateSearchType&&0===a.data.advEndTxtSearchDateTwo.length)return g.displayPageError("Missing Date","You must provide a value for the search date."),!1;i.filter=h(i.filter,"date_constraint_end="+a.data.advEnd1stDateSearchType+":"+a.data.advEndTxtSearchDateOne+("isBetween"===a.data.advEnd1stDateSearchType?":"+a.data.advEndTxtSearchDateTwo:""))}else a.data.advEnd1stDateSearchType="isAny",a.data.advEndTxtSearchDateOne=w,a.data.advEndTxtSearchDateTwo=w,localStorage.setItem("wasabiLastSearch",JSON.stringify(a.data));if(a.data.advSearchTags&&a.data.advSearchTags.length>0){for(var j="tags_and=",k=0;k<a.data.advSearchTags.length;k++)j+=k>0?";":"",j+=a.data.advSearchTags[k].text;i.filter=h(i.filter,j)}}else i.filter=h(i.filter,"state_exact=notTerminated");b?s.cardViewData(i).$promise.then(f,function(a){g.handleGlobalError(a,"The list of experiments could not be retrieved.")}).finally(function(){g.stopSpin()}):e.query(i).$promise.then(f,function(a){g.handleGlobalError(a,"The list of experiments could not be retrieved.")}).finally(function(){g.stopSpin()})},a.loadExperiments=function(){a.loadAllTags(),a.data.showGrid?a.loadCardViewExperiments():a.loadTableExperiments()},a.loadTableExperiments=function(){a.doLoadExperiments(!1,a.itemsPerPage,a.currentPage,function(b){var c=b.experiments;if(c){for(var d=0;d<c.length;d++)c[d]?c[d].selected=!1:delete c[d];a.totalItems=b.totalEntries}a.experiments=c,a.experiments.forEach(function(b){h.applicationNames.indexOf(b.applicationName)<0&&(h.applicationNames.push(b.applicationName),a.hasPermission(b.applicationName,"create")&&(a.hasAnyCreatePermissions=!0))}),a.favoritesObj.favorites&&0!==a.favoritesObj.favorites.length?a.doFavorites(a.experiments,!1):(a.favoritesObj.favorites=[],a.doFavorites(a.experiments,!0)),a.applications=[],a.applicationsWithReadOrBetterAccess=[],l.permissions.forEach(function(b){g.hasPermission(b.applicationName,m.createPerm)&&a.applications.push(b.applicationName),g.hasPermission(b.applicationName,m.readPerm)&&a.applicationsWithReadOrBetterAccess.push(b.applicationName)}),a.applications.length>1&&a.applications.sort(function(a,b){return a.toLowerCase().localeCompare(b.toLowerCase())}),a.applicationsWithReadOrBetterAccess.length>1&&a.applicationsWithReadOrBetterAccess.sort(function(a,b){return a.toLowerCase().localeCompare(b.toLowerCase())}),a.noExperiments=0===a.totalItems&&0===a.applicationsWithReadOrBetterAccess.length,a.applicationsLoaded=!0})},a.loadCardViewExperiments=function(){function b(a){var b='<div style="font-weight:normal; font-size:15px; padding-bottom:5px">'+a.label+(a.isControl?" (control)":a.isBaseLine?" (baseline)":"")+"</div>";return a.description&&a.description.length>0&&(b+='<div style="width:360px">'+a.description+"</div>"),b}a.doLoadExperiments(!0,a.cardViewItemsPerPage,a.cardViewData.cardViewCurrentPage,function(c){var d=c.experimentDetails;if(d){for(var e=0;e<d.length;e++)if(d[e]){d[e].selected=!1,g.getFormattedStartAndEndDates(d[e]);var f=d[e].formattedStart,h=d[e].formattedEnd;d[e].homePageTooltip="";var i='<div style="font-weight:normal; font-size:15px;">'+d[e].label+"</div>";if(i+='<div style="position:relative; padding-bottom:9px; font-size: 90%; color:rgb(92,92,92)">',i+=f.format("MMM DD YYYY")+" - "+h.format("MMM DD YYYY")+"</div>",d[e].description&&d[e].description.length>0&&(i+='<div style="width:360px">'+d[e].description+"</div>"),d[e].homePageTooltip=i,d[e].buckets&&d[e].buckets.length>0){d[e].controlBucketLabel=d[e].buckets[0].label;for(var j=[],k=0;k<d[e].buckets.length;k++)d[e].buckets[k].state&&"OPEN"===d[e].buckets[k].state?(d[e].buckets[k].isControl&&(d[e].hasControlBucket=!0,d[e].controlBucketLabel=d[e].buckets[k].label),d[e].buckets[k].homePageTooltip=b(d[e].buckets[k])):j.push(k);if(j.length>0)for(var l=j.length-1;l>=0;l--)d[e].buckets.splice(j[l],1);d[e].hasControlBucket||(d[e].buckets[0].isBaseLine=!0,d[e].buckets[0].homePageTooltip=b(d[e].buckets[0])),"DRAFT"!==d[e].state&&g.determineCardViewBucketImprovementClass(d[e])}}else delete d[e];a.cardViewTotalItems=c.totalEntries}a.cardViewExperiments=d,a.favoritesObj.favorites&&0!==a.favoritesObj.favorites.length?a.doFavorites(a.cardViewExperiments,!1):(a.favoritesObj.favorites=[],a.doFavorites(a.cardViewExperiments,!0))})},a.transferFilterSettings=function(a,b){for(var c in a)if(a.hasOwnProperty(c)&&0===c.indexOf("adv"))if(a[c]instanceof Array){b[c]=[];for(var d=0;d<a[c].length;d++)b[c].push(a[c][d])}else b[c]=a[c]};var x=localStorage.getItem("wasabiLastSearch");x&&(a.data=JSON.parse(x),a.data.filtersApplied&&a.transferFilterSettings(a.data,a.tempAdvancedSearchValues)),a.loadAllTags(),l&&l.switches&&(a.data.enableCardView=l.switches.ShowCardView),a.data.enableCardView&&(v.wasabiCardViewSetting?(a.data.showGrid="boolean"==typeof v.wasabiCardViewSetting&&v.wasabiCardViewSetting||"string"==typeof v.wasabiCardViewSetting&&"true"===v.wasabiCardViewSetting,a.data.showingGrid=a.data.showGrid):v.wasabiCardViewSetting=a.data.showGrid,a.data.showGrid&&a.loadCardViewExperiments()),a.loadTableExperiments(),g.hideHeading(!1),g.selectTopLevelTab("Experiments"),h.applicationNames=[],a.switchToGrid=function(){a.data.showGrid?(a.data.showGrid=a.data.showingGrid=v.wasabiCardViewSetting=!1,localStorage.setItem("wasabiLastSearch",JSON.stringify(a.data)),a.loadTableExperiments()):(a.data.showGrid=a.data.showingGrid=v.wasabiCardViewSetting=!0,localStorage.setItem("wasabiLastSearch",JSON.stringify(a.data)),a.loadCardViewExperiments())},a.applySearchSortFilters=function(){a.data.showAdvancedSearch?a.advSearch(!0):a.search(!0)},a.redoSearchAndSort=function(){a.applySearchSortFilters(!0)},a.handleCardStarAnimation=function(b){if(b)return b.animate({opacity:0},1e3,"swing",function(){a.redoSearchAndSort(),b.animate({opacity:1},1e3);var c=b.find(".summaryHead h2").eq(0).text();g.displayPageSuccessMessage("Favorite Changed",b.hasClass("favorite")?"Experiment "+c+" has been made a favorite.":"Experiment "+c+" is no longer a favorite.")}),!1},a.handleListStarAnimation=function(b){b&&b.parent().animate({opacity:0},1e3,"swing",function(){a.redoSearchAndSort(),b.parent().animate({opacity:1},1e3);var c=b.parent().find("td").eq(2).find("a").eq(0).text();g.displayPageSuccessMessage("Favorite Changed",b.hasClass("favorite")?"Experiment "+c+" has been made a favorite.":"Experiment "+c+" is no longer a favorite.")})},a.deleteExperiment=function(b){g.deleteExperiment(b,a.loadExperiments)},a.openResultsModal=function(b){g.openResultsModal(b,!1,a.loadExperiments)},a.changeState=function(b,c){var d={PAUSED:a.openResultsModal,RUNNING:function(){g.displaySuccessWithCacheWarning("Experiment Started","Your experiment has been successfully started."),a.loadExperiments()},TERMINATED:a.loadExperiments};g.changeState(b,c,d)},a.stateImgUrl=function(a){return g.stateImgUrl(a)},a.stateName=function(a){return g.stateName(a)},a.capitalizeFirstLetter=function(a){return g.capitalizeFirstLetter(a)},a.hasPermission=function(a,b){return g.hasPermission(a,b)},a.sortBy=function(b){a.orderByField===b?a.reverseSort=!a.reverseSort:a.reverseSort=!0,a.orderByField=b,""!==a.orderByField&&a.loadExperiments()},a.loadGridDataIfNecessary=function(){a.data.showGrid&&(a.needDataForThese=[],a.cardViewExperiments.forEach(function(b){a.needDataForThese.push({experiment:b,onlyBucketData:"draft"===b.state.toLowerCase()})}),a.startDataLoadForNextExperiment())},a.clearSearch=function(){a.data.query="",a.doSearch()},a.doSearch=function(){a.loadExperiments(),g.doTrackingInit()},a.search=function(){localStorage.setItem("wasabiLastSearch",JSON.stringify(a.data)),a.searchTimer&&d.cancel(a.searchTimer),a.searchTimer=d(a.doSearch,400)},a.popoverClicked=function(){a.data.filtersApplied||(a.tempAdvancedSearchValues={advStatus:"notTerminated",advApplicationName:"",advExperimentName:"",adv1stDateSearchType:"isAny",advTxtSearchDateOne:w,advTxtSearchDateTwo:w,advEnd1stDateSearchType:"isAny",advEndTxtSearchDateOne:w,advEndTxtSearchDateTwo:w,advSearchTags:[]})},a.advSearch=function(b){if(b&&b.$invalid)return a.showFilterPopover=!1,!1;a.data.filtersApplied=!0,a.transferFilterSettings(a.tempAdvancedSearchValues,a.data),localStorage.setItem("wasabiLastSearch",JSON.stringify(a.data)),null===a.data.advApplicationName&&(a.data.advApplicationName=""),a.loadExperiments(),a.showFilterPopover=!1;var c="advStatus="+a.data.advStatus+"&advExperimentName="+a.data.advExperimentName+"&advStartOrEndDate="+a.data.advStartOrEndDate+"&adv1stDateSearchType="+a.data.adv1stDateSearchType+"&advTxtSearchDateOne="+a.data.advTxtSearchDateOne+"&advTxtSearchDateTwo="+a.data.advTxtSearchDateTwo+"&advEnd1stDateSearchType="+a.data.advEnd1stDateSearchType+"&advEndTxtSearchDateOne="+a.data.advEndTxtSearchDateOne+"&advEndTxtSearchDateTwo="+a.data.advEndTxtSearchDateTwo;g.trackEvent("advancedSearch",{key:"search_parms",value:c}),g.doTrackingInit()},a.clearFilters=function(){a.data=Object.assign(a.data,{advStatus:"notTerminated",advApplicationName:"",advExperimentName:"",adv1stDateSearchType:"isAny",advTxtSearchDateOne:w,advTxtSearchDateTwo:w,advEnd1stDateSearchType:"isAny",advEndTxtSearchDateOne:w,advEndTxtSearchDateTwo:w,advSearchTags:[],filtersApplied:!1}),localStorage.setItem("wasabiLastSearch",JSON.stringify(a.data)),a.transferFilterSettings(a.data,a.tempAdvancedSearchValues),a.loadExperiments(),a.showFilterPopover=!1},a.pageChanged=function(){return a.initialPage>1?(a.currentPage=a.initialPage,a.initialPage=0,!1):(i.currentExperimentsPage=a.currentPage,void a.loadTableExperiments())},a.cardViewPageChanged=function(){return a.initialCardViewPage>1?(a.cardViewData.cardViewCurrentPage=a.initialCardViewPage,a.initialCardViewPage=0,!1):(i.currentCardViewPage=a.cardViewData.cardViewCurrentPage,void a.loadCardViewExperiments())},a.doPageRangeStart=function(a,b,c){try{return 1===a?0===b?0:1:(a-1)*c+1}catch(a){return 0}},a.doPageRangeEnd=function(a,b,c){try{var d=1;d=1===a?0===b?0:1:(a-1)*c+1;var e=b>=d+c?d+c-1:b;return e}catch(a){return 0}},a.pageRangeStart=function(){return a.doPageRangeStart(a.currentPage,a.totalItems,a.itemsPerPage)},a.pageRangeEnd=function(){return a.doPageRangeEnd(a.currentPage,a.totalItems,a.itemsPerPage)},a.cardViewPageRangeStart=function(){return a.doPageRangeStart(a.cardViewData.cardViewCurrentPage,a.cardViewTotalItems,a.cardViewItemsPerPage)},a.cardViewPageRangeEnd=function(){return a.doPageRangeEnd(a.cardViewData.cardViewCurrentPage,a.cardViewTotalItems,a.cardViewItemsPerPage)},a.filterList=function(b){return!a.data.hideTerminated||"terminated"!==b.state.toLowerCase()},a.advancedFilterList=function(a,b){switch(b){case"notTerminated":return"terminated"!==a.state.toLowerCase();case"terminated":case"running":case"paused":case"draft":return a.state.toLowerCase()===b}return!0},a.hasDeletePermission=function(a){return g.hasPermission(a.applicationName,m.deletePerm)},a.hasUpdatePermission=function(a){return g.hasPermission(a.applicationName,m.updatePerm)},a.openExperimentModal=function(b){var c=f.open({templateUrl:"views/ExperimentModal.html",controller:"ExperimentModalCtrl",windowClass:"xx-dialog",backdrop:"static",resolve:{experiment:function(){return b?b:{startTime:moment(0,"HH").format("ddd MMM DD YYYY HH:mm:ss ZZ"),endTime:moment(0,"HH").add(14,"days").format("ddd MMM DD YYYY HH:mm:ss ZZ"),isPersonalizationEnabled:!1}},experiments:function(){return a.experiments},favoritesObj:function(){return a.favoritesObj},readOnly:function(){return!1},openedFromModal:function(){return!1},applications:function(){var b=a.applications.slice(0);return b.push(n.newApplicationNamePrompt),b}}});g.failIfTokenExpired(c),a.$on(k.notAuthenticated,function(){c.close()}),c.result.then(function(){g.updatePermissionsAndAppList(function(b){a.applications=b,a.loadExperiments()})})}}]),angular.module("wasabi.controllers").controller("ExperimentModalCtrl",["$scope","$uibModalInstance","$uibModal","$filter","ExperimentsFactory","experiments","experiment","UtilitiesFactory","$rootScope","readOnly","applications","DialogsFactory","RuleEditFactory","ConfigFactory","Session","AuthzFactory","ApplicationsFactory","PERMISSIONS","$cookies","openedFromModal","EmailFactory","favoritesObj",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){h.trackEvent("loadedDialog",{key:"dialog_name",value:"createOrEditExperiment"}),a.data={disableSimple:!1,userCapValue:g&&g.isRapidExperiment?g.userCap:"",apiLanguage:"curl"},a.experiment=g,a.tags=[],a.allTags=[],a.experiment.applicationName2=1===k.length?"":"novalue",a.readOnly=!!j&&j,a.simpleRuleEditing=void 0===s.showAdvancedSegmentationEditor||"true"!==s.showAdvancedSegmentationEditor,a.experimentFormSubmitted=a.readOnly,a.experiments=f,a.applications=k,a.allApplications=[],a.postSubmitError=null,a.modalInstance=b,a.showApplicationName2=!1,a.newApplicationNamePrompt=n.newApplicationNamePrompt,a.currentUser=o.userID,a.openedFromModal=t,a.bucketTotalsValid=!1,a.rulesChangedNotSaved=!(a.experiment&&a.experiment.rule&&a.experiment.rule.length>0),a.plugins=i.plugins,a.favoritesObj=v,a.tabs=[{active:!0},{active:!1},{active:!1},{active:!1}],a.types=m.types,a.placeholders=m.placeholders,a.stringTypeOperators=m.stringTypeOperators,a.numberTypeOperators=m.numberTypeOperators,a.booleanTypeOperators=m.booleanTypeOperators,a.dateTypeOperators=m.dateTypeOperators,a.operators=m.operators(),a.booleanOperators=m.booleanOperators,a.rules=[{booleanOperator:"",type:"string",subject:"",operator:"equals",value:"",showDelete:!0,errorMessage:"Enter a quoted string"}],a.help=n.help,a.labelStrings=n.labelStrings,1===a.applications.length&&(a.experiment.applicationName=a.applications[0]),a.totalBucketAllocation=function(){return h.totalBucketAllocation(a)},a.toggleAdvanced=function(){var b=m.toggleAdvanced({disableSimple:a.data.disableSimple,experiment:a.experiment,simpleRuleEditing:a.simpleRuleEditing,rules:a.rules,tabs:a.tabs});return!!b&&(a.experiment=b.experiment,void(a.simpleRuleEditing=b.simpleRuleEditing))},a.setSimpleDisabled=function(){a.data.disableSimple=!0,a.rulesChangedNotSaved=!0},a.setAsFavorite=function(){},a.typeSpecificPlaceholder=function(b){return a.placeholders[b]},a.changed=function(){a.experiment.applicationName===n.newApplicationNamePrompt?(a.experiment.applicationName2="",a.showApplicationName2=!0):(a.experiment.applicationName2="novalue",a.showApplicationName2=!1,a.loadAllTags())},a.stateImgUrl=function(a){return h.stateImgUrl(a)},a.stateName=function(a){return h.stateName(a)},a.selectApplication=function(b,c){return a.experiment.applicationName2=c.item.label,a.$digest(),a.openAdminListModal(a.experiment.applicationName2),!1},a.selectApplicationOnEnter=function(b){return a.experiment.applicationName2=b,a.openAdminListModal(b),!1},a.handleNewApplication=function(){a.oldAppName===n.newApplicationNamePrompt&&(a.applications.splice(1,0,a.experiment.applicationName),a.experiment.applicationName2="novalue",a.showApplicationName2=!1)},a.loadAllTags=function(){h.loadAllTags(a,!0)},a.queryTags=function(b){return h.queryTags(b,a.allTags)},a.transferTags=function(b){h.transferTags(b,a)},a.init=function(){a.processRule(),a.loadAllApplications(),a.loadAllTags(),a.transferTags(!0)},a.loadExperiment=function(){e.show({id:a.experiment.id}).$promise.then(function(b){for(var c in b)b.hasOwnProperty(c)&&!a.experiment.hasOwnProperty(c)&&(a.experiment[c]=b[c]);null===a.experiment.hypothesisIsCorrect&&(a.experiment.hypothesisIsCorrect=""),
a.init()},function(a){h.handleGlobalError(a,"Your experiment could not be retrieved.")})},a.loadAllApplications=function(){q.query().$promise.then(function(b){if(b){a.allApplications=[];for(var c=0;c<b.length;c++){for(var d=!1,e=0;e<a.applications.length;e++)if(b[c].applicationName===a.applications[e]){d=!0;break}d||a.allApplications.push(b[c].applicationName)}}},function(a){h.handleGlobalError(a,"The list of applications could not be retrieved.")})},a.typeChanged=function(b,c){m.typeChanged(b,c),a.rulesChangedNotSaved=!0},a.ruleChanged=function(){a.rulesChangedNotSaved=!0},a.addRule=function(){m.addRule(a.rules),a.rulesChangedNotSaved=!0},a.removeRule=function(b){m.removeRule(b,a.rules),a.rulesChangedNotSaved=!0},a.convertRuleControlsToRuleString=function(){return m.convertRuleControlsToRuleString(a.rules,a.tabs)},a.populateRuleControlsFromJSON=function(b){var c={simpleRuleEditing:a.simpleRuleEditing,disableSimple:a.data.disableSimple},d=m.populateRuleControlsFromJSON(b,a.rules,c);a.simpleRuleEditing=d.simpleRuleEditing,a.data.disableSimple=d.disableSimple},a.processRule=function(){a.experiment.ruleJson&&a.experiment.ruleJson.length>0&&(a.rules=[],a.populateRuleControlsFromJSON(a.experiment.ruleJson))},a.rapidExperimentLabel=function(){return h.rapidExperimentLabel(a.experiment)},a.maxRapidUsersChanged=function(){a.data.userCapValue&&a.data.userCapValue>0?(a.experiment.isRapidExperiment=!0,a.experiment.userCap=a.data.userCapValue):(a.experiment.isRapidExperiment=!1,a.experiment.userCap=2147483647)},a.firstPageEncoded=function(){return h.firstPageEncoded(a.experiment)},a.experiment.id&&a.experiment.id.length>0&&!a.experiment.hasOwnProperty("samplingPercent")?a.loadExperiment():a.init(),a.doSaveOrCreateExperiment=function(c,d){var f=function(b,c){a.experiment=b,a.handleNewApplication(),h.trackEvent("saveItemSuccess",{key:"dialog_name",value:c},{key:"application_name",value:b.applicationName},{key:"item_id",value:b.id},{key:"item_label",value:b.label}),i.$broadcast("experiment_created"),a.experiment.applicationName2="novalue"},j=function(c){g.applicationName=a.oldAppName,a.experimentFormSubmitted=!0,a.postSubmitError=h.extractErrorFromResponse(c),"unauthenticated"===a.postSubmitError&&b.close()},k=function(c){a.handleNewApplication(),h.trackEvent("saveItemSuccess",{key:"dialog_name",value:c},{key:"application_name",value:a.experiment.applicationName},{key:"item_id",value:a.experiment.id},{key:"item_label",value:a.experiment.label}),h.displayPageError("","",!1),a.experiment.applicationName2="novalue",d?d():b.close()},l=function(c){a.experimentFormSubmitted=!0,a.postSubmitError=h.extractErrorFromResponse(c),"invalidRule"===a.postSubmitError?h.displayPageError("Invalid Segmentation Rule","Your segmentation rule has a syntactic error."):"unauthenticated"===a.postSubmitError&&b.close()},m=function(){if(a.simpleRuleEditing&&(a.experiment.rule=a.convertRuleControlsToRuleString(),null===a.experiment.rule))return!1;a.oldAppName=g.applicationName,g.applicationName=s;var b=moment(a.experiment.startTime,["YYYY-MM-DDTHH:mm:ssZ","ddd MMM DD YYYY HH:mm:ss ZZ"]).format("YYYY-MM-DDTHH:mm:ssZZ"),d=moment(a.experiment.endTime,["YYYY-MM-DDTHH:mm:ssZ","ddd MMM DD YYYY HH:mm:ss ZZ"]).format("YYYY-MM-DDTHH:mm:ssZZ");if(c){var h={id:c,applicationName:a.experiment.applicationName,label:a.experiment.label,samplingPercent:a.experiment.samplingPercent,startTime:b,endTime:d,description:a.experiment.description,rule:a.experiment.rule,isRapidExperiment:a.experiment.isRapidExperiment,tags:a.experiment.tags};a.experiment.isRapidExperiment&&(h.userCap=a.experiment.userCap),p?e.updateWithNewApplication(h).$promise.then(function(){k("editExperimentNewApplication")},l):e.update(h).$promise.then(function(){k("editExperiment")},l)}else{var i={applicationName:g.applicationName,label:g.label,samplingPercent:g.samplingPercent,startTime:b,endTime:d,description:g.description,isRapidExperiment:g.isRapidExperiment,tags:g.tags};g.isRapidExperiment&&(i.userCap=g.userCap),p?e.createWithNewApplication(i).$promise.then(function(a){f(a,"createExperimentNewApplication")},j):e.create(i).$promise.then(function(a){f(a,"createExperiment")},j)}},o=function(b){q.query().$promise.then(function(c){if(c){var d=[];if(c.forEach(function(a){h.hasPermission(a.applicationName,r.createPerm)||d.push(a.applicationName)}),d&&d.length>0){for(var e=!1,f=0;f<d.length;f++)if(d[f].toLowerCase()===s.toLowerCase()){a.openAdminListModal(s),e=!0;break}e||b()}else b()}else b()},function(a){h.handleGlobalError(a,"The list of unauthorized applications could not be retrieved.")})},p=g.applicationName===n.newApplicationNamePrompt,s=p?g.applicationName2:g.applicationName;a.transferTags(!1),p?o(m):m()},a.validateBuckets=function(b,c,d){if(a.experiment.buckets&&a.experiment.buckets.length>0){var e=a.totalBucketAllocation();if(1!==e){var f="You will be able to start the experiment only if the total allocation percentage of all the buckets is 100%. Right now it is "+(100*e).toFixed(2)+"%.",g="Allocation Error";b?l.alertDialog(f,g):l.confirmDialog(f,g,function(){a.doSaveOrCreateExperiment(c)},function(){})}else a.doSaveOrCreateExperiment(c,d)}else{var h="You need to have at least one bucket defined to be able to start the experiment.",i="Bucket Error";b?l.alertDialog(h,i):l.confirmDialog(h,i,function(){a.doSaveOrCreateExperiment(c)},function(){})}},a.saveExperiment=function(b,c){c?(a.convertRuleControlsToRuleString(),a.experimentFormSubmitted=!0):b?a.validateBuckets(!1,b):a.doSaveOrCreateExperiment(b)},a.changeState=function(a,b,c){h.changeState(a,b,c)},a.startExperiment=function(c){return c?(a.experimentFormSubmitted=!0,void l.alertDialog("Please address the errors displayed before you can start your experiment.","Errors Preventing Start")):void a.validateBuckets(!0,a.experiment.id,function(){a.changeState(a.experiment,"RUNNING",function(){l.alertDialog("Your experiment has been started successfully!  PLEASE NOTE: The experiment may not be available for assignments for up to 5 minutes.","Start Successful"),b.close(!0)})})},a.cancel=function(){b.close()},a.openAdminListModal=function(b){l.confirmDialog("You don't have any access for application "+b+".  Do you want to send an email to the admins of the application requesting access?","No Access For Application "+b,function(){var c=n.baseUrl().lastIndexOf("/",n.baseUrl().lastIndexOf("/",n.baseUrl().length-1)-1),d=n.baseUrl().substring(0,c+1)+"#/userAccess/",e=["For Read-only Access: "+d+o.userID+"/"+b+"/READONLY","For Read/Write Access: "+d+o.userID+"/"+b+"/READWRITE","For Admin Access: "+d+o.userID+"/"+b+"/ADMIN"];u.sendEmail({appName:b,userName:o.userID,emailLinks:e}).$promise.then(function(){h.trackEvent("saveItemSuccess",{key:"dialog_name",value:"experimentModalSendEmail"},{key:"experiment_id",value:o.userID});var c="An access request email has been sent to the admins of application "+b+".";l.alertDialog(c,"Email Sent",function(){}),a.experiment.applicationName2=""},function(a){h.handleGlobalError(a,"Your email could not be sent.")})},function(){a.experiment.applicationName2=""},"Send Email","Cancel")},a.openSegmentationTestModal=function(){var b=c.open({templateUrl:"views/SegmentationTestModal.html",controller:"SegmentationTestModalCtrl",windowClass:"xxx-dialog",backdrop:"static",resolve:{experiment:function(){return a.experiment},rules:function(){return a.rules}}});b.result.then(function(){})},a.addTabs=function(){i.plugins&&i.plugins.length>0},a.openPluginModal=function(b){h.openPluginModal(b,a.experiment)}}]),angular.module("wasabi.controllers").controller("BucketsCtrl",["$scope","$rootScope","$filter","$http","BucketsFactory","$uibModal","UtilitiesFactory","DialogsFactory",function(a,b,c,d,e,f,g,h){a.bucket=[],a.loadBuckets=function(){a.experiment.id&&(g.startSpin(),e.query({experimentId:a.experiment.id}).$promise.then(function(b){a.buckets=b,a.experiment.buckets=b},function(b){g.handleGlobalError(b,"The list of experiment buckets could not be retrieved."),a.modalInstance.close()}).finally(function(){g.stopSpin()}))},a.loadBuckets(),a.multiply100=function(a){return b.multiply100(a)},a.balanceBuckets=function(){g.balanceBuckets(a.buckets,a.experiment)},a.deleteBucket=function(b){h.confirmDialog("Delete bucket "+b.label+"?","Delete Bucket",function(){e.delete({experimentId:a.experiment.id,bucketLabel:b.label}).$promise.then(function(){g.trackEvent("deleteItemSuccess",{key:"dialog_name",value:"deleteBucket"},{key:"experiment_id",value:a.experiment.id},{key:"item_id",value:b.id}),a.loadBuckets()},function(a){g.handleGlobalError(a,"Your bucket could not be deleted.")})})},a.openBucketModal=function(b,c){var d=f.open({templateUrl:"views/BucketModal.html",controller:"BucketModalCtrl",windowClass:"xxx-dialog",backdrop:"static",resolve:{bucket:function(){return c?e.show({experimentId:b,bucketLabel:c}):[]},buckets:function(){return a.experiment.buckets},isCreateBucket:function(){return!c},isEditInDetails:function(){return!1},isNoControl:function(){return!1},bucketStatistics:function(){return{}},experimentId:function(){return b},readOnly:function(){return!1}}});g.failIfTokenExpired(d),d.result.then(function(){a.loadBuckets()})}}]),angular.module("wasabi.controllers").controller("BucketModalCtrl",["$scope","$uibModalInstance","BucketsFactory","bucket","experimentId","isCreateBucket","isEditInDetails","isNoControl","UtilitiesFactory","bucketStatistics","ConfigFactory","readOnly","buckets",function(a,b,c,d,e,f,g,h,i,j,k,l,m){a.isCreateBucket=f,a.bucket=d,a.buckets=m,a.bucketFormSubmitted=!1,a.postSubmitError=null,a.isEditInDetails=g,a.isNoControl=h,a.bucketStatistics=j,a.readOnly=l,a.help=k.help,a.updateBucket=function(d,e,f,g){c.update({experimentId:d,label:e.label,allocationPercent:e.allocationPercent,description:e.description,isControl:e.isControl,payload:e.payload}).$promise.then(function(){i.trackEvent("saveItemSuccess",{key:"dialog_name",value:"editBucket"},{key:"experiment_id",value:d},{key:"item_label",value:e.label}),f?f(d,g):b.close()},function(c){f||(a.bucketFormSubmitted=!0),a.postSubmitError="genericUpdateError","unauthenticated"===i.extractErrorFromResponse(c)&&(f||b.close())})},a.createBucket=function(d,e){c.create({experimentId:d,label:e.label,allocationPercent:e.allocationPercent,description:e.description,isControl:e.isControl,payload:e.payload}).$promise.then(function(){i.trackEvent("saveItemSuccess",{key:"dialog_name",value:"createBucket"},{key:"experiment_id",value:d}),b.close()},function(c){a.bucketFormSubmitted=!0,a.postSubmitError="genericCreateError","unauthenticated"===i.extractErrorFromResponse(c)&&b.close()})},a.saveBucket=function(b){if(b)a.bucketFormSubmitted=!0;else if(d.allocationPercent=Math.round(1e4*d.allocationPercent)/1e4,f)if(d.isControl&&a.buckets&&a.buckets.length>0){for(var c=!1,g=0;g<a.buckets.length;g++)a.buckets[g].isControl&&(a.buckets[g].isControl=!1,c=!0,a.updateBucket(e,a.buckets[g],a.createBucket,d));c||a.createBucket(e,d)}else a.createBucket(e,d);else a.updateBucket(e,d)},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("wasabi.controllers").controller("DatePickerCtrl",["$scope",function(a){a.today=function(){a.experiment.startDate=new Date},a.today(),a.showWeeks=!1,a.showButtonBar=!1,a.toggleWeeks=function(){a.showWeeks=!a.showWeeks},a.clear=function(){a.dt=null},a.minDateStart=a.minDateStart?null:new Date,a.minDateEnd=a.startTime?null:new Date,a.open=function(b){b.preventDefault(),b.stopPropagation(),a.opened=!0},a.dateOptions={"year-format":"yy","starting-day":1},a.format="dd MMM yyyy"}]),angular.module("wasabi.controllers").controller("TimePickerCtrl",["$scope",function(a){a.hstep=1,a.mstep=15,a.ismeridian=!0}]),angular.module("wasabi.controllers").controller("CloseBucketConfirmModalCtrl",["$scope","$uibModalInstance","bucketLabel",function(a,b,c){a.bucketLabel=c,a.ok=function(){b.close()},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("wasabi.controllers").controller("EmptyBucketConfirmModalCtrl",["$scope","$uibModalInstance","bucketLabel",function(a,b,c){a.bucketLabel=c,a.ok=function(){b.close()},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("wasabi.controllers").controller("ExperimentDetailsCtrl",["$scope","$filter","$http","$timeout","ExperimentsFactory","BucketsFactory","ConfigFactory","ExperimentStatisticsFactory","$stateParams","$uibModal","UtilitiesFactory","$rootScope","ApplicationStatisticsFactory","DialogsFactory","RuleEditFactory","$cookies","PERMISSIONS","supportEmail",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){a.data={disableSimple:!1,disableAdvanced:!1,ruleWidgetsDisabled:!1,resultsWidgetsDisabled:!0,descriptionLength:0,tagWidgetsDisabled:!0,apiLanguage:"curl"},a.experiment={id:i.experimentId,isRapidExperiment:!1},a.experimentFormSubmitted=!1,a.simpleRuleEditing=void 0===p.showAdvancedSegmentationEditor||"true"!==p.showAdvancedSegmentationEditor,a.downloadUrl=g.baseUrl()+"/experiments/"+a.experiment.id+"/assignments",a.rulesChangedNotSaved=!0,a.resultsChangedNotSaved=!0,a.showingActionRates=!0,a.plugins=l.plugins,a.supportEmail=r,a.favoritesObj={favorites:null},a.headers=[],a.dataRows={},a.tags=[],a.allTags=[],a.tagsStr="",$("body").removeClass("modal-open"),a.readOnly="true"===i.readonly.toLowerCase(),a.openedFromModal="true"===i.openedFromModal.toLowerCase(),a.help=g.help,a.labelStrings=g.labelStrings,a.rules=[{booleanOperator:"",type:"string",subject:"",operator:"equals",value:"",showDelete:!0,errorMessage:"Enter a quoted string"}],a.tabs=[{active:!0},{active:!1},{active:!1},{active:!1}],a.types=o.types,a.placeholders=o.placeholders,a.stringTypeOperators=o.stringTypeOperators,a.numberTypeOperators=o.numberTypeOperators,a.booleanTypeOperators=o.booleanTypeOperators,a.dateTypeOperators=o.dateTypeOperators,a.operators=o.operators(),a.booleanOperators=o.booleanOperators,a.toggleAdvanced=function(){var b=o.toggleAdvanced({disableSimple:a.data.disableSimple,experiment:a.experiment,simpleRuleEditing:a.simpleRuleEditing,rules:a.rules,tabs:a.tabs});return!!b&&(a.experiment=b.experiment,void(a.simpleRuleEditing=b.simpleRuleEditing))},a.hasDeletePermission=function(a){return k.hasPermission(a.applicationName,q.deletePerm)},a.hasUpdatePermission=function(a){return k.hasPermission(a.applicationName,q.updatePerm)},a.afterPause=function(){k.openResultsModal(a.experiment,a.readOnly,a.loadExperiment)},a.changeState=function(b,c){var d={PAUSED:a.afterPause,RUNNING:a.loadExperiment,TERMINATED:a.loadExperiment};k.changeState(b,c,d)},a.deleteExperiment=function(b){k.deleteExperiment(b,a.exitDialog)},a.stateImgUrl=function(a){return k.stateImgUrl(a)},a.stateName=function(a){return k.stateName(a)},a.capitalizeFirstLetter=function(a){return k.capitalizeFirstLetter(a)},a.setSimpleDisabled=function(){a.data.disableSimple=!0,a.rulesChangedNotSaved=!0},a.checkForRule=function(){return o.checkForRule(a.experiment)},a.setAsFavorite=function(){},a.typeSpecificPlaceholder=function(b){return a.placeholders[b]},a.typeChanged=function(b,c){o.typeChanged(b,c),a.rulesChangedNotSaved=!0},a.ruleChanged=function(){a.rulesChangedNotSaved=!0},a.addRule=function(){o.addRule(a.rules),a.rulesChangedNotSaved=!0},a.removeRule=function(b){o.removeRule(b,a.rules),a.rulesChangedNotSaved=!0},a.convertRuleControlsToRuleString=function(){return o.convertRuleControlsToRuleString(a.rules,a.tabs)},a.populateRuleControlsFromJSON=function(b){var c={simpleRuleEditing:a.simpleRuleEditing,disableSimple:a.data.disableSimple},d=o.populateRuleControlsFromJSON(b,a.rules,c);a.simpleRuleEditing=d.simpleRuleEditing,a.data.disableSimple=d.disableSimple,a.disableRule(!0)},a.processRule=function(){a.experiment.ruleJson&&a.experiment.ruleJson.length>0?(a.rules=[],a.populateRuleControlsFromJSON(a.experiment.ruleJson)):a.disableRule(!0)},a.disableRule=function(b){a.data.ruleWidgetsDisabled=void 0===b||b},a.firstPageEncoded=function(){return k.firstPageEncoded(a.experiment)},a.rapidExperimentLabel=function(){return k.rapidExperimentLabel(a.experiment)},a.getControlBucketLabel=function(){k.getControlBucketLabel(a.experiment.buckets,a.experiment)},a.loadExperiment=function(){k.startSpin(),e.show({id:i.experimentId}).$promise.then(function(b){a.experiment=b,null===a.experiment.hypothesisIsCorrect&&(a.experiment.hypothesisIsCorrect=""),a.rulesChangedNotSaved=a.checkForRule(),a.readOnly=a.readOnly||"terminated"===b.state.toLowerCase(),k.retrieveFavorites().$promise.then(function(b){a.favoritesObj.favorites=b&&b.experimentIDs?b.experimentIDs:[],a.experiment.isFavorite=a.favoritesObj.favorites.indexOf(a.experiment.id)>=0},function(a){k.handleGlobalError(a,"The list of favorites could not be retrieved.")}),a.data.descriptionLength=b.description?b.description.length:0,a.loadBuckets(),b.numUsers=0,a.processRule(),a.transferTags(!0),l.$broadcast("experiment_created")},function(a){k.handleGlobalError(a,"Your experiment could not be retrieved.")}).finally(function(){k.stopSpin()})},a.hasControlBucket=!1,a.loadBuckets=function(){k.startSpin(),f.query({experimentId:i.experimentId}).$promise.then(function(b){a.loadApplicationStatistics(),a.experiment.buckets=b,a.getControlBucketLabel()},function(a){k.handleGlobalError(a,"Your buckets could not be loaded.")}).finally(function(){k.stopSpin()})},a.getApplicationStatistics=function(){k.startSpin(),m.query({experimentId:i.experimentId}).$promise.then(function(b){b&&(b.totalUsers&&b.totalUsers.bucketAssignments&&(a.experiment.numUsers=b.totalUsers.bucketAssignments),b.assignments&&b.assignments.length>0&&k.transferMatchingValues(a.experiment.buckets,b.assignments,"count","label","bucket")),a.loadStatistics()},function(a){k.handleGlobalError(a,"Your user count could not be loaded.")}).finally(function(){k.stopSpin()})},a.loadApplicationStatistics=function(){a.getApplicationStatistics()},a.loadStatistics=function(){k.startSpin(),h.query({experimentId:i.experimentId}).$promise.then(function(b){a.experiment.statistics=b,k.determineBucketImprovementClass(a.experiment),a.buildActionsTable()},function(a){k.handleGlobalError(a,"Your statistics could not be retrieved.")}).finally(function(){k.stopSpin()})},a.showAnalysisGraph=function(){var b=j.open({templateUrl:"views/AnalysisGraphModal.html",controller:"AnalysisGraphModalCtrl",windowClass:"xxx-dialog",backdrop:"static",resolve:{experiment:function(){return a.experiment}}});b.result.then(function(){})},a.loadDailies=function(){h.dailies({experimentId:i.experimentId}).$promise.then(function(b){a.dailies=b},function(a){k.handleGlobalError(a,"Your dailies could not be retrieved.")})},a.specificActionRate=function(a,b,c){if(isNaN(c[a].actionRates[b].estimate))return 0;var d=100*c[a].actionRates[b].estimate;return Math.round(10*d)/10},a.specificActionDiff=function(a,b,c){if(isNaN(c[a].actionRates[b].estimate))return 0;var d=(c[a].actionRates[b].upperBound-c[a].actionRates[b].lowerBound)/2*100;return Math.round(10*d)/10},a.specificActionCount=function(a,b,c){return c[a].actionCounts[b]&&isNaN(c[a].actionCounts[b].uniqueUserCount)?0:c[a].actionCounts[b].uniqueUserCount},a.specificImpressionCount=function(a,b){return isNaN(b[a].impressionCounts.uniqueUserCount)?0:b[a].impressionCounts.uniqueUserCount},a.specificActionImprovement=function(a,b,c){if(c.controlBucketLabel!==a)for(var d in c.statistics.buckets[a].bucketComparisons)if(c.statistics.buckets[a].bucketComparisons[d].otherLabel===c.controlBucketLabel){if(c.statistics.buckets[a].bucketComparisons[d].actionComparisons&&c.statistics.buckets[a].bucketComparisons[d].actionComparisons.hasOwnProperty(b)&&!isNaN(c.statistics.buckets[a].bucketComparisons[d].actionComparisons[b].actionRateDifference.estimate)){var e=100*c.statistics.buckets[a].bucketComparisons[d].actionComparisons[b].actionRateDifference.estimate;return Math.round(10*e)/10}return 0}},a.specificActionImprovementDiff=function(a,b,c){if(c.controlBucketLabel!==a)for(var d in c.statistics.buckets[a].bucketComparisons)if(c.statistics.buckets[a].bucketComparisons[d].otherLabel===c.controlBucketLabel){if(c.statistics.buckets[a].bucketComparisons[d].actionComparisons&&c.statistics.buckets[a].bucketComparisons[d].actionComparisons.hasOwnProperty(b)&&!isNaN(c.statistics.buckets[a].bucketComparisons[d].actionComparisons[b].actionRateDifference.estimate)){var e=100*(c.statistics.buckets[a].bucketComparisons[d].actionComparisons[b].actionRateDifference.upperBound-c.statistics.buckets[a].bucketComparisons[d].actionComparisons[b].actionRateDifference.lowerBound)/2;return Math.round(10*e)/10}return 0}},a.buildActionsTable=function(){var b=null;a.dataRows={Overall:[{value:"Action Rate",actionCountValue:"Unique Action Count",impressionCountValue:"",actionName:!0,overallValue:!0}]},a.orderedDataRows=[a.dataRows.Overall];var c={Metric:0},d=[],e={};a.headers=[{name:"Action Name"}];for(var f in a.experiment.statistics.buckets)if(a.experiment.statistics.buckets.hasOwnProperty(f)){if(b=a.experiment.statistics.buckets[f],b.label===a.experiment.controlBucketLabel){var g=b.label,h=a.getBucket(b.label,a.experiment);if(h.isBaseLine?g+=" (baseline)":h.isControl&&(g+=" (control)"),a.headers.splice(1,0,{name:g,title:g,width:"150px"}),c[b.label]=1,b.bucketComparisons&&moment().subtract(7,"days").isAfter(moment(a.experiment.startTime,["YYYY-MM-DDTHH:mm:ssZ","ddd MMM DD YYYY HH:mm:ss ZZ"])))for(var i in b.bucketComparisons)if(b.bucketComparisons.hasOwnProperty(i)){var j=b.bucketComparisons[i];if(j.actionComparisons)for(var k in j.actionComparisons)j.actionComparisons.hasOwnProperty(k)&&(k in e||(e[k]=[]),j.actionComparisons[k].clearComparisonWinner&&e[k].indexOf(j.actionComparisons[k].clearComparisonWinner)<0&&e[k].push(j.actionComparisons[k].clearComparisonWinner));j.jointActionComparison&&j.jointActionComparison.clearComparisonWinner===i}}else a.headers.push({name:b.label,title:b.label,width:"150px"}),c[b.label]=a.headers.length-1;for(var l in b.actionRates)b.actionRates.hasOwnProperty(l)&&d.indexOf(l)<0&&d.push(l)}var m=1;for(var n in a.experiment.statistics.buckets)if(a.experiment.statistics.buckets.hasOwnProperty(n)){b=a.experiment.statistics.buckets[n];var o=c[b.label];a.dataRows.Overall.splice(o,0,{value:a.actionRate(b.label,a.experiment.statistics.buckets),marginOfError:a.actionDiff(b.label,a.experiment.statistics.buckets),actionCountValue:a.bucketActionCount(b.label,a.experiment.statistics.buckets),impressionCountValue:"impressions: "+a.bucketImpressionCount(b.label,a.experiment.statistics.buckets),bucketCell:!0,overallValue:!0,actionName:!1});for(var p=0;p<d.length;p++){var q=d[p];if(q in a.dataRows||(a.dataRows[q]=[{value:q,actionCountValue:q,impressionCountValue:"",actionName:!0}],a.orderedDataRows.push(a.dataRows[q])),b.actionRates.hasOwnProperty(q)){if(o=c[b.label],a.dataRows[q].splice(o,0,{value:a.specificActionRate(b.label,q,a.experiment.statistics.buckets),marginOfError:a.specificActionDiff(b.label,q,a.experiment.statistics.buckets),actionCountValue:a.specificActionCount(b.label,q,a.experiment.statistics.buckets),impressionCountValue:"impressions: "+a.specificImpressionCount(b.label,a.experiment.statistics.buckets),bucketCell:!0,overallValue:!1,actionName:!1}),b.label!==a.experiment.controlBucketLabel){var r=!1,s=!1;e.hasOwnProperty(q)&&(e[q].indexOf(b.label)>=0?(a.dataRows[q][o].actionClass="actionWinner",a.dataRows[q][o].toolTip="This action is performing significantly better than control.",r=!0):e[q].indexOf(a.experiment.controlBucketLabel)>=0&&(a.dataRows[q][o].actionClass="actionLoser",a.dataRows[q][o].toolTip="This action is performing significantly worse than control.",s=!0))}}else a.dataRows[q].splice(o,0,{value:"0",actionCountValue:"0",impressionCountValue:"impressions: 0",bucketCell:!0})}m+=2}},a.refreshDialog=function(){a.loadApplicationStatistics()},a.getBucket=function(a,b){return k.getBucket(a,b)},a.closeBucket=function(b){j.open({templateUrl:"views/CloseBucketConfirmModal.html",controller:"CloseBucketConfirmModalCtrl",windowClass:"xxx-dialog",resolve:{bucketLabel:function(){return b}}}).result.then(function(){f.close({label:b,experimentId:i.experimentId}).$promise.then(function(){k.trackEvent("closeBucketSuccess",{key:"dialog_name",value:"closeBucketExperimentDetails"},{key:"experiment_id",value:i.experimentId},{key:"item_label",value:b}),a.loadBuckets()},function(a){k.handleGlobalError(a,"Your bucket could not be closed.")})})},a.bucketState=function(a){var b="";return a&&("CLOSED"!==a.state&&"EMPTY"!==a.state||(b="closed")),b},a.actionRate=function(a,b){return k.actionRate(a,b)},a.actionDiff=function(a,b){return k.actionDiff(a,b)},a.bucketActionCount=function(a,b){return isNaN(b[a].jointActionCounts.uniqueUserCount)?0:b[a].jointActionCounts.uniqueUserCount},a.bucketImpressionCount=function(a,b){return isNaN(b[a].impressionCounts.uniqueUserCount)?0:b[a].impressionCounts.uniqueUserCount},a.actionRateTotal=function(){if(a.experiment.statistics){if(isNaN(a.experiment.statistics.jointActionRate.estimate))return 0;var b=100*a.experiment.statistics.jointActionRate.estimate;return Math.round(10*b)/10}},a.actionDiffTotal=function(){if(a.experiment.statistics){if(isNaN(a.experiment.statistics.jointActionRate.estimate))return 0;var b=(a.experiment.statistics.jointActionRate.upperBound-a.experiment.statistics.jointActionRate.lowerBound)/2*100;return Math.round(10*b)/10}},a.improvementClass=function(a,b){return b.statistics.buckets[a].improvementClass},a.improvement=function(b){return k.improvement(b,a.experiment)},a.improvementDiff=function(b){return k.improvementDiff(b,a.experiment)},a.significance=function(b){return $.inArray(b,a.experiment.statistics.jointProgress.winnersSoFar)!==-1?"winner so far":$.inArray(b,a.experiment.statistics.jointProgress.losersSoFar)!==-1?"loser so far":"undetermined"},a.editSegmentation=function(){return a.rulesChangedNotSaved=!0,a.simpleRuleEditing?(a.disableRule(!1),a.data.disableAdvanced=!0,a.$digest(),$.extend(!0,[],a.rules)):($("#rule").removeClass("readOnly").attr("contentEditable","true").focus(),a.populateRuleControlsFromJSON(a.experiment.ruleJson),a.$digest(),$("#rule").html())},a.cancelSegmentation=function(b){a.rulesChangedNotSaved=a.checkForRule(),a.simpleRuleEditing?(a.rules=b,a.data.disableAdvanced=!1,a.disableRule(!0),a.$digest()):($("#rule").html(b).addClass("readOnly").removeAttr("contentEditable"),a.populateRuleControlsFromJSON(a.experiment.ruleJson),a.$digest())},a.saveSegmentation=function(b){var c=a.experiment;if(a.simpleRuleEditing){if(c.rule=a.convertRuleControlsToRuleString(),null===c.rule)return $("#segmentationToolbar .dynamicEdit").click(),!1;a.disableRule(!0),a.data.disableAdvanced=!1,a.$digest()}else c.rule=b,a.populateRuleControlsFromJSON(a.experiment.ruleJson),a.$digest();e.update({id:c.id,rule:c.rule}).$promise.then(function(){k.trackEvent("saveItemSuccess",{key:"dialog_name",value:"saveRuleFromDetails"},{key:"application_name",value:c.applicationName},{key:"item_id",value:c.id},{key:"item_label",value:c.label}),k.displaySuccessWithCacheWarning("Segmentation Rule Saved","Your segmentation rule change has been saved."),a.rulesChangedNotSaved=!a.simpleRuleEditing||a.checkForRule()},function(a){k.handleGlobalError(a)})},a.editResults=function(){return a.resultsChangedNotSaved=!0,a.data.resultsWidgetsDisabled=!1,a.$digest(),{results:a.experiment.results,hypothesisIsCorrect:a.experiment.hypothesisIsCorrect}},a.cancelResults=function(b){a.resultsChangedNotSaved=!1,a.data.resultsWidgetsDisabled=!0,a.experiment.results=b.results,a.experiment.hypothesisIsCorrect=b.hypothesisIsCorrect,a.$digest()},a.saveResults=function(){var b=a.experiment;a.data.resultsWidgetsDisabled=!0,a.$digest(),e.update({id:b.id,results:b.results,hypothesisIsCorrect:b.hypothesisIsCorrect}).$promise.then(function(){k.trackEvent("saveItemSuccess",{key:"dialog_name",value:"saveResultsFromDetails"},{key:"application_name",value:b.applicationName},{key:"item_id",value:b.id},{key:"item_label",value:b.label})},function(a){k.handleGlobalError(a)})},a.onDescriptionChange=function(){a.data.descriptionLength=$("#experimentDescription").text().length,a.$digest()},a.editDescription=function(){return $("#experimentDescription").removeClass("readOnly").attr("contentEditable","true").focus().on("input",function(){a.onDescriptionChange()}),a.experiment.description},a.cancelDescription=function(b){$("#experimentDescription").html(b).addClass("readOnly").removeAttr("contentEditable"),a.onDescriptionChange()},a.saveDescription=function(b){var c=$.trim(b);if(c.length>256||c.length<=0)return c.length<=0?n.alertDialog("You must provide a hypothesis/description.","Missing Hypothesis/Description",function(){}):n.alertDialog("The hypothesis/description must be 256 characters or less.","Hypothesis/Description Too Long",function(){}),$("#descriptionToolbar .dynamicEdit").click(),!1;if(c.length<=0)return n.alertDialog("You must provide a hypothesis/description.","Missing Hypothesis/Description",function(){}),$("#descriptionToolbar .dynamicEdit").click(),!1;var d=a.experiment;d.description=b,e.update({id:d.id,description:d.description}).$promise.then(function(){k.trackEvent("saveItemSuccess",{key:"dialog_name",value:"saveDescrFromDetails"},{key:"application_name",value:d.applicationName},{key:"item_id",value:d.id},{key:"item_label",value:d.label}),a.rulesChangedNotSaved=!a.simpleRuleEditing||a.checkForRule()},function(a){k.handleGlobalError(a)})},a.editTags=function(){return a.data.tagWidgetsDisabled=!1,a.$digest(),a.experiment.tags},a.cancelTags=function(){a.transferTags(!0),a.data.tagWidgetsDisabled=!0,a.$digest()},a.saveTags=function(){var b=a.experiment;a.transferTags(!1),e.update({id:b.id,tags:b.tags}).$promise.then(function(){k.trackEvent("saveItemSuccess",{key:"dialog_name",value:"saveTagsFromDetails"},{key:"application_name",value:b.applicationName},{key:"item_id",value:b.id},{key:"item_label",value:b.label}),a.data.tagWidgetsDisabled=!0},function(b){k.handleGlobalError(b),a.data.tagWidgetsDisabled=!0})},a.openChangeSamplingModal=function(b){j.open({templateUrl:"views/ChangeSamplingModal.html",controller:"ChangeSamplingModalCtrl",windowClass:"xxx-dialog",resolve:{experiment:function(){return{samplingPercent:b}}}}).result.then(function(b){e.update({id:i.experimentId,samplingPercent:b.samplingPercent}).$promise.then(function(){k.trackEvent("updateItemSuccess",{key:"dialog_name",value:"updateSamplingPercent"},{key:"experiment_id",value:i.experimentId},{key:"item_value",value:b.samplingPercent}),k.displaySuccessWithCacheWarning("Sampling Percentage Changed","Your new sampling percentage has been saved."),a.loadExperiment()},function(a){k.handleGlobalError(a,"Your sampling percentage could not be changed.")})})},a.openGetAssignmentsModal=function(){j.open({templateUrl:"views/GetAssignmentsModal.html",controller:"GetAssignmentsModalCtrl",windowClass:"xxx-dialog",resolve:{experiment:function(){return a.experiment}}}).result.then(function(){})},a.openChangeRapidExperiment=function(){j.open({templateUrl:"views/ChangeRapidExperiment.html",controller:"ChangeRapidExperimentCtrl",windowClass:"xxx-dialog",resolve:{experiment:function(){return{isRapidExperiment:a.experiment.isRapidExperiment,userCap:a.experiment.isRapidExperiment?a.experiment.userCap:""}}}}).result.then(function(b){e.update({id:i.experimentId,isRapidExperiment:b.isRapidExperiment,userCap:b.userCap}).$promise.then(function(){k.trackEvent("updateItemSuccess",{key:"dialog_name",value:"updateSamplingPercent"},{key:"experiment_id",value:i.experimentId},{key:"item_value",value:b.samplingPercent}),k.displaySuccessWithCacheWarning("Rapid Experiment Settings Changed","Your rapid experiment settings have been saved."),a.loadExperiment()},function(a){k.handleGlobalError(a,"Your rapid experiment settings could not be changed.")})})},a.openChangeEndTimeModal=function(b){j.open({templateUrl:"views/ChangeDateModal.html",controller:"ChangeDateModalCtrl",windowClass:"xxx-dialog",resolve:{experiment:function(){return{endTime:moment(b,["YYYY-MM-DDTHH:mm:ssZ","ddd MMM DD YYYY HH:mm:ss ZZ"]).format("YYYY-MM-DDTHH:mm:ssZZ"),startTime:a.experiment.startTime}}}}).result.then(function(b){e.update({id:i.experimentId,
endTime:moment(b.endTime,["YYYY-MM-DDTHH:mm:ssZ","ddd MMM DD YYYY HH:mm:ss ZZ"]).format("YYYY-MM-DDTHH:mm:ssZZ")}).$promise.then(function(){k.trackEvent("updateItemSuccess",{key:"dialog_name",value:"updateEndDate"},{key:"experiment_id",value:i.experimentId},{key:"item_value",value:b.endTime}),k.displaySuccessWithCacheWarning("End Date Changed","Your new end date has been saved."),a.loadExperiment()},function(a){k.handleGlobalError(a,"Your experiment end date could not be changed.")})})},a.openBucketModal=function(b,c,d,e){var g=j.open({templateUrl:"views/BucketModal.html",controller:"BucketModalCtrl",windowClass:"xxx-dialog",backdrop:"static",resolve:{bucket:function(){return c?f.show({experimentId:b,bucketLabel:c}):[]},buckets:function(){return[]},isEditInDetails:function(){return!0},isCreateBucket:function(){return!1},isNoControl:function(){return!1},bucketStatistics:function(){return{actionCounts:d.jointActionCounts.eventCount,impressionCounts:d.impressionCounts.eventCount}},experimentId:function(){return b},readOnly:function(){return e}}});g.result.then(function(){k.displaySuccessWithCacheWarning("Bucket Saved","Your bucket changes have been saved."),a.loadBuckets()})},a.openEditRunningBucketsModal=function(b){var c="Editing buckets while an experiment is running or stopped is not advisable. This will make the analytics unreliable and we cannot guarantee a good AB Test result at the end of the experiment. These changes cannot be undone and please make sure you understand the risks before you proceed.";a.supportEmail&&a.supportEmail.length>0&&(c+=" If you need further assistance, hit Cancel and contact us at "+a.supportEmail+"."),n.confirmDialog(c,"Warning",function(){var c=j.open({templateUrl:"views/BucketAssignmentModal.html",controller:"BucketAssignmentModalCtrl",windowClass:"xxx-dialog",backdrop:"static",resolve:{buckets:function(){return a.experiment.buckets},experiment:function(){return b}}});c.result.then(function(){a.loadBuckets()})},function(){})},a.exitDialog=function(){return history.back(),!1},a.openSegmentationTestModal=function(){var b=j.open({templateUrl:"views/SegmentationTestModal.html",controller:"SegmentationTestModalCtrl",windowClass:"xxx-dialog",backdrop:"static",resolve:{experiment:function(){return a.experiment},rules:function(){return a.rules}}});b.result.then(function(){})},a.openResultsModal=function(){k.openResultsModal(a.experiment,a.readOnly,a.loadExperiment)},a.openPluginModal=function(b){k.openPluginModal(b,a.experiment)},a.transferTagsToReadOnly=function(){if(a.tagsStr="",a.experiment&&a.experiment.tags)for(var b=0;b<a.experiment.tags.length;b++)a.tagsStr+=a.experiment.tags[b]+(b<a.experiment.tags.length-1?", ":"")},a.loadAllTags=function(){k.loadAllTags(a,!0)},a.queryTags=function(b){return k.queryTags(b,a.allTags)},a.transferTags=function(b){k.transferTags(b,a),a.transferTagsToReadOnly()},a.loadExperiment(),a.loadAllTags()}]),angular.module("wasabi.controllers").controller("ChangeSamplingModalCtrl",["$scope","$uibModalInstance","experiment",function(a,b,c){a.experiment=c,a.experimentFormSubmitted=!1,a.ok=function(c){c?a.experimentFormSubmitted=!0:b.close(a.experiment)},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("wasabi.controllers").controller("ChangeDateModalCtrl",["$scope","$uibModalInstance","experiment","DialogsFactory",function(a,b,c,d){a.experiment=c,a.experimentFormSubmitted=!1,a.originalEndTime=moment(c.endTime,["YYYY-MM-DDTHH:mm:ssZ","ddd MMM DD YYYY HH:mm:ss ZZ"]),a.ok=function(c){c?a.experimentFormSubmitted=!0:moment(a.experiment.endTime,["YYYY-MM-DDTHH:mm:ssZ","ddd MMM DD YYYY HH:mm:ss ZZ"]).isBefore(a.originalEndTime)?d.confirmDialog("You are about to end the experiment early. Are you sure you want to do this?","Warning",function(){b.close(a.experiment)},function(){}):b.close(a.experiment)},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("wasabi.controllers").controller("MutualExclusionsCtrl",["$scope","$filter","$http","MutualExclusionsFactory","$uibModal","UtilitiesFactory","DialogsFactory","PERMISSIONS","ConfigFactory","AUTH_EVENTS",function(a,b,c,d,e,f,g,h,i,j){a.excludedExperiments=[],a.nonExpiredExcludedExperiments=[],a.filterNonExpiredExperiments=function(){a.nonExpiredExcludedExperiments=f.filterNonExpiredExperiments(a.excludedExperiments)},a.loadMutualExclusions=function(){a.experiment.id&&d.query({experimentId:a.experiment.id,exclusiveFlag:!0}).$promise.then(function(b){a.excludedExperiments=b,a.filterNonExpiredExperiments()},function(a){f.handleGlobalError(a,"The list of mutual exclusions could not be retrieved.")})},a.loadMutualExclusions(),a.stateImgUrl=function(a){return f.stateImgUrl(a)},a.stateName=function(a){return f.stateName(a)},a.capitalizeFirstLetter=function(a){return f.capitalizeFirstLetter(a)},a.deleteMutualExclusion=function(b){g.confirmDialog("Delete mutual exclusion with experiment "+b.label+"?","Delete Mutual Exclusion",function(){d.delete({experimentId1:a.experiment.id,experimentId2:b.id}).$promise.then(function(){f.trackEvent("deleteItemSuccess",{key:"dialog_name",value:"deleteMutualExclusion"},{key:"experiment_id",value:a.experiment.id},{key:"item_id",value:b.id}),f.displaySuccessWithCacheWarning("Mutual Exclusions Deleted","Your mutual exclusion changes have been saved."),a.loadMutualExclusions()},function(a){f.handleGlobalError(a,"Your mutual exclusion could not be deleted.")})})},a.openMutualExclusionModal=function(b){var c=e.open({templateUrl:"views/MutualExclusionModal.html",controller:"MutualExclusionModalCtrl",windowClass:"larger-dialog",backdrop:"static",size:"lg",resolve:{experiments:function(){return d.query({experimentId:a.experiment.id,exclusiveFlag:!1})},experimentId:function(){return b},excludedExperiments:function(){return a.excludedExperiments}}});f.failIfTokenExpired(c),c.result.then(function(){a.loadMutualExclusions()})},a.hasUpdatePermission=function(b){return!a.openedFromModal&&f.hasPermission(b.applicationName,h.updatePerm)},a.openExperimentModal=function(b){var c=e.open({templateUrl:"views/ExperimentModal.html",controller:"ExperimentModalCtrl",windowClass:"xxxx-dialog",backdrop:"static",resolve:{experiment:function(){return b},experiments:function(){return a.experiments},readOnly:function(){return!0},openedFromModal:function(){return!0},applications:function(){return[b.applicationName]},allApplications:function(){return[]}}});f.failIfTokenExpired(c),a.$on(j.notAuthenticated,function(){c.close()}),c.result.then(function(){})}}]),angular.module("wasabi.controllers").controller("MutualExclusionModalCtrl",["$scope","$filter","$uibModalInstance","MutualExclusionsFactory","experiments","experimentId","UtilitiesFactory",function(a,b,c,d,e,f,g){a.data={searchField:"",selectAll:!1},a.experiments=e,a.nonExpiredExperiments=e,a.mutualExclusionFormSubmitted=!1,a.orderByField="label",a.reverseSort=!1,a.filteredItems=[],a.postSubmitError=null,a.stateImgUrl=function(a){return g.stateImgUrl(a)},a.stateName=function(a){return g.stateName(a)},a.capitalizeFirstLetter=function(a){return g.capitalizeFirstLetter(a)},a.filterNonExpiredExperiments=function(){a.nonExpiredExperiments=g.filterNonExpiredExperiments(a.experiments)};var h=function(a,b){return!b||a.toLowerCase().indexOf(b.toLowerCase())!==-1};a.search=function(){a.filteredItems=b("filter")(a.nonExpiredExperiments,function(b){for(var c in b)if(b[c]&&"function"!=typeof b[c]&&h(b[c].toString(),a.data.searchField))return!0;return!1}),""!==a.orderByField&&(a.filteredItems=b("orderBy")(a.filteredItems,a.orderByField,a.reverseSort))},a.selectAllNone=function(){a.filteredItems.forEach(function(b){b.selected=a.data.selectAll})},e.$promise.then(function(){a.filterNonExpiredExperiments(),a.search()}),a.saveMutualExclusion=function(){for(var b=[],h=0;h<e.length;h++)e[h].selected&&b.push(e[h].id);b.length?d.create({experimentId:f,experimentIDs:b}).$promise.then(function(a){g.trackEvent("saveItemSuccess",{key:"dialog_name",value:"addMutualExclusion"},{key:"experiment_id",value:f}),a&&a.exclusions&&a.exclusions.forEach(function(a){"FAILED"===a.status&&g.displayPageError("Unable to Create Mutual Exclusion","At least one of your experiments could not be made mutually exclusive with this one, possibly due to an experiment being expired.")}),g.displaySuccessWithCacheWarning("Mutual Exclusions Saved","Your mutual exclusion changes have been saved."),c.close()},function(b){a.mutualExclusionFormSubmitted=!0,a.postSubmitError="genericSubmitError","unauthenticated"===g.extractErrorFromResponse(b)?c.close():g.handleGlobalError(b)}):c.close()},a.cancel=function(){c.dismiss("cancel")}}]),angular.module("wasabi.controllers").controller("PrioritiesCtrl",["$scope","$filter","$http","$stateParams","PrioritiesFactory","$uibModal","UtilitiesFactory","$rootScope","DialogsFactory","AUTH_EVENTS","$state","PERMISSIONS","ConfigFactory","ApplicationsFactory","ExperimentsFactory","$cookies","FavoritesFactory",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){a.data={applicationName:"",hidePaused:!1,editingSampling:!1},a.experiments=[],a.appNames=[],a.favoritesObj={favorites:null},a.applicationName=d.appname,a.allApplications=[],a.noDrag=!1,a.readOnly=!1,a.help=m.help,a.appNames=g.getAppsWithAnyPermissions(),g.hideHeading(!1),g.selectTopLevelTab("Priority"),a.changePage=function(b){void 0!==b&&(a.data.applicationName=b),a.data.applicationName&&a.data.applicationName===d.appname||(p.wasabiDefaultApplication=a.data.applicationName,k.go("priorities",{appname:a.data.applicationName}))},a.hasDeletePermission=function(a){return g.hasPermission(a.applicationName,l.deletePerm)},a.hasUpdatePermission=function(a){return g.hasPermission(a,l.updatePerm)},a.openResultsModal=function(b){g.openResultsModal(b,!1,a.loadPrioritiesAfterAction)},a.changeState=function(b,c){var d={PAUSED:a.openResultsModal,RUNNING:function(){g.displaySuccessWithCacheWarning("Experiment Started","Your experiment has been successfully started."),a.loadPrioritiesAfterAction()},TERMINATED:a.loadPrioritiesAfterAction};g.changeState(b,c,d)},a.deleteExperiment=function(b){g.deleteExperiment(b,a.loadPrioritiesAfterAction)},a.doFavorites=function(){q.query().$promise.then(function(b){a.favoritesObj.favorites=b&&b.experimentIDs?b.experimentIDs:[];for(var c=0;c<a.experiments.length;c++)a.experiments[c].isFavorite=a.favoritesObj.favorites.indexOf(a.experiments[c].id)>=0},function(a){g.handleGlobalError(a,"The list of favorites could not be retrieved.")})},a.loadAllApplications=function(){n.query().$promise.then(function(b){if(b){a.allApplications=[];for(var c=0;c<b.length;c++){for(var d=!1,e=0;e<a.applications.length;e++)if(b[c].applicationName===a.applications[e]){d=!0;break}d||a.allApplications.push(b[c].applicationName)}}},function(a){g.handleGlobalError(a,"The list of applications could not be retrieved.")})},a.loadPrioritiesAfterAction=function(){a.onSelectAppName(a.applicationName)},a.onSelectAppName=function(b){b&&(a.applicationName=p.wasabiDefaultApplication=b,a.noDrag=a.readOnly=!a.hasUpdatePermission(b),g.startSpin(),e.query({applicationName:b}).$promise.then(function(c){a.experiments=c,a.doFavorites(),g.doTrackingInit(),g.trackEvent("loadedDialog",{key:"dialog_name",value:"prioritiesList"},{key:"application_name",value:b})},function(a){g.handleGlobalError(a,"The list of priorities could not be retrieved.")}).finally(function(){g.stopSpin()}))},1===a.appNames.length&&a.changePage(a.appNames[0]),!a.applicationName&&p.wasabiDefaultApplication&&(a.applicationName=p.wasabiDefaultApplication),a.data.applicationName=a.applicationName,a.data.applicationName&&a.changePage(),a.$watch(function(){return a.appNames.length},function(){0!==a.appNames.length&&a.$evalAsync(function(){for(var b=0,c=!1,d=0;d<a.appNames.length;d++)a.appNames[d]===a.applicationName&&(c=!0,b=d+1);c?($("#applicationNameChoice").prop("selectedIndex",b),a.onSelectAppName(a.applicationName)):(p.wasabiDefaultApplication="",a.data.applicationName="")})}),a.editSamplingPercentages=function(){a.originalPercentages=[];for(var b=0;b<a.experiments.length;b++)a.originalPercentages.push({id:a.experiments[b].id,label:a.experiments[b].label,samplingPercent:a.experiments[b].samplingPercent});return a.data.editingSampling=!0,!1},a.saveSamplingChanges=function(){return i.confirmDialog("Update your changed sampling percentages?","Change Sampling Percentages",function(){function b(a){g.trackEvent("saveItemSuccess",{key:"dialog_name",value:"prioritiesSamplingPercentageChanges"},{key:"application_name",value:a.applicationName},{key:"item_id",value:a.id},{key:"item_label",value:a.samplingPercent})}function c(a){g.handleGlobalError(a,"Your experiment sampling percentage could not be changed.")}a.data.editingSampling=!1;for(var d=!1,e=0;e<a.experiments.length;e++)for(var f=0;f<a.originalPercentages.length;f++)a.originalPercentages[e].label===a.experiments[f].label&&a.originalPercentages[e].samplingPercent!==a.experiments[f].samplingPercent&&(o.update({id:a.experiments[f].id,samplingPercent:a.experiments[f].samplingPercent}).$promise.then(b,c),d=!0);d&&g.displaySuccessWithCacheWarning("Sampling Percentages Changed","Your sampling percentage changes have been saved.")},function(){a.data.editingSampling=!0},"Save","Cancel"),!1},a.cancelSamplingChanges=function(){a.data.editingSampling=!1;for(var b=0;b<a.experiments.length;b++)for(var c=0;c<a.originalPercentages.length;c++)a.originalPercentages[b].label===a.experiments[c].label&&a.originalPercentages[b].samplingPercent!==a.experiments[c].samplingPercent&&(a.experiments[c].samplingPercent=a.originalPercentages[b].samplingPercent);return!1},a.stateImgUrl=function(a){return g.stateImgUrl(a)},a.stateName=function(a){return g.stateName(a)},a.capitalizeFirstLetter=function(a){return g.capitalizeFirstLetter(a)},a.openExperimentDescriptionModal=function(a){i.alertDialog(a.description,a.label,function(){})},a.openExperimentModal=function(b){var c=f.open({templateUrl:"views/ExperimentModal.html",controller:"ExperimentModalCtrl",windowClass:"xx-dialog",backdrop:"static",resolve:{experiment:function(){return b},experiments:function(){return a.experiments},favoritesObj:function(){return a.favoritesObj},readOnly:function(){return!1},openedFromModal:function(){return!1},applications:function(){var b=a.appNames.slice(0);return b.push(m.newApplicationNamePrompt),b}}});g.failIfTokenExpired(c),a.$on(j.notAuthenticated,function(){c.close()}),c.result.then(function(){g.updatePermissionsAndAppList(function(b){a.applications=b,a.onSelectAppName(a.applicationName)})})}}]),angular.module("wasabi.controllers").controller("UsersCtrl",["$scope","$filter","$http","$uibModal","UtilitiesFactory","$rootScope","StateFactory","DialogsFactory","AUTH_EVENTS","AuthzFactory","Session",function(a,b,c,d,e,f,g,h,i,j,k){a.data={query:""},a.orderByField="userID",a.reverseSort=!1,a.itemsPerPage=10,a.pagedItems=[],a.groupedItems=[],a.filteredItems=[],a.totalItems=a.filteredItems.length,a.currentPage=g.currentUsersPage,a.currentUser=k.userID,a.users=[],a.administeredApplications=[],a.appNames=[],a.loadAdministeredApplications=function(){a.administeredApplications=e.getAdministeredApplications(),a.loadUsers()},a.loadUsers=function(b){var c=[];e.startSpin(),j.getUsersRoles().$promise.then(function(d){if(d&&d.length>0)for(var e=0;e<d.length;e++)if(d[e].roleList.length>0)for(var f=0;f<d[e].roleList.length;f++){var g=d[e].roleList[f],h=!1;if(g.userID!==a.currentUser){for(var i=0;i<c.length;i++)if(g.userID===c[i].userID){c[i].applications.push({label:g.applicationName,role:g.role}),c[i].formattedApplications+=","+g.applicationName,h=!0;break}h||c.push({userID:g.userID,firstName:g.firstName,lastName:g.lastName,userEmail:g.userEmail,applications:[{label:g.applicationName,role:g.role}],formattedApplications:g.applicationName})}}a.users=c,a.applySearchSortFilters(void 0!==b)},function(a){e.handleGlobalError(a,"The list of user roles could not be retrieved.")}).finally(function(){e.stopSpin()})},a.applySearchSortFilters=function(b){b?a.sortBy(a.orderByField,a.reverseSort):a.search(a.currentPage)},e.hideHeading(!1),e.selectTopLevelTab("Users"),a.removeUser=function(b){h.confirmDialog("Remove all permissions from user "+b.userID+"?","Remove User",function(){function c(b,c,f){--d,0===d&&a.loadUsers(),f&&e.trackEvent("deleteRolesSuccess",{key:"dialog_name",value:"deleteAllRolesFromUser"},{key:"application_name",value:c},{key:"item_id",value:b.userID},{key:"item_role",value:"ALL_ROLES"})}var d=b.applications.length;b.applications.forEach(function(a){j.deleteRoleForApplication({appName:a.label,userID:b.userID}).$promise.then(function(){c(b,a.label,!0)},function(d){c(b,a.label,!1),e.handleGlobalError(d,"The role could not be deleted for the user.")})})})},a.capitalizeFirstLetter=function(a){return e.capitalizeFirstLetter(a)},a.sortBy=function(b,c){a.orderByField===b&&(a.reverseSort=!a.reverseSort),c&&(a.reverseSort=c),a.orderByField=b,a.search(a.currentPage)};var l=function(a,b){return!b||a.toLowerCase().indexOf(b.toLowerCase())!==-1};a.search=function(c){a.filteredItems=b("filter")(a.users,function(b){for(var c in b)if(b[c]&&b.hasOwnProperty(c)&&"function"!=typeof b[c]&&"$$hashKey"!==c&&"id"!==c&&c.toLowerCase().indexOf("time")<0&&l(b[c].toString(),a.data.query))return!0;return!1}),""!==a.orderByField&&(a.filteredItems=e.sortByHeadingValue(a.filteredItems,a.orderByField,a.reverseSort)),c?a.currentPage=g.currentUsersPage=c:a.currentPage=g.currentUsersPage=1,a.groupToPages(),a.totalItems=a.filteredItems.length,e.doTrackingInit()},a.groupToPages=function(){a.pagedItems=[];for(var b=0;b<a.filteredItems.length;b++)b%a.itemsPerPage===0?a.pagedItems[Math.floor(b/a.itemsPerPage)]=[a.filteredItems[b]]:a.pagedItems[Math.floor(b/a.itemsPerPage)].push(a.filteredItems[b])},a.range=function(a,b){var c=[];b||(b=a,a=0);for(var d=a;d<b;d++)c.push(d);return c},a.pageChanged=function(){g.currentUsersPage=a.currentPage},a.pageRangeStart=function(){try{return 1===a.currentPage?0===a.pagedItems[a.currentPage-1].length?0:1:(a.currentPage-1)*a.itemsPerPage+1}catch(a){return 0}},a.pageRangeEnd=function(){try{return a.pageRangeStart()+a.pagedItems[a.currentPage-1].length-1}catch(a){return 0}},a.refreshSearch=function(){a.search(),a.$digest()},a.userHasRole=function(a,b){return e.userHasRole(a,b)},a.loadAdministeredApplications(),a.openUserModal=function(b){var c=d.open({templateUrl:"views/UserModal.html",controller:"UserModalCtrl",windowClass:"xx-dialog",backdrop:"static",resolve:{user:function(){if(b)return b},administeredApplications:function(){return a.administeredApplications}}});e.failIfTokenExpired(c),a.$on(i.notAuthenticated,function(){c.close()}),c.result.then(function(){a.loadUsers()})}}]),angular.module("wasabi.controllers").controller("UserModalCtrl",["$scope","$uibModalInstance","AuthFactory","AuthzFactory","user","administeredApplications","UtilitiesFactory","$rootScope","$uibModal","AUTH_EVENTS","DialogsFactory",function(a,b,c,d,e,f,g,h,i,j,k){g.trackEvent("loadedDialog",{key:"dialog_name",value:"createOrEditUser"}),a.data={userEmail:""},a.user=e,a.userFormSubmitted=!1,a.userValidated=void 0!==e&&null!==e,a.validating=!1,a.failedValidation=!1,a.userHasRolesForAllApps=!1,a.administeredApplications=f,a.applications=[],a.appsThatCanBeAdded=[],a.postSubmitError=null,a.modalInstance=this._isTesting===!0?null:b,a.verifyFormNoValueError=!1,a.stateImgUrl=function(a){return g.stateImgUrl(a)},a.updateApplicationList=function(b){d.getUserRoles({userId:b}).$promise.then(function(b){b&&(a.applications=[],b.forEach(function(b){a.applications.push({label:b.applicationName,role:b.role})}),a.user.applications=a.applications,a.appsThatCanBeAdded=g.filterAppsForUser(a.administeredApplications,a.applications),a.userHasRolesForAllApps=a.appsThatCanBeAdded&&0===a.appsThatCanBeAdded.length)},function(a){g.handleGlobalError(a,"The roles for this user could not be retrieved.")})},a.verifyUser=function(){return 0===a.data.userEmail.length?void(a.verifyFormNoValueError=!0):(a.verifyFormNoValueError=!1,a.validating=!0,a.userValidated=!1,a.failedValidation=!1,void c.checkValidUser({email:a.data.userEmail}).$promise.then(function(b){a.validating=!1,b&&(a.user={},a.user.userID=b.username?b.username:"",a.user.firstName=b.firstName?b.firstName:"",a.user.lastName=b.lastName?b.lastName:"",a.user.email=b.email?b.email:"",a.userValidated=!0,a.updateApplicationList(a.user.userID))},function(){a.failedValidation=!0}))},a.user&&a.userValidated&&(a.applications=a.user.applications&&a.user.applications.length>0?a.user.applications:[],a.appsThatCanBeAdded=g.filterAppsForUser(a.administeredApplications,a.applications),a.userHasRolesForAllApps=a.appsThatCanBeAdded&&0===a.appsThatCanBeAdded.length),a.removeRole=function(b){k.confirmDialog("Remove all permissions from user "+a.user.userID+" for "+b.label+"?","Remove Permissions",function(){d.deleteRoleForApplication({appName:b.label,userID:a.user.userID}).$promise.then(function(){a.applications=$.grep(a.applications,function(a){return a.label!==b.label}),a.appsThatCanBeAdded=g.filterAppsForUser(a.administeredApplications,a.applications),a.userHasRolesForAllApps=a.appsThatCanBeAdded&&0===a.appsThatCanBeAdded.length,g.trackEvent("deleteRolesSuccess",{key:"dialog_name",value:"deleteApplicationRoleFromUser"},{key:"application_name",value:b.label},{key:"item_id",value:a.user.userID},{key:"item_role",value:"ALL_ROLES"})},function(a){g.handleGlobalError(a,"The role could not be deleted for the user.")})})},a.userHasRoleForApplication=function(a,b,c){return g.userHasRoleForApplication(a,b,c)},a.closeDialog=function(){b.close()},a.openAddApplicationModal=function(b){if(!a.userValidated)return!1;var c=i.open({templateUrl:"views/AddApplicationModal.html",controller:"AddApplicationModalCtrl",windowClass:"larger-dialog",backdrop:"static",resolve:{user:function(){if(b)return b},applications:function(){return a.applications},application:function(){return null},administeredApplications:function(){return a.administeredApplications},isEditingPermissions:function(){return!1},appsThatCanBeAdded:function(){return a.appsThatCanBeAdded}}});return g.failIfTokenExpired(c),a.$on(j.notAuthenticated,function(){c.close()}),c.result.then(function(){a.updateApplicationList(a.user.userID)}),!1},a.openEditUserPermissionsModal=function(b){if(!a.userValidated)return!1;var c=i.open({templateUrl:"views/AddApplicationModal.html",controller:"AddApplicationModalCtrl",windowClass:"larger-dialog",backdrop:"static",resolve:{user:function(){if(a.user)return a.user},applications:function(){return a.applications},application:function(){return b},administeredApplications:function(){return a.administeredApplications},isEditingPermissions:function(){return!0},appsThatCanBeAdded:function(){return a.appsThatCanBeAdded}}});return g.failIfTokenExpired(c),a.$on(j.notAuthenticated,function(){c.close()}),c.result.then(function(){a.updateApplicationList(a.user.userID)}),!1}}]),angular.module("wasabi.controllers").controller("AddApplicationModalCtrl",["$scope","$filter","$uibModalInstance","applications","administeredApplications","appsThatCanBeAdded","user","UtilitiesFactory","isEditingPermissions","application","AuthzFactory",function(a,b,c,d,e,f,g,h,i,j,k){a.data={searchField:"",addWritePrivileges:!1,addAdminPrivileges:!1},a.user=g,a.application=j,a.applications=d,a.administeredApplications=e,a.appsThatCanBeAdded=f,a.addApplicationFormSubmitted=!1,a.orderByField="label",a.reverseSort=!1,a.filteredItems=[],a.postSubmitError=null,a.isEditingPermissions=i,a.stateImgUrl=function(a){return h.stateImgUrl(a)},a.capitalizeFirstLetter=function(a){return h.capitalizeFirstLetter(a)};var l=function(a,b){return!b||a.toLowerCase().indexOf(b.toLowerCase())!==-1};a.search=function(){a.filteredItems=b("filter")(a.appsThatCanBeAdded,function(b){for(var c in b)if(b[c]&&"function"!=typeof b[c]&&l(b[c].toString(),a.data.searchField))return!0;return!1}),""!==a.orderByField&&(a.filteredItems=b("orderBy")(a.filteredItems,a.orderByField,a.reverseSort))},a.isEditingPermissions?(a.data.addWritePrivileges="READWRITE"===j.role||"ADMIN"===j.role,a.data.addAdminPrivileges="ADMIN"===j.role):a.search(),a.saveAddApplication=function(){if(a.isEditingPermissions)k.assignRole({roleList:[{applicationName:a.application.label,role:a.data.addAdminPrivileges?"ADMIN":a.data.addWritePrivileges?"READWRITE":"READONLY",userID:a.user.userID}]}).$promise.then(function(){c.close(),h.trackEvent("saveRolesSuccess",{key:"dialog_name",value:"addApplicationToUserDialog"},{key:"application_name",value:a.application.label},{key:"item_id",value:a.user.userID},{key:"item_role",value:a.data.addAdminPrivileges?"ADMIN":a.data.addWritePrivileges?"READWRITE":"READONLY"})},function(a){h.handleGlobalError(a,"The role could not be added."),"unauthenticated"===h.extractErrorFromResponse(a)&&c.close()});else{for(var b=[],d=0;d<a.appsThatCanBeAdded.length;d++)a.appsThatCanBeAdded[d].selected&&b.push(a.appsThatCanBeAdded[d].label);if(b.length){var e={roleList:[]};b.forEach(function(b){e.roleList.push({applicationName:b,role:a.data.addAdminPrivileges?"ADMIN":a.data.addWritePrivileges?"READWRITE":"READONLY",userID:a.user.userID})}),k.assignRole(e).$promise.then(function(){c.close(e),e.roleList.forEach(function(b){h.trackEvent("saveRolesSuccess",{key:"dialog_name",value:"addMultApplicationsToUserDialog"},{key:"application_name",value:b.applicationName},{key:"item_id",value:a.user.userID},{key:"item_role",value:b.role})})},function(a){h.handleGlobalError(a,"The role could not be added."),"unauthenticated"===h.extractErrorFromResponse(a)&&c.close()})}else c.close()}},a.cancel=function(){c.dismiss("cancel")}}]),angular.module("wasabi.controllers").controller("EditApplicationModalCtrl",["$scope","$uibModalInstance","AuthzFactory","application",function(a,b,c,d){a.application=d,a.closeDialog=function(){b.close()}}]),angular.module("wasabi.controllers").controller("EditApplicationOnPageCtrl",["$scope","AuthzFactory","UtilitiesFactory","$rootScope","$uibModal","AUTH_EVENTS","DialogsFactory","$filter","StateFactory","Session",function(a,b,c,d,e,f,g,h,i,j){c.trackEvent("loadedDialog",{key:"dialog_name",value:"editApplication"}),a.data={query:""},a.userFormSubmitted=!1,a.users=[],a.administeredApplications=[],a.postSubmitError=null,a.orderByField="userID",a.reverseSort=!1,a.itemsPerPage=10,a.filteredItems=[],a.pagedItems=[],a.totalItems=a.filteredItems.length,a.currentPage=i.currentUsersInApplicationPage,a.currentUser=j.userID,a.loadAdministeredApplications=function(){a.administeredApplications=c.getAdministeredApplications(),a.loadUsers()},a.loadUsers=function(d){b.getUsersForApplication({appName:a.application.label}).$promise.then(function(b){b&&(a.users=[],b.forEach(function(b){b.userID!==a.currentUser&&a.users.push({userID:b.userID,firstName:b.firstName,lastName:b.lastName,userEmail:b.userEmail,applications:[{label:b.applicationName,role:b.role}]})}),a.applySearchSortFilters(void 0!==d))},function(b){a.users=[],c.handleGlobalError(b,"The list of user roles could not be retrieved.")})},a.userHasRole=function(a,b){return c.userHasRole(a,b)},a.applySearchSortFilters=function(b){b?a.sortBy(a.orderByField,a.reverseSort):a.search(a.currentPage)},a.sortBy=function(b,c){a.orderByField===b&&(a.reverseSort=!a.reverseSort),c&&(a.reverseSort=c),a.orderByField=b,a.search(a.currentPage)};var k=function(a,b){return!b||a.toLowerCase().indexOf(b.toLowerCase())!==-1};a.search=function(b){a.filteredItems=h("filter")(a.users,function(b){for(var c in b)if(b[c]&&b.hasOwnProperty(c)&&"function"!=typeof b[c]&&"$$hashKey"!==c&&"id"!==c&&c.toLowerCase().indexOf("time")<0&&k(b[c].toString(),a.data.query))return!0;return!1}),""!==a.orderByField&&(a.filteredItems=c.sortByHeadingValue(a.filteredItems,a.orderByField,a.reverseSort)),b?a.currentPage=i.currentUsersPage=b:a.currentPage=i.currentUsersPage=1,a.groupToPages(),a.totalItems=a.filteredItems.length,c.doTrackingInit()},a.groupToPages=function(){a.pagedItems=[];for(var b=0;b<a.filteredItems.length;b++)b%a.itemsPerPage===0?a.pagedItems[Math.floor(b/a.itemsPerPage)]=[a.filteredItems[b]]:a.pagedItems[Math.floor(b/a.itemsPerPage)].push(a.filteredItems[b])},a.loadAdministeredApplications(),a.pageChanged=function(){i.currentUsersPage=a.currentPage},a.pageRangeStart=function(){try{return 1===a.currentPage?0===a.pagedItems[a.currentPage-1].length?0:1:(a.currentPage-1)*a.itemsPerPage+1}catch(a){return 0}},a.pageRangeEnd=function(){try{return a.pageRangeStart()+a.pagedItems[a.currentPage-1].length-1}catch(a){return 0}},a.stateImgUrl=function(a){return c.stateImgUrl(a)},a.removeRoles=function(d){g.confirmDialog("Remove permissions from user "+d.userID+" for "+a.application.label+"?","Remove Permissions",function(){b.deleteRoleForApplication({appName:a.application.label,userID:d.userID}).$promise.then(function(){a.users=$.grep(a.users,function(a){return a.userID!==d.userID}),a.reverseSort=!a.reverseSort,a.sortBy(a.orderByField,!1),c.trackEvent("deleteRolesSuccess",{key:"dialog_name",value:"deleteRolesForApplicationFromUser"},{key:"application_name",value:a.application.label},{key:"item_id",value:d.userID},{key:"item_role",value:"ALL_ROLES"})},function(a){c.handleGlobalError(a,"The role could not be deleted for the user.")})})},a.openUserModal=function(b){var d=e.open({templateUrl:"views/AddUserModal.html",controller:"AddUserModalCtrl",windowClass:"larger-dialog",backdrop:"static",resolve:{user:function(){if(b)return b},isEditingPermissions:function(){return void 0!==b},application:function(){return a.application}}});return c.failIfTokenExpired(d),a.$on(f.notAuthenticated,function(){d.close()}),d.result.then(function(){a.loadUsers()}),!1}}]),angular.module("wasabi.controllers").controller("AddUserModalCtrl",["$scope","$uibModalInstance","AuthFactory","AuthzFactory","user","UtilitiesFactory","isEditingPermissions","application",function(a,b,c,d,e,f,g,h){a.data={userEmail:"",addWritePrivileges:!1,addAdminPrivileges:!1},a.user=e,a.applications=[],a.application=h,a.userValidated=!1,a.validating=!1,a.failedValidation=!1,a.userHasPrivilegesForAllApps=!1,a.isEditingPermissions=g,a.addUserFormSubmitted=!1,a.verifyFormNoValueError=!1,a.postSubmitError=null,a.stateImgUrl=function(a){return f.stateImgUrl(a)},a.capitalizeFirstLetter=function(a){return f.capitalizeFirstLetter(a)},a.getUsersPrivilegesForApplication=function(){var b=$.grep(a.applications,function(b){return b.label===a.application.label});b&&b.length&&(a.data.addWritePrivileges="READWRITE"===b[0].role||"ADMIN"===b[0].role,a.data.addAdminPrivileges="ADMIN"===b[0].role)},a.updateApplicationRoles=function(b){a.applications=f.updateApplicationRoles(b,a.getUsersPrivilegesForApplication),a.user.applications=a.applications},a.verifyUser=function(){return 0===a.data.userEmail.length?void(a.verifyFormNoValueError=!0):(a.verifyFormNoValueError=!1,a.validating=!0,a.failedValidation=!1,a.userValidated=!1,void c.checkValidUser({email:a.data.userEmail}).$promise.then(function(b){a.validating=!1,b&&(a.user={},a.user.userID=b.username?b.username:"",a.user.firstName=b.firstName?b.firstName:"",a.user.lastName=b.lastName?b.lastName:"",a.user.userEmail=b.userEmail?b.userEmail:"",a.userValidated=!0,a.updateApplicationRoles(a.user.userID))},function(){a.failedValidation=!0}))},a.isEditingPermissions&&(a.applications=a.user.applications,a.userValidated=!0,a.getUsersPrivilegesForApplication()),a.saveAddUser=function(){return a.isEditingPermissions||a.userValidated?void d.assignRole({roleList:[{applicationName:a.application.label,role:a.data.addAdminPrivileges?"ADMIN":a.data.addWritePrivileges?"READWRITE":"READONLY",userID:a.user.userID}]}).$promise.then(function(){b.close(),f.trackEvent("saveRolesSuccess",{key:"dialog_name",value:"addRoleForUserForApplicationDialog"},{key:"application_name",value:a.application.label},{key:"item_id",value:a.user.userID},{key:"item_role",value:a.data.addAdminPrivileges?"ADMIN":a.data.addWritePrivileges?"READWRITE":"READONLY"})},function(a){f.handleGlobalError(a,"The role could not be added."),"unauthenticated"===f.extractErrorFromResponse(a)&&b.close();
}):void b.close()},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("wasabi.controllers").controller("ApplicationsCtrl",["$scope","$filter","$http","ApplicationsFactory","AuthzFactory","$uibModal","UtilitiesFactory","$rootScope","StateFactory","DialogsFactory","AUTH_EVENTS",function(a,b,c,d,e,f,g,h,i,j,k){a.data={query:""},a.orderByField="label",a.reverseSort=!1,a.applications=[],a.loadApplications=function(){a.applications=g.getAdministeredApplications(),1===a.applications.length&&(a.application=a.applications[0],a.administeredApplications=a.applications)},g.hideHeading(!1),g.selectTopLevelTab("Applications"),a.capitalizeFirstLetter=function(a){return g.capitalizeFirstLetter(a)},a.sortBy=function(c,d){a.orderByField===c&&(a.reverseSort=!a.reverseSort),d&&(a.reverseSort=d),a.orderByField=c,""!==a.orderByField&&(a.applications=b("orderBy")(a.applications,a.orderByField,a.reverseSort))},a.loadApplications(),a.openApplicationModal=function(b){var c=f.open({templateUrl:"views/EditApplicationModal.html",controller:"EditApplicationModalCtrl",windowClass:"xx-dialog",backdrop:"static",resolve:{application:function(){if(b)return b},applications:function(){return a.applications}}});g.failIfTokenExpired(c),a.$on(k.notAuthenticated,function(){c.close()}),c.result.then(function(){})}}]),angular.module("wasabi.controllers").controller("AllApplicationsCtrl",["$scope","$filter","$http","ApplicationsFactory","AuthzFactory","$uibModal","UtilitiesFactory","$rootScope","StateFactory","DialogsFactory","AUTH_EVENTS","EmailFactory","Session","ConfigFactory",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){a.data={query:""},a.orderByField="applicationName",a.reverseSort=!1,a.applications=[],a.adminUsers="",a.loadApplications=function(){a.applications=d.query().$promise.then(function(b){b&&(a.applications=b)},function(a){g.handleGlobalError(a,"The list of applications could not be retrieved.")})},a.capitalizeFirstLetter=function(a){return g.capitalizeFirstLetter(a)},a.loadApplications(),a.selectApplication=function(a){j.confirmDialog("Do you want to send an email to the admins of the application "+a.applicationName+" requesting access?","Request Access",function(){var b=n.baseUrl().lastIndexOf("/",n.baseUrl().lastIndexOf("/",n.baseUrl().length-1)-1),c=n.baseUrl().substring(0,b+1)+"#/userAccess/",d=["For Read-only Access: "+c+m.userID+"/"+a.applicationName+"/READONLY","For Read/Write Access: "+c+m.userID+"/"+a.applicationName+"/READWRITE","For Admin Access: "+c+m.userID+"/"+a.applicationName+"/ADMIN"];l.sendEmail({appName:a.applicationName,userName:m.userID,emailLinks:d}).$promise.then(function(){g.trackEvent("saveItemSuccess",{key:"dialog_name",value:"allApplicationsSendEmail"},{key:"experiment_id",value:m.userID});var b="An access request email has been sent to the admins of application "+a.applicationName+".";j.alertDialog(b,"Email Sent",function(){})},function(a){g.handleGlobalError(a,"Your email could not be sent.")})},function(){},"Send Email","Cancel")}}]),angular.module("wasabi.controllers").controller("DialogModalCtrl",["$scope","$uibModalInstance","options","$timeout","$sce",function(a,b,c,d,e){a.header=c.header,a.description=c.description,a.descriptionWithHTML=e.trustAsHtml(c.descriptionWithHTML),a.showWithHTML=c.descriptionWithHTML&&c.descriptionWithHTML.length>0,a.okLabel="OK",c.okLabel&&(a.okLabel=c.okLabel),a.cancelLabel="Cancel",c.cancelLabel&&(a.cancelLabel=c.cancelLabel),a.showCancel=!1,c.showCancel&&(a.showCancel=c.showCancel),a.okCallback=null,c.okCallback&&(a.okCallback=c.okCallback),a.cancelCallback=null,c.cancelCallback&&(a.cancelCallback=c.cancelCallback),a.ok=function(){b.close(),a.okCallback&&"function"==typeof a.okCallback&&a.okCallback()},a.cancel=function(){b.close(),a.cancelCallback&&"function"==typeof a.cancelCallback&&d(a.cancelCallback,100)}}]),angular.module("wasabi.controllers").controller("PagesCtrl",["$scope","$filter","$http","ExperimentsFactory","$uibModal","ApplicationsFactory","DialogsFactory","UtilitiesFactory","$rootScope","ConfigFactory",function(a,b,c,d,e,f,g,h,i,j){a.pages=[],a.pagesData={groupPages:[],pageName:"",setPageNameFocus:0},a.loadPages=function(){a.experiment.id&&d.getPages({id:a.experiment.id}).$promise.then(function(b){a.pages=b,a.experiment.pages=b,a.initPages()},function(b){h.handleGlobalError(b,"The list of pages for your experiment could not be loaded."),a.modalInstance.close()})},a.loadGlobalPages=function(){var b=null;return a.experiment&&a.experiment.applicationName&&a.experiment.applicationName!==j.newApplicationNamePrompt?void f.getPages({appName:a.experiment.applicationName}).$promise.then(function(b){b.forEach(function(b){a.pagesData.groupPages.push(b.name)}),a.loadPages()}):void(b=i.$on("experiment_created",function(){a.loadGlobalPages(),b()}))},a.initPages=function(){a.pages&&a.pages.length>0&&a.pages.forEach(function(a){k(a.name)})},a.loadGlobalPages();var k=function(b){var c=$.inArray(b,a.pagesData.groupPages);c>-1&&a.pagesData.groupPages.splice(c,1)},l=function(){setTimeout(function(){a.pagesData.pageName="",a.pagesData.setPageNameFocus+=1},30)};a.doSavePages=function(b,c){var e=a.pages.slice(0);e.forEach(function(a){for(var b in a)a.hasOwnProperty(b)&&"name"!==b&&"allowNewAssignment"!==b&&delete a[b]}),d.savePages({id:a.experiment.id,pages:a.pages}).$promise.then(function(){h.trackEvent("saveItemSuccess",{key:"dialog_name",value:"addPage"},{key:"experiment_id",value:a.experiment.id}),h.displaySuccessWithCacheWarning("Page Changes Saved","Your page changes have been saved."),a.loadPages()},function(a){c&&c.call(this,b),h.handleGlobalError(a,"Your pages could not be saved.")})};var m=function(b){a.pages.push({name:b,allowNewAssignment:!0}),b&&b.length&&a.doSavePages(b,function(b){a.pages.forEach(function(c,d){c.name.toLowerCase()===b.toLowerCase()&&a.pages.splice(d,1)})})},n=function(b){b&&b.length&&a.pages.forEach(function(c,e){c.name.toLowerCase()===b.toLowerCase()&&(a.pages.splice(e,1),d.removePage({id:a.experiment.id,pageName:c.name}).$promise.then(function(){h.trackEvent("deleteItemSuccess",{key:"dialog_name",value:"deletePage"},{key:"experiment_id",value:a.experiment.id},{key:"item_id",value:c.name}),h.displaySuccessWithCacheWarning("Page Association Deleted","Your page change has been saved."),a.loadPages()},function(b){a.loadPages(),h.handleGlobalError(b,"Your page could not be removed.")}))})};a.updatePage=function(b){a.doSavePages(b.name,function(b){a.pages.forEach(function(a){a.name.toLowerCase()===b.toLowerCase()&&(a.allowNewAssignment=!a.allowNewAssignment)})})},a.selectPage=function(b,c){a.addingPage=!0;var d=c.item.label;a.addPageToList(d),a.$digest()},a.validateAndAddPage=function(b){var c=!1;a.pages.forEach(function(d){d.name.toLowerCase()===b.toLowerCase()&&(g.alertDialog("The page "+b+" has already been added.","Page Already Added",function(){a.pagesData.setPageNameFocus+=1}),c=!0)}),c||g.confirmDialog('Are you sure you want to create a new page named "'+b+'" for this application?',"New Page",function(){a.addPageToList(b)})},a.selectPageOnEnter=function(b){function c(){a.addPageToList(b)}return a.addingPage?(a.addingPage=!1,!1):($.inArray(b,a.pagesData.groupPages)<0?a.validateAndAddPage(b):$.inArray(b,a.pagesData.groupPages)>=0&&(c(),a.$digest()),!1)},a.addPageClick=function(){var b=$.trim(a.pagesData.pageName);return b.length?$.inArray(b,a.pagesData.groupPages)>-1?a.addPageToList(b):a.validateAndAddPage(b):g.alertDialog("Enter a page identifier in the adjoining field.","Page Is Required",function(){a.pagesData.setPageNameFocus+=1}),!1},a.removePage=function(a){g.confirmDialog('Are you sure that you want to remove the page, "'+a+'"?',"Remove Page",function(){n(a)})},a.addPageToList=function(a){m(a),l()}}]),angular.module("wasabi.controllers").controller("ApplicationCtrl",["$scope","$state","USER_ROLES","AUTH_EVENTS","AuthFactory","Session",function(a,b,c,d,e,f){a.userRoles=c,a.session=f,a.isAuthenticated=e.isAuthenticated,a.isAuthorized=e.isAuthorized,a.signOut=function(){e.signOut(),b.go("signin")}}]),angular.module("wasabi.controllers").controller("SignInCtrl",["$scope","$rootScope","$state","AuthFactory","AuthzFactory","AUTH_EVENTS","Session","UtilitiesFactory","$cookies","USER_ROLES","WasabiFactory","StateFactory","ConfigFactory",function(a,b,c,d,e,f,g,h,i,j,k,l,m){a.credentials={username:"",password:""},a.dontShowForm=!0,h.hideHeading(!0),a.handleOriginalPage=function(){var a=b.originalURI,d=a.split("/"),e={};switch(b.originalPage){case"userAccess":e={username:d[2],appname:d[3],access:d[4]};break;case"experiment":e={experimentId:d[2],readonly:d[3],openedFromModal:d[4]},history.pushState(null,null,"experiments");break;case"priorities":case"logs":e={appname:d[2]}}c.go(b.originalPage,e),delete b.originalPage},a.transitionToFirstPage=function(){b.$broadcast(f.loginSuccess),b.originalPage?a.handleOriginalPage():c.go("experiments")},a.signIn=function(c){a.loginFailed=!1,a.serverDown=!1;var e=JSON.stringify({username:"",password:""});"sso"!==m.authnType()&&(i.wasabiRememberMe=c.rememberMe?c.username:"",e=JSON.stringify({username:c.username,password:c.password})),sessionStorage.setItem("wasabiSession",e),d.signIn().$promise.then(function(b){localStorage.removeItem("wasabiLastSearch");var d="sso"===m.authnType()?b.access_token:c.username,e={userID:d,accessToken:b.access_token,tokenType:b.token_type};g.create(e),b.username=d,h.getPermissions(b,a.transitionToFirstPage)},function(c){c.data.error&&401!==c.data.error.code?(a.serverDown=!0,"sso"===m.authnType()&&(a.redirectUrl=m.noAuthRedirect())):"sso"===m.authnType()?window.location.href=m.noAuthRedirect():a.loginFailed=!0,b.$broadcast(f.loginFailed)})},"sso"===m.authnType()?a.signIn():a.dontShowForm=!1}]),angular.module("wasabi.controllers").controller("SignOutCtrl",["$scope","$rootScope","$state","AuthFactory","AUTH_EVENTS","Session","ConfigFactory",function(a,b,c,d,e,f,g){a.signOut=function(){"sso"===g.authnType()?(f.destroy(),window.location.href=g.ssoLogoutRedirect()):d.signOut().$promise.then(function(){f.destroy(),c.go("signin")},function(){a.loginFailed=!0,b.$broadcast(e.loginFailed),c.go("signin")})}}]),angular.module("wasabi.controllers").controller("FeedbackCtrl",["$scope","$rootScope","$state","$uibModal",function(a,b,c,d){a.openFeedbackModal=function(){d.open({templateUrl:"views/FeedbackModal.html",controller:"FeedbackModalCtrl",windowClass:"xx-dialog",backdrop:"static"})}}]),angular.module("wasabi.controllers").controller("FeedbackModalCtrl",["$scope","$uibModalInstance","FeedbackFactory","UtilitiesFactory",function(a,b,c,d){d.trackEvent("loadedDialog",{key:"dialog_name",value:"createOrEditFeedback"}),a.feedback={score:"",comments:"",contactOkay:!1},a.userInteractedWithScore=!1,a.closeFunction=b.close,a.sendFeedback=function(){return a.userInteractedWithScore||0!==$.trim(a.feedback.comments).length||a.feedback.contactOkay?(a.feedback.contactOkay||delete a.feedback.contactOkay,$.trim(a.feedback.comments).length<=0&&delete a.feedback.comments,a.userInteractedWithScore||(a.feedback.score="6",a.feedback.comments||(a.feedback.comments=""),a.feedback.comments+=" [[NOTE: Score defaulted to 6 due to bug]]"),void c.sendFeedback(a.feedback).$promise.then(function(){d.trackEvent("saveItemSuccess",{key:"dialog_name",value:"feedback"})},function(a){console.log(a)})):(b.close(),!1)},a.cancel=function(){}}]),angular.module("wasabi.controllers").controller("BucketAssignmentModalCtrl",["$scope","$filter","$uibModalInstance","BucketsFactory","buckets","experiment","UtilitiesFactory","$uibModal","ConfigFactory",function(a,b,c,d,e,f,g,h,i){a.buckets=e,a.experiment=f,a.changesMade=!1,a.allocationsUpdated=!1,a.bucketTotalsValid=!1,a.help=i.help,a.changedAllocation=function(){a.changesMade=!0,a.allocationsUpdated=!1},a.loadBuckets=function(){d.query({experimentId:a.experiment.id}).$promise.then(function(b){a.buckets=b},function(a){g.handleGlobalError(a,"Your buckets could not be loaded.")})},a.balanceBuckets=function(){g.balanceBuckets(a.buckets,a.experiment,function(){g.displaySuccessWithCacheWarning("Bucket Allocations Balanced","Your bucket allocation percentages have been balanced.")})},a.totalBucketAllocation=function(){return g.totalBucketAllocation(a)},a.getBucket=function(a,b){return g.getBucket(a,b)},a.bucketReadOnly=function(a){return"CLOSED"===a.state||"EMPTY"===a.state},a.numActiveBuckets=function(){var b=0;return a.buckets.forEach(function(a){"CLOSED"!==a.state&&"EMPTY"!==a.state&&b++}),b},a.openBucketModal=function(b,c){var e=!0;if(!c||!a.getBucket(c,b)||"CLOSED"!==a.getBucket(c,b).state&&"EMPTY"!==a.getBucket(c,b).state){c&&(e=!1);var f=h.open({templateUrl:"views/BucketModal.html",controller:"BucketModalCtrl",windowClass:"xxx-dialog",backdrop:"static",resolve:{bucket:function(){return c?d.show({experimentId:b.id,bucketLabel:c}):[]},buckets:function(){return[]},isCreateBucket:function(){return!c},isEditInDetails:function(){return!e},isNoControl:function(){return!0},bucketStatistics:function(){return{}},experimentId:function(){return b.id},readOnly:function(){return!1}}});g.failIfTokenExpired(f),f.result.then(function(){g.displaySuccessWithCacheWarning(e?"Bucket Created":"Bucket Updated","Your bucket has been saved."),a.changesMade=!1,a.allocationsUpdated=!0,a.loadBuckets()})}},a.closeBucket=function(b){h.open({templateUrl:"views/CloseBucketConfirmModal.html",controller:"CloseBucketConfirmModalCtrl",windowClass:"xxx-dialog",resolve:{bucketLabel:function(){return b}}}).result.then(function(){d.close({label:b,experimentId:a.experiment.id}).$promise.then(function(){g.trackEvent("closeBucketSuccess",{key:"dialog_name",value:"closeBucketExperimentDetails"},{key:"experiment_id",value:a.experiment.id},{key:"item_label",value:b}),g.displaySuccessWithCacheWarning("Bucket Closed","Your bucket has been closed."),a.changesMade=!1,a.allocationsUpdated=!0,a.loadBuckets()},function(a){g.handleGlobalError(a,"Your bucket could not be closed.")})},function(){})},a.emptyBucket=function(b){h.open({templateUrl:"views/EmptyBucketConfirmModal.html",controller:"EmptyBucketConfirmModalCtrl",windowClass:"xxx-dialog",resolve:{bucketLabel:function(){return b}}}).result.then(function(){d.empty({label:b,experimentId:a.experiment.id}).$promise.then(function(){g.trackEvent("emptyBucketSuccess",{key:"dialog_name",value:"emptyBucketExperimentDetails"},{key:"experiment_id",value:a.experiment.id},{key:"item_label",value:b}),g.displaySuccessWithCacheWarning("Bucket Emptied","Your bucket has been emptied."),a.changesMade=!1,a.allocationsUpdated=!0,a.loadBuckets()},function(a){g.handleGlobalError(a,"Your bucket could not be emptied.")})},function(){})},a.saveBucketAssignment=function(){for(var b=[],e=0,h=0;h<a.buckets.length;h++){if("CLOSED"!==a.buckets[h].state&&"EMPTY"!==a.buckets[h].state&&(!a.buckets[h].allocationPercent||a.buckets[h].allocationPercent<=0))return void g.displayPageError("Allocation Error","No bucket can have an empty or zero allocation.",!0);a.buckets[h].allocationPercent=Math.round(1e4*a.buckets[h].allocationPercent)/1e4,b.push({label:a.buckets[h].label,allocationPercent:a.buckets[h].allocationPercent}),e+=1e4*a.buckets[h].allocationPercent}return 1e4!==e?void g.displayPageError("Allocation Error","The total of the allocation percentages for all of the buckets must be 100%.",!0):void(b.length?d.updateList({experimentId:f.id,buckets:b}).$promise.then(function(){g.trackEvent("saveItemSuccess",{key:"dialog_name",value:"updateBucketAssignments"},{key:"experiment_id",value:f.id}),g.displaySuccessWithCacheWarning("Buckets Updated","Your bucket allocation changes have been saved."),c.close()},function(a){"unauthenticated"===g.extractErrorFromResponse(a)?c.close():g.handleGlobalError(a)}):c.close())},a.cancel=function(){c.close("cancel")}}]),angular.module("wasabi.controllers").controller("SegmentationTestModalCtrl",["$scope","$filter","$uibModalInstance","ApplicationsFactory","experiment","rules","UtilitiesFactory","$uibModal","ConfigFactory","DialogsFactory",function(a,b,c,d,e,f,g,h,i,j){if(a.experiment=e,a.rules=f,a.help=i.help,a.ruleElements=[],a.rules&&a.rules.length>0)for(var k=0;k<f.length;k++)if(0!==f[k].subject.length&&0!==f[k].value.length){for(var l=!1,m=0;m<a.ruleElements.length;m++)if(a.ruleElements[m].name===f[k].subject){l=!0;break}l||a.ruleElements.push({name:f[k].subject,type:f[k].type,value:""})}a.doSegmentationTest=function(){function b(){return!1}for(var e={profile:{}},f=null,h=0;h<a.ruleElements.length;h++){var i=a.ruleElements[h];if(0!==i.name.length&&(0!==i.value.length||"string"===i.type))if("number"===i.type){if(f=parseInt(a.ruleElements[h].value),isNaN(f))return void j.alertDialog("The value for the profile parameter, "+a.ruleElements[h].name+", must be a number.","Invalid Number Value",b);e.profile[a.ruleElements[h].name]=f}else if("boolean"===i.type){if(f=$.trim(a.ruleElements[h].value).toLowerCase(),"true"!==f&&"false"!==f)return void j.alertDialog("The value for the profile parameter, "+a.ruleElements[h].name+", must be true or false.","Invalid Boolean Value",b);e.profile[a.ruleElements[h].name]="string"==typeof f&&"true"===f||"boolean"==typeof f&&f}else e.profile[a.ruleElements[h].name]=$.trim(a.ruleElements[h].value)}e.appName=a.experiment.applicationName,e.expName=a.experiment.label,a.ruleElements.length?d.testRule(e).$promise.then(function(b){if(g.trackEvent("saveItemSuccess",{key:"dialog_name",value:"testSegmentationRule"},{key:"experiment_id",value:a.experiment.id}),b&&void 0!==b.result){var c=b.result?"The segmentation rule PASSES for these profile inputs.":"The segmentation rule FAILS for these profile inputs.";j.alertDialog(c,"Rule Test",function(){})}},function(a){g.handleGlobalError(a)}):c.close()},a.cancel=function(){c.close("cancel")}}]),angular.module("wasabi.controllers").controller("FeedbackTableCtrl",["$scope","$filter","$http","FeedbackFactory","$uibModal","UtilitiesFactory","DialogsFactory",function(a,b,c,d,e,f,g){a.feedbacks=[],a.loadFeedbacks=function(){a.feedbacks=d.getFeedback()},f.hideHeading(!1),f.selectTopLevelTab("Tools"),a.capitalizeFirstLetter=function(a){return f.capitalizeFirstLetter(a)},a.loadFeedbacks(),a.openFeedbackCommentsModal=function(a){g.alertDialog(a.comments,"Comments",function(){})}}]),angular.module("wasabi.controllers").controller("GetAssignmentsModalCtrl",["$scope","$uibModalInstance","experiment","DialogsFactory","UtilitiesFactory","ConfigFactory",function(a,b,c,d,e,f){a.data={fromDate:moment().subtract(1,"days").format("ddd MMM DD YYYY HH:mm:ss ZZ"),toDate:moment().format("ddd MMM DD YYYY HH:mm:ss ZZ"),timeZone:"PST"},a.possibleTimeZones=["PST","UTC"],a.experiment=c,a.getAssignmentsFormSubmitted=!1,a.downloadBaseUrl=f.downloadBaseUrl()+"/experiments/"+a.experiment.id+"/assignments",a.ok=function(c){if(c)a.getAssignmentsFormSubmitted=!0;else if(moment(a.data.toDate,["YYYY-MM-DDTHH:mm:ssZ","ddd MMM DD YYYY HH:mm:ss ZZ"]).isBefore(moment(a.data.fromDate,["YYYY-MM-DDTHH:mm:ssZ","ddd MMM DD YYYY HH:mm:ss ZZ"])))d.alertDialog("The To date must be after the From date.","Date Error",function(){});else{var e=a.downloadBaseUrl+"?fromDate="+moment(a.data.fromDate,["YYYY-MM-DDTHH:mm:ssZ","ddd MMM DD YYYY HH:mm:ss ZZ"]).format("YYYY-MM-DD HH:mm:ss")+"&toDate="+moment(a.data.toDate,["YYYY-MM-DDTHH:mm:ssZ","ddd MMM DD YYYY HH:mm:ss ZZ"]).format("YYYY-MM-DD HH:mm:ss")+"&timeZone="+a.data.timeZone;location.href=e,b.close(a.experiment)}},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("wasabi.controllers").controller("AdminListModalCtrl",["$scope","$filter","$uibModalInstance","applicationName","UtilitiesFactory","AuthzFactory",function(a,b,c,d,e,f){a.applicationName=d,a.admins="",a.listTitle="No Access For Application "+d,a.loadAdmins=function(){f.getUsersForApplication({appName:a.applicationName}).$promise.then(function(b){a.admins="";for(var c=0;c<b.length;c++)"admin"===b[c].role.toLowerCase()&&(a.admins+=b[c].firstName+" "+b[c].lastName+" <"+b[c].userEmail+">\n")},function(a){e.handleGlobalError(a,"The users for the application could not be retrieved.")})},a.loadAdmins(),a.cancel=function(){c.dismiss("cancel")}}]),angular.module("wasabi.controllers").controller("APICallsCtrl",["$scope","$uibModal","ConfigFactory",function(a,b,c){a.hostUrl=c.baseUrl(),a.showCode=function(c){var d=b.open({templateUrl:"views/DisplaySourceCodeModal.html",controller:"DisplaySourceCodeModalCtrl",windowClass:"xxx-dialog",backdrop:"static",resolve:{codeURL:function(){return c},experiment:function(){return a.experiment},pageName:a.firstPageEncoded}});d.result.then(function(){})}}]),angular.module("wasabi.controllers").controller("ChangeRapidExperimentCtrl",["$scope","$uibModalInstance","experiment",function(a,b,c){a.experiment=c,a.formChangeRapidExperimentSubmitted=!1,a.ok=function(c,d){return 0===d.maxRapidUsers.$viewValue.length?(d.maxRapidUsers.$setValidity("min",!1),a.formChangeRapidExperimentSubmitted=!0,!1):void(c?a.formChangeRapidExperimentSubmitted=!0:b.close(a.experiment))},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("wasabi.controllers").controller("LogsCtrl",["$scope","$filter","$http","$stateParams","$timeout","LogsFactory","$uibModal","UtilitiesFactory","$rootScope","DialogsFactory","AUTH_EVENTS","$state","PERMISSIONS","ConfigFactory","$cookies",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){a.data={query:"",applicationName:""},a.logs=[],a.appNames=[],a.applicationName=d.appname,a.currentPage=1,a.totalItems=0,a.itemsPerPage=10,a.orderByField="time",a.reverseSort=!0,a.help=n.help,h.hideHeading(!1),h.selectTopLevelTab("Tools"),a.changePage=function(b){void 0!==b&&(a.data.applicationName=b),a.data.applicationName&&a.data.applicationName===d.appname||(o.wasabiDefaultApplication=a.data.applicationName,l.go("logs",{appname:a.data.applicationName}))},a.pageRangeStart=function(){try{return 1===a.currentPage?0===a.totalItems?0:1:(a.currentPage-1)*a.itemsPerPage+1}catch(a){return 0}},a.pageRangeEnd=function(){try{var b=0+a.pageRangeStart(),c=a.totalItems>b+a.itemsPerPage?b+a.itemsPerPage-1:a.totalItems;return c}catch(a){return 0}},a.onSelectAppName=function(b){if(b){a.applicationName=o.wasabiDefaultApplication=b;var c={applicationName:b,page:a.currentPage,sort:(a.reverseSort?"-":"")+a.orderByField.replace("_","."),filter:a.data.query};h.startSpin(),f.query(c).$promise.then(function(c){a.logs=c.logEntries,a.totalItems=c.totalEntries,h.doTrackingInit(),h.trackEvent("loadedDialog",{key:"dialog_name",value:"logsList"},{key:"application_name",value:b})},function(a){h.handleGlobalError(a,"The list of logs could not be retrieved.")}).finally(function(){h.stopSpin()})}},a.init=function(){for(var b=h.getAdministeredApplications(),c=0;c<b.length;c++)a.appNames.push(b[c].label);1===a.appNames.length&&a.changePage(a.appNames[0])},a.init(),!a.applicationName&&o.wasabiDefaultApplication&&(a.applicationName=o.wasabiDefaultApplication),a.data.applicationName=a.applicationName,a.data.applicationName&&a.changePage(),a.$watch(function(){return a.appNames.length},function(){0!==a.appNames.length&&a.$evalAsync(function(){for(var b=0,c=!1,d=0;d<a.appNames.length;d++)a.appNames[d]===a.applicationName&&(c=!0,b=d+1);c?($("#applicationNameChoice").prop("selectedIndex",b),a.onSelectAppName(a.applicationName)):(o.wasabiDefaultApplication="",a.data.applicationName="")})}),a.capitalizeFirstLetter=function(a){return h.capitalizeFirstLetter(a)},a.openLogModal=function(a){var b=g.open({templateUrl:"views/LogModal.html",controller:"LogModalCtrl",windowClass:"xxx-dialog",backdrop:"static",resolve:{log:function(){return a}}});h.failIfTokenExpired(b),b.result.then(function(){})},a.pageChanged=function(){a.onSelectAppName(a.applicationName)},a.sortBy=function(b){a.orderByField===b?a.reverseSort=!a.reverseSort:a.reverseSort=!0,a.orderByField=b,""!==a.orderByField&&a.onSelectAppName(a.applicationName)},a.clearSearch=function(){a.data.query="",a.onSelectAppName(a.applicationName)},a.doSearch=function(){a.onSelectAppName(a.applicationName)},a.search=function(){$.trim(a.data.query).length>0&&a.data.applicationName.length>0&&(a.searchTimer&&e.cancel(a.searchTimer),a.searchTimer=e(a.doSearch,400))}}]),angular.module("wasabi.controllers").controller("LogModalCtrl",["$scope","$uibModalInstance","log","UtilitiesFactory",function(a,b,c,d){a.log=c,a.capitalizeFirstLetter=function(a){return d.capitalizeFirstLetter(a)},a.stateName=function(a){return d.stateName(a)},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("wasabi.controllers").controller("ResultsModalCtrl",["$scope","$filter","$uibModalInstance","ExperimentsFactory","experiment","readOnly","UtilitiesFactory","$uibModal","ConfigFactory",function(a,b,c,d,e,f,g,h,i){a.experiment=e,a.originalResults=a.experiment.results,a.originalHypothesisCorrect=null===a.experiment.hypothesisIsCorrect?"":a.experiment.hypothesisIsCorrect,a.tmpResults=a.originalResults,a.tmpHypothesisCorrect=a.originalHypothesisCorrect,a.help=i.help,a.readOnly=f,a.doSaveResults=function(){a.originalResults===a.tmpResults&&a.originalHypothesisCorrect===a.tmpHypothesisCorrect||(a.experiment.results=a.tmpResults,a.experiment.hypothesisIsCorrect=a.tmpHypothesisCorrect,d.update({id:a.experiment.id,results:a.experiment.results,hypothesisIsCorrect:a.experiment.hypothesisIsCorrect}).$promise.then(function(){g.trackEvent("updateItemSuccess",{key:"dialog_name",value:"updateExperimentResults"},{key:"experiment_id",value:a.experiment.id},{key:"item_value",value:a.experiment.results+"|"+a.experiment.hypothesisIsCorrect})},function(a){g.handleGlobalError(a,"Your experiment results could not be changed.")})),c.close()},a.cancel=function(){c.close("cancel")}}]),angular.module("wasabi.controllers").controller("AnalysisGraphModalCtrl",["$scope","$filter","$uibModalInstance","experiment","UtilitiesFactory","$uibModal","ConfigFactory","ExperimentStatisticsFactory",function(a,b,c,d,e,f,g,h){a.experiment=d,a.help=g.help,a.actionRate=function(a,b){return e.actionRate(a,b)},a.actionDiff=function(a,b){return e.actionDiff(a,b)},a.improvement=function(b){return e.improvement(b,a.experiment)},a.improvementDiff=function(b){return e.improvementDiff(b,a.experiment)},a.loadDailies=function(){var b={experimentId:a.experiment.id,fromTime:a.experiment.startTime,toTime:moment().format("YYYY-MM-DDTHH:mm:ss")+"Z"};h.dailiesWithRange(b).$promise.then(function(b){a.dailies=b},function(a){e.handleGlobalError(a,"Your dailies could not be retrieved.")})},a.loadDailies(),a.cancel=function(){c.close("cancel")}}]),angular.module("wasabi.controllers").controller("UserCtrl",["$scope","$http","UtilitiesFactory","$stateParams","AuthzFactory",function(a,b,c,d,e){a.user=d.username,a.access=d.access,a.appname=d.appname,c.hideHeading(!1),c.deselectAllTabs(),a.grantUserAccess=function(){a.user&&a.user.length>0&&a.access&&a.access.length>0&&a.appname&&a.appname.length>0&&e.assignRole({roleList:[{applicationName:a.appname,role:a.access,userID:a.user}]}).$promise.then(function(){c.trackEvent("saveUserAccessSuccess",{key:"dialog_name",value:"userPage"},{key:"application_name",value:a.appname},{key:"item_id",value:a.user},{key:"item_role",value:a.access})},function(a){c.handleGlobalError(a,"The user access could not be added.")})},a.grantUserAccess()}]),angular.module("wasabi.controllers").controller("PluginsCtrl",["$scope","$filter","$http","ApplicationsFactory","AuthzFactory","$uibModal","UtilitiesFactory","$rootScope","StateFactory","DialogsFactory","AUTH_EVENTS",function(a,b,c,d,e,f,g,h){a.plugins=h.plugins,g.hideHeading(!1),g.selectTopLevelTab("Plugins"),a.openPluginModal=function(a){g.openPluginModal(a)}}]),angular.module("wasabi.controllers").controller("PageManagementCtrl",["$scope","$filter","$http","$stateParams","$timeout","$cookies","PagesFactory","ApplicationsFactory","DialogsFactory","ExperimentsFactory","$uibModal","UtilitiesFactory","$rootScope","AUTH_EVENTS","$state","PERMISSIONS","ConfigFactory",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){a.data={query:"",applicationName:"",selectedPage:"",selectedExperiments:[]},a.appNames=[],a.pages=[],a.experiments=[],a.allExperiments=[],a.applicationName=d.appname,a.currentPage=1,a.totalItems=0,a.itemsPerPage=10,a.orderByField="time",a.reverseSort=!0,a.help=q.help,l.hideHeading(!1),l.selectTopLevelTab("Tools"),a.changePage=function(){f.wasabiDefaultApplication=a.data.applicationName,o.go("pages",{appname:a.data.applicationName})},a.onSelectAppName=function(c){if(c){a.applicationName=f.wasabiDefaultApplication=c;var d={applicationName:c};g.query(d).$promise.then(function(d){a.pages=b("orderBy")(d,"name",!1),l.doTrackingInit(),l.trackEvent("loadedDialog",{key:"dialog_name",value:"pagesList"},{key:"application_name",value:c})},function(a){l.handleGlobalError(a,"The list of pages could not be retrieved.")}),h.getExperiments({appName:c}).$promise.then(function(b){a.allExperiments=b,l.doTrackingInit(),l.trackEvent("loadedDialog",{key:"dialog_name",value:"allExperimentsList"},{key:"application_name",value:c})},function(a){l.handleGlobalError(a,"The list of all experiments could not be retrieved.")})}},a.onSelectPage=function(){a.getExperiments(a.data.applicationName,a.data.selectedPage.name)},a.init=function(){for(var b=l.getAdministeredApplications(),c=0;c<b.length;c++)a.appNames.push(b[c].label);1===a.appNames.length&&a.onSelectAppName(a.appNames[0])},a.init(),!a.applicationName&&f.wasabiDefaultApplication&&(a.applicationName=f.wasabiDefaultApplication),a.data.applicationName=a.applicationName,a.$watch(function(){return a.appNames.length},function(){0!==a.appNames.length&&a.$evalAsync(function(){for(var b=0,c=0;c<a.appNames.length;c++)a.appNames[c]===a.applicationName&&(b=c+1);$("#applicationNameChoice").prop("selectedIndex",b),a.onSelectAppName(a.applicationName)})}),a.capitalizeFirstLetter=function(a){return l.capitalizeFirstLetter(a)},a.getExperiments=function(c,d){g.getExperimentsWithPage({applicationName:c,id:d}).$promise.then(function(d){a.experiments=b("orderBy")(d,"label",!1),l.doTrackingInit(),l.trackEvent("loadedDialog",{key:"dialog_name",value:"experimentsList"},{key:"application_name",value:c})},function(a){l.handleGlobalError(a,"The list of experiments could not be retrieved.")})},a.addExperimentToPage=function(){a.openAddToPageModal()},a.createNameList=function(a,b){return l.createNameList(a,b)},a.removeExperimentsFromPage=function(){function b(b,d){j.removePage({id:b.id,pageName:d}).$promise.then(function(){if(l.trackEvent("deleteItemSuccess",{key:"dialog_name",value:"deleteExperimentFromPage"},{key:"experiment_id",value:b.id},{key:"item_id",value:d}),c--,!c){var e="experiment",f="has been";a.data.selectedExperiments.length>1&&(e="experiments",f="have been");var g=a.createNameList(a.data.selectedExperiments,"label");l.displaySuccessWithCacheWarning("Experiments Removed","The "+e+", "+g+", "+f+" removed from the page, "+d+"."),a.onSelectPage()}},function(b){l.handleGlobalError(b,"Your experiment could not be removed from the page."),c--,c||a.onSelectPage()})}var c;if(a.data.selectedExperiments.length){var d="experiment";a.data.selectedExperiments.length>1&&(d="experiments");var e=a.createNameList(a.data.selectedExperiments,"label");i.confirmDialog("Are you sure you want to remove your "+d+", "+e+", from the page, "+a.data.selectedPage.name+"?","Remove Experiments",function(){c=a.data.selectedExperiments.length;for(var d=0;d<a.data.selectedExperiments.length;d++)b(a.data.selectedExperiments[d],a.data.selectedPage.name)},function(){},"Remove Experiments","Cancel")}},a.openAddToPageModal=function(){if(a.data.selectedPage){var b=k.open({templateUrl:"views/AddExperimentsToPageModal.html",controller:"AddExperimentsToPageModalCtrl",windowClass:"larger-dialog",backdrop:"static",size:"lg",resolve:{experiments:function(){return a.experiments},allExperiments:function(){return a.allExperiments},page:function(){return a.data.selectedPage}}});l.failIfTokenExpired(b),b.result.then(function(){a.onSelectPage()})}},a.pageChanged=function(){a.onSelectAppName(a.applicationName)},a.sortBy=function(b){a.orderByField===b?a.reverseSort=!a.reverseSort:a.reverseSort=!0,a.orderByField=b,
""!==a.orderByField&&a.onSelectAppName(a.applicationName)},a.clearSearch=function(){a.data.query="",a.onSelectAppName(a.applicationName)},a.doSearch=function(){a.onSelectAppName(a.applicationName)},a.search=function(){$.trim(a.data.query).length>0&&a.data.applicationName.length>0&&(a.searchTimer&&e.cancel(a.searchTimer),a.searchTimer=e(a.doSearch,400))}}]),angular.module("wasabi.controllers").controller("AddExperimentsToPageModalCtrl",["$scope","$filter","$uibModalInstance","PagesFactory","ExperimentsFactory","experiments","allExperiments","page","UtilitiesFactory",function(a,b,c,d,e,f,g,h,i){a.data={searchField:"",selectAll:!1},a.experiments=f,a.allExperiments=g,a.nonExpiredExperiments=g,a.selectedPage=h,a.addExperimentsToPageFormSubmitted=!1,a.orderByField="label",a.reverseSort=!1,a.filteredItems=[],a.postSubmitError=null,a.stateImgUrl=function(a){return i.stateImgUrl(a)},a.stateName=function(a){return i.stateName(a)},a.capitalizeFirstLetter=function(a){return i.capitalizeFirstLetter(a)},a.filterNonExpiredExperiments=function(){a.nonExpiredExperiments=i.filterNonExpiredExperiments(a.allExperiments)};var j=function(a,b){return!b||a.toLowerCase().indexOf(b.toLowerCase())!==-1};a.search=function(){a.filteredItems=b("filter")(a.nonExpiredExperiments,function(b){b.selected=!1;for(var c=0;c<a.experiments.length;c++)if(a.experiments[c].label===b.label)return!1;return!(!b.label||!j(b.label,a.data.searchField))||!(!b.description||!j(b.description,a.data.searchField))}),""!==a.orderByField&&(a.filteredItems=b("orderBy")(a.filteredItems,a.orderByField,a.reverseSort))},a.filterNonExpiredExperiments(),a.search(),a.selectAllNone=function(){a.filteredItems.forEach(function(b){b.selected=a.data.selectAll})},a.createNameList=function(a,b){return i.createNameList(a,b)},a.addExperimentsToPage=function(){function b(b,g){e.savePages({id:b.id,pages:[{name:g,allowNewAssignment:!0}]}).$promise.then(function(){if(i.trackEvent("saveItemSuccess",{key:"dialog_name",value:"addExperimentToPage"},{key:"experiment_id",value:b.id}),d--,!d){var e="experiment",h="has been";f.length>1&&(e="experiments",h="have been");var j=a.createNameList(f,"label");i.displaySuccessWithCacheWarning("Experiments Added","The "+e+", "+j+", "+h+" added to the page, "+g+"."),c.close()}},function(a){i.handleGlobalError(a,"Your experiment could not be added to that page."),d--,d||c.close()})}for(var d,f=[],g=0;g<a.allExperiments.length;g++)a.allExperiments[g].selected&&f.push(a.allExperiments[g]);if(d=f.length,f.length)for(var h=0;h<f.length;h++)b(f[h],a.selectedPage.name)},a.cancel=function(){c.dismiss("cancel")}}]),angular.module("wasabi.controllers").controller("SuperadminsTableCtrl",["$scope","$filter","$http","Session","SuperadminsFactory","$uibModal","UtilitiesFactory","DialogsFactory","AUTH_EVENTS",function(a,b,c,d,e,f,g,h,i){a.superadmins=[],a.loadSuperadmins=function(){a.superadmins=[],g.startSpin(),e.query().$promise.then(function(b){a.superadmins=b;for(var c=0;c<a.superadmins.length;c++)a.superadmins[c].doNotShow=d.userID===a.superadmins[c].userID},function(a){g.handleGlobalError(a,"The list of superadmins could not be retrieved.")}).finally(function(){g.stopSpin()})},g.hideHeading(!1),g.selectTopLevelTab("Tools"),a.capitalizeFirstLetter=function(a){return g.capitalizeFirstLetter(a)},a.removeSuperadmin=function(b){return a.superadmins.length<=1?void g.displayPageError("Last Superadmin","You may not remove the last superadmin from the system.",!0):void h.confirmDialog("Remove superadmin privileges for user, "+b.userID+"?","Remove Superadmin",function(){e.delete({id:b.userID}).$promise.then(function(){g.trackEvent("deleteItemSuccess",{key:"dialog_name",value:"deleteSuperadmin"},{key:"experiment_id",value:b.userID},{key:"item_id",value:b.userID}),a.loadSuperadmins()},function(a){g.handleGlobalError(a,"Attempting to remove a superadmin resulted in error.")})})},a.loadSuperadmins(),a.openAddSuperadminModal=function(){var b=f.open({templateUrl:"views/AddSuperadminModal.html",controller:"AddSuperadminModalCtrl",windowClass:"xxx-dialog",backdrop:"static"});g.failIfTokenExpired(b),a.$on(i.notAuthenticated,function(){b.close()}),b.result.then(function(){a.loadSuperadmins()})}}]),angular.module("wasabi.controllers").controller("AddSuperadminModalCtrl",["$scope","$uibModalInstance","AuthFactory","UtilitiesFactory","$rootScope","$uibModal","AUTH_EVENTS","SuperadminsFactory",function(a,b,c,d,e,f,g,h){d.trackEvent("loadedDialog",{key:"dialog_name",value:"addSuperadmin"}),a.data={superadminEmail:""},a.applications=[],a.superadmin=null,a.superadminFormSubmitted=!1,a.superadminValidated=!1,a.validating=!1,a.failedValidation=!1,a.postSubmitError=null,a.modalInstance=this._isTesting===!0?null:b,a.verifyFormNoValueError=!1,a.updateApplicationRoles=function(b){a.applications=d.updateApplicationRoles(b,null)},a.verifySuperadmin=function(){return 0===a.data.superadminEmail.length?void(a.verifyFormNoValueError=!0):(a.verifyFormNoValueError=!1,a.validating=!0,a.superadminValidated=!1,a.failedValidation=!1,void c.checkValidUser({email:a.data.superadminEmail}).$promise.then(function(b){a.validating=!1,b&&(a.superadmin={},a.superadmin.userID=b.username?b.username:"",a.superadmin.firstName=b.firstName?b.firstName:"",a.superadmin.lastName=b.lastName?b.lastName:"",a.superadmin.userEmail=b.email?b.email:"",a.superadminValidated=!0,a.updateApplicationRoles(a.superadmin.userID))},function(){a.failedValidation=!0}))},a.addSuperadmin=function(){h.create({id:a.superadmin.userID}).$promise.then(function(){d.trackEvent("createItemSuccess",{key:"dialog_name",value:"createSuperadmin"},{key:"experiment_id",value:a.superadmin.userID},{key:"item_id",value:a.superadmin.userID}),a.closeDialog()},function(b){d.handleGlobalError(b,"Attempting to add a superadmin resulted in error."),a.closeDialog()})},a.closeDialog=function(){b.close()}}]),angular.module("wasabi.controllers").controller("DisplaySourceCodeModalCtrl",["$scope","$filter","$uibModalInstance","codeURL","experiment","pageName","UtilitiesFactory","$uibModal","ConfigFactory",function(a,b,c,d,e,f,g,h,i){a.webServingUrl=window.location.protocol+"//"+window.location.host+"/",a.codeURL=a.webServingUrl+d,a.experiment=e,a.baseUrl=i.baseUrl(),a.pageName=f;var j=i.baseUrl().split("/");a.serverProtocol=j[0],a.serverHostAndPort=j[2],a.cancel=function(){c.close("cancel")}}]),angular.module("wasabi.directives").directive("convertPercent",function(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){function e(a){return isNaN(a)?a:parseFloat((a/100).toFixed(8))}function f(a){return isNaN(a)?a:parseFloat((100*a).toFixed(8))}d.$parsers.push(e),d.$formatters.push(f)}}}),angular.module("wasabi.directives").directive("customTooltip",["TooltipFactory","$timeout",function(a,b){return{restrict:"A",link:function(c,d,e){var f,g=null;d.on("mouseenter",function(){g&&b.cancel(g),f=a.createAndShowTooltip(e.customTooltip,this),g=b(function(){a.hideTooltip(f)},5e3)}).on("mouseleave",function(){a.hideTooltip(f)}).on("click",function(){a.hideTooltip(f)})}}}]),angular.module("wasabi.directives").directive("ensureNumber",[function(){return{require:"ngModel",link:function(a,b,c,d){a.$watch(c.ngModel,function(){d.$modelValue&&isNaN(d.$modelValue)?d.$setValidity("ensureNumber",!1):d.$setValidity("ensureNumber",!0),c.ensureNumberMax&&c.ensureNumberMax<d.$modelValue?d.$setValidity("ensureNumberTooBig",!1):d.$setValidity("ensureNumberTooBig",!0)})}}}]),angular.module("wasabi.directives").directive("ensureInterval",[function(){return{require:"ngModel",link:function(a,b,c,d){a.$watch(c.ngModel,function(){isNaN(d.$modelValue)?d.$setValidity("ensureInterval",!0):d.$modelValue>=1e-4&&d.$modelValue<=1?d.$setValidity("ensureInterval",!0):d.$setValidity("ensureInterval",!1)})}}}]),angular.module("wasabi.directives").directive("ensureStartGreaterEndTime",[function(){return{require:"ngModel",link:function(a,b,c,d){var e=function(){var b=moment(a.experiment.startTime,["YYYY-MM-DDTHH:mm:ssZ","ddd MMM DD YYYY HH:mm:ss ZZ"]),c=moment(a.experiment.endTime,["YYYY-MM-DDTHH:mm:ssZ","ddd MMM DD YYYY HH:mm:ss ZZ"]);a.experiment.startTime&&a.experiment.endTime&&b.isValid()&&c.isValid()?b.isBefore(c)?d.$setValidity("ensureStartGreaterEndTime",!0):($("#endTime").datepicker("hide"),d.$setValidity("ensureStartGreaterEndTime",!1)):d.$setValidity("ensureStartGreaterEndTime",!0)};a.$watch("experiment.startTime",e),a.$watch("experiment.endTime",e)}}}]),angular.module("wasabi.directives").directive("ensureFutureTime",[function(){return{require:"ngModel",link:function(a,b,c,d){a.$watch("experiment.startTime",function(){a.experiment.startTime&&moment(a.experiment.startTime,["YYYY-MM-DDTHH:mm:ssZ","ddd MMM DD YYYY HH:mm:ss ZZ"]).isValid()?moment(a.experiment.startTime,["YYYY-MM-DDTHH:mm:ssZ","ddd MMM DD YYYY HH:mm:ss ZZ"]).isAfter()?d.$setValidity("ensureFutureTime",!0):d.$setValidity("ensureFutureTime",!1):d.$setValidity("ensureFutureTime",!0)})}}}]),angular.module("wasabi.directives").directive("ensurePersonalizationModel",[function(){return{require:"ngModel",link:function(a,b,c,d){var e=function(){a.experiment.isPersonalizationEnabled?!a.experiment.modelName||$.trim(a.experiment.modelName).length<0||/^[_\-\$A-Za-z][_\-\$A-Za-z0-9]*$/.test(a.experiment.modelName)===!1?d.$setValidity("ensurePersonalizationModel",!1):d.$setValidity("ensurePersonalizationModel",!0):(a.experiment.modelName="",a.experiment.modelVersion="",d.$setValidity("ensurePersonalizationModel",!0))};a.$watch(function(){return d.$modelValue},e),"modelName"!==d.$modelValue&&a.$watch("experiment.modelName",e)}}}]),angular.module("wasabi.directives").directive("labelLink",["$compile",function(a){return{restrict:"E",link:function(b,c,d){if("DRAFT"===d.state.toUpperCase())if("true"===d.hasUpdate&&"true"!==d.readOnly){var e="openExperimentModal(experiment)";d.hasOwnProperty("openString")&&(e=d.openString),c.append('<a id="openExperiment" href="#" onclick="return false;" title="Edit '+d.expLabel+'" ng-click="'+e+'">'+d.expLabel+"</a>")}else c.append('<span title="'+d.expLabel+'">'+d.expLabel+"</span>");else if(d.openedFromModal&&("true"===d.openedFromModal||"true"!==d.hasUpdate&&"true"!==d.readOnly))c.append('<span title="'+d.expLabel+'">'+d.expLabel+"</span>");else{var f='<a href="#/experiments/'+d.expId+"/";f+=void 0!==d.inModal&&"true"===d.inModal?"true/true":("true"===d.readOnly.toLowerCase())+"/",f+='" title="Edit '+d.expLabel+'">'+d.expLabel+"</a>",c.append(f)}a(c.contents())(b)}}}]),angular.module("wasabi.directives").directive("labelLinkContent",["$compile",function(a){return{restrict:"E",transclude:!0,replace:!0,template:"<a ng-transclude></a>",link:function(b,c,d){b.customHref="#","DRAFT"!==d.state.toUpperCase()&&("true"!==d.hasUpdate&&"true"!==d.readOnly||(b.customHref="#/experiments/"+d.expId+"/"+("true"===d.readOnly.toLowerCase())+"/")),a(c.contents())(b)}}}]),angular.module("wasabi.directives").directive("ngFocus",[function(){var a="ng-focused";return{restrict:"A",require:"ngModel",link:function(b,c,d,e){e.$focused=!1,c.bind("focus",function(){b.$$phase||(c.addClass(a),b.$apply(function(){e.$focused=!0}))}).bind("blur",function(){c.removeClass(a),b.$$phase||b.$apply(function(){e.$focused=!1})})}}}]),angular.module("wasabi.directives").directive("search",function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){b=b.parent(),a.$watch(function(){return $.trim(b.find("input").val())},function(a){b.find("input").siblings(".clear").css("display",a&&a.length?"block":"none")}),b.click(function(){b.find("input").focus()}),b.find("input").keyup(function(){var a=b.find("input"),c=$.trim(a.val());a.siblings(".clear").css("display",c.length?"block":"none")}).focusin(function(){b.find("input").parent().addClass("inputFocus")}).focusout(function(){b.find("input").parent().removeClass("inputFocus")}),b.find(".clear").click(function(){return a.$apply(function(){d.$setViewValue("");var a=localStorage.getItem("wasabiLastSearch");a&&(a=JSON.parse(a),a.query="",localStorage.setItem("wasabiLastSearch",JSON.stringify(a)))}),b.find(".clear").hide().siblings("input").val("").focus(),!1})}}}),angular.module("wasabi.directives").directive("googleCharts",function(){return{require:"ngModel",link:function(a,b,c,d){a.$watch(c.ngModel,function(){var a=new Date,c=Date.UTC(a.getFullYear(),a.getMonth(),a.getDate());if(d.$modelValue){var e=d.$modelValue.days[0].perDay.buckets;if(e){var f=new google.visualization.DataTable,g=function(a){var b=a.split("-");return Date.UTC(b[0],b[1]-1,b[2])},h=function(a){var b=a.split("-");return new Date(b[0],b[1]-1,b[2])},i=function(a){var b=a.days,d=[],e=null,i=null;f.addColumn("date","Date");var j=0;for(e in b[0].cumulative.buckets)i=b[0].cumulative.buckets[e].label,d[j]=i,f.addColumn("number",i),f.addColumn({id:"i"+j++,type:"number",role:"interval"}),f.addColumn({id:"i"+j++,type:"number",role:"interval"});for(var k in b){if(g(b[k].date)>c)break;var l=[h(b[k].date)];for(e in b[k].cumulative.buckets){i=b[k].cumulative.buckets[e].label;var m=b[k].cumulative.buckets[e].jointActionRate.estimate,n=b[k].cumulative.buckets[e].jointActionRate.lowerBound||0,o=b[k].cumulative.buckets[e].jointActionRate.upperBound||0,p=0;isNaN(m)||null===m||void 0===m?(n=0,o=0):p=parseFloat((100*m).toFixed(3)),n<0&&(n=0),o>100&&(o=100),l.push(parseFloat((100*m).toFixed(3))),l.push(parseFloat((100*o).toFixed(3))),l.push(parseFloat((100*n).toFixed(3)))}f.addRow(l)}},j={title:"Performance Across Test Buckets",width:750,height:350,curveType:"function",series:[{color:"#F1CA3A"}],intervals:{style:"area"},legend:{position:"bottom"},vAxis:{title:"Cumulative Action Rate"}};i(d.$modelValue);var k=function(){var a=new google.visualization.ChartWrapper({chartType:"LineChart",dataTable:f,containerId:b.attr("id"),options:j});a.draw()};google.charts.setOnLoadCallback(k)}else b.append("No data for buckets")}})}}}),angular.module("wasabi.directives").directive("fadeInOut",[function(){return{link:function(a,b,c){a.$watch(c.fadeModelName,function(a,c){a!==c&&(b.fadeIn(800),setTimeout(function(){b.fadeOut(1500)},6e3))})}}}]),angular.module("wasabi.directives").directive("scrollTop",function(){return function(){window.scrollTo(0,0)}}),angular.module("wasabi.directives").directive("scrollableList",["$compile",function(a){function b(a){var b=a?"#"+a:".scrollList";$(b).each(function(){var a=$(this),b=a.find("table").eq(0),c=a.find(".scrollListHeader");c.length||(c=$('<div class="scrollListHeader"><table></table></div>').prependTo(a).find("table").append(b.find("tr").eq(0).clone()),b.wrap('<div class="scrollListBody"></div>'))})}return{restrict:"A",link:function(c,d,e){d.attr("class","scrollList"),a(d.contents())(c),b(e.id)}}}]),angular.module("wasabi.directives").directive("dragList",["$compile","PrioritiesFactory","MutualExclusionsFactory","UtilitiesFactory",function(a,b,c,d){function e(a){function e(){function b(){for(n.remove(),n=null,m.removeClass("moving"),g<m[0].rowIndex?m.insertAfter(p.eq(g-1)):m.insertAfter(p.eq(g)),p=$("#"+a).find("tr"),j(),c=m.closest("table").find("input.priorityInput"),g=c.length,f=0;f<g;f++)c.eq(f).val(f+1);z=!1,h(p)}var c,d,e,f,g,k,l=$(this),m=l.closest("tr"),o=m[0].offsetHeight,p=m.closest("table").find("tr"),q=$.trim(l.val());if(x=!1,y=!1,!z){if(!q||isNaN(q))return void l.val(m[0].rowIndex);if(z=!0,g=Math.max(parseInt(q),1),g=Math.min(g,p.length-1),i(m),m.addClass("moving"),e=g,"none"===p.eq(e).css("display")&&(d=e<m[0].rowIndex?p.eq(e).nextAll(":visible"):p.eq(e).prevAll(":visible"),e=d[0].rowIndex,e===m[0].rowIndex))return void b();k=p.eq(e).offset().top,$(window).scrollTop()>k-36?$("body, html").animate({scrollTop:k-36},400):$(window).scrollTop()+$(window).height()<k+o&&$("body, html").animate({scrollTop:k+o-$(window).height()},400),n.one("transitionend",b).css("transform","translate3d(-17px,"+(p.eq(e).offset().top-m.offset().top+3)+"px,0)")}}function f(a){function b(){var a,b,d,e=l.length;if(c=Math.max(c,v-15),c=Math.min(c,q),n.css("top",c),c===v-15?(b=1,a=1):c===q?(b=m.length-1,a=e-1):b=c<t?Math.floor((c-v)/u)+2:c>t+u?Math.floor((c-v)/u)+1:s,a||(a=m[b].rowIndex),a!==r){for(d=1;d<e;d++)d>=a&&d<k[0].rowIndex?l.eq(d).find("input.priorityInput").val(d+1):d>k[0].rowIndex&&d<=a?l.eq(d).find("input.priorityInput").val(d-1):l.eq(d).find("input.priorityInput").val(d);$("#dropArrow").stop().animate({top:m.eq(b).offset().top+(b>=s?u:0)},60,function(){$(this).css("display","block")}),$("#dropArrow").find("span").text(a),n.find("input.priorityInput").val(a),r=a}}if(x){clearInterval(w);var c=a.pageY+o,d=$(window),e=d.scrollTop(),f=(document.body.scrollHeight||document.documentElement.scrollHeight)-d.height();return y?(b(),c+60>d.height()+e&&e<f?w=setInterval(function(){e+=2,c+=2,e>f&&(clearInterval(w),e=f),d.scrollTop(e),b()},1):c-50<e&&e>0&&(w=setInterval(function(){e-=2,c-=2,e<0&&(clearInterval(w),e=0),d.scrollTop(e),b()},1)),!1):(Math.abs(a.pageY-p)>8&&(y=!0,i(k,c),k.addClass("moving"),$('<div id="dropArrow"><span>'+k[0].rowIndex+"</span></div>").css({left:k.offset().left-100,top:t+u}).appendTo($("body"))),!1)}}function g(){y=!1,clearInterval(w),k.find("input.priorityInput").val(r),r<k[0].rowIndex?k.insertAfter(l.eq(r-1)):k.insertAfter(l.eq(r)),l=$("#"+a).find("tr"),j(),n.css("box-shadow","none").animate({left:k.offset().left,top:k.offset().top},80,function(){n.remove(),n=null,$("#dropArrow").remove(),k.removeClass("moving")}),h(l)}function h(a){for(var c=[],e=1;e<a.length;e++)c.push(a.eq(e).data("id")+"");var f=a.eq(1).data("application-name");b.update({applicationName:f,experimentIDs:c}).$promise.then(function(){d.trackEvent("saveItemSuccess",{key:"dialog_name",value:"experimentsRePrioritized"},{key:"application_name",value:f}),d.displaySuccessWithCacheWarning("Experiment Priorities Changed","Your experiment priority changes have been saved.")},function(a){d.handleGlobalError(a,"Your experiment priorities could not be changed.")})}function i(a,b){var c,d,e=a.children(),f=e.length,g=a.offset().left+16,h=b||a.offset().top;for(n=$('<div id="dragRow" class="tableContainer"><table></table></div>').css({left:g,top:h}),n.find("table").append(a.clone()),d=n.find("td"),c=0;c<f;c++)d.eq(c).css("width",e.eq(c).width());n.appendTo($("body"))}function j(){var b,c=$("#"+a+" tr:visible"),d=c.length;for(b=1;b<d;b++)c.eq(b).css("background",b%2===0?"rgb(246,247,248)":"white")}var k,l,m,n,o,p,q,r,s,t,u,v,w,x=!1,y=!1,z=!1;$("#"+a).on("mousedown","tr",function(b){var e,f=$("#"+a);if(y)return void g();if(!z&&0!==this.rowIndex&&"A"!==b.target.nodeName&&(k=$(this),l=f.find("tr"),l.removeClass("hilite active"),k.addClass("active"),c.query({experimentId:k.data("id"),exclusiveFlag:!0}).$promise.then(function(a){for(var b=0;b<a.length;b++)for(var c=1;c<l.length;c++)l.eq(c).data("id")===a[b].id&&l.eq(c).addClass("hilite")},function(a){d.handleGlobalError(a,"The mutual exclusions could not be retrieved.")}),"INPUT"!==b.target.nodeName&&"true"!==f.attr("no-drag"))){for(x=!0,p=b.pageY,m=l.filter(":visible"),o=k.offset().top-p,r=this.rowIndex,s=r,e=1;e<r;e++)"none"===l.eq(e).css("display")&&--s;t=k.offset().top,u=k[0].offsetHeight,v=m.eq(1).offset().top,q=f.offset().top+f.height()-10}}).on("change","input.priorityInput",e),$(document).mousemove(f).mouseup(function(){x=!1,y&&g()})}return{restrict:"A",scope:!0,link:function(b,c,d){a(c.contents())(b),e(d.id)}}}]),angular.module("wasabi.directives").directive("datePicker",function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){b.datepicker({dateFormat:"m/d/yy"}).change(function(){}),d.$formatters.push(function(){var a=moment(d.$modelValue,["YYYY-MM-DDTHH:mm:ssZZ","ddd MMM DD YYYY HH:mm:ss ZZ"]);return a.format("M/D/YYYY")}),d.$parsers.push(function(){var a=new Date(d.$modelValue),b=moment(d.$viewValue,"MM/DD/YYYY");return b.isValid()?(d.$setValidity("time",!0),new Date(b.format("ddd MMM DD YYYY ")+moment(a).format("HH:mm:ss ZZ"))):(d.$setValidity("time",!1),$("#startTime").datepicker("hide"),new Date(moment(a).format("ddd MMM DD YYYY ")+moment(a).format("HH:mm:ss ZZ")))})}}}),angular.module("wasabi.directives").directive("abtestAutocomplete",function(){return{restrict:"A",scope:{listSource:"=list",selectFunction:"=selectFunction",enterFunction:"=enterFunction"},link:function(a,b){var c={source:a.listSource};a.selectFunction&&(c.select=a.selectFunction),b.autocomplete(c),a.enterFunction&&b.keydown(function(b){var c=$(this),d=$.trim(c.val());if(13===b.which)return a.enterFunction.call(this,d),!1}),a.$watch(function(){return a.listSource},function(a){b.autocomplete("option","source",a)})}}}),angular.module("wasabi.directives").directive("autoFocus",["$timeout",function(a){return{restrict:"AC",link:function(b,c){a(function(){c[0].disabled?$(c[0]).closest("ul").find("input")[1].focus():c[0].focus()},100)}}}]),angular.module("wasabi.directives").directive("noSpaces",function(){return{require:"ngModel",link:function(a,b,c,d){d.$parsers.push(function(a){if(!a)return a;var b=a.replace(/ /g,"");return b!==a&&(d.$setViewValue(b),d.$render()),b})}}}),angular.module("wasabi.directives").directive("digitOnly",function(){return{require:"ngModel",link:function(a,b,c,d){d.$parsers.push(function(a){if(a){var b=a.replace(/[^0-9\.]/g,"");return b!==a&&(d.$setViewValue(b),d.$render()),b}})}}}),angular.module("wasabi.directives").directive("rememberMe",["$cookies",function(a){return{restrict:"A",scope:!0,link:function(b,c){b.$watch(c,function(){var b=a.wasabiRememberMe;c.prop("checked",b&&b.length>0)}),b.$watch(b.$parent.credentials,function(b,c,d){d.credentials.username=a.wasabiRememberMe,a.wasabiRememberMe&&a.wasabiRememberMe.length>0&&(d.credentials.rememberMe=!0)}),c.on("click",function(){var b=$(this);b.is(":checked")||(a.wasabiRememberMe="")})}}}]),angular.module("wasabi.directives").directive("dynamicEdit",["UtilitiesFactory",function(a){return{restrict:"A",require:"ngModel",scope:{selectFunction:"=selectFunction",editFunction:"=editFunction",cancelFunction:"=cancelFunction"},link:function(b,c,d,e){c.dynamicEdit(),b.$watch(function(){return e.$modelValue},function(a){$("#"+b.inputTagId).text(null!==a?a:"")}),b.inputTagId=d.inputTag;var f;c.on("editStart",function(){return b.editFunction&&(f=b.editFunction()),!1}).on("editCancel",function(){return b.cancelFunction&&b.cancelFunction(f),!1}).on("editSave",function(){if($("#"+b.inputTagId).addClass("readOnly").removeAttr("contentEditable"),b.selectFunction){var c=a.convertValuesFromPre($("#"+b.inputTagId).html());b.selectFunction(c)}else $("#"+b.inputTagId).text("");return!1})}}}]),angular.module("wasabi.directives").directive("experimentProgress",function(){return{restrict:"A",link:function(a,b,c){function d(a){if(1===a)return"Finished";var b=c.progressDaysLeft,d="true"===c.progressIsAssignedUsers;return b<=1?d&&0===b?"0 users":d?"1 user":"1 day":b+(d?" users":" days")}var e=2*Math.PI,f=Math.PI/2,g=5;a.$watch(c.progressValueModel,function(a){if(void 0!==a){var h=$(b),i=1*a/100,j=h.find("canvas")[0],k=j.getContext("2d"),l=parseInt(j.getAttribute("width"))/2;i>1&&(i=1),i<.01&&(i=.01);var m='<span class="pct"'+(c.rollover&&c.rollover.length>0?' title="'+c.rollover+'"':"")+"></span>";h.find("span.pct").remove(),$(m).text(d(i)).appendTo(h),k.lineCap="square",k.lineWidth=g,k.strokeStyle="rgb(210,210,210)",k.beginPath(),k.arc(l,l,l-g/2,-f,1*e-f,!1),k.stroke(),k.strokeStyle="#2f9e1c",k.beginPath(),k.arc(l,l,l-g/2,-f,e*i-f,!1),k.stroke()}})}}}),angular.module("wasabi.directives").directive("favoritesStar",["UtilitiesFactory",function(a){return{restrict:"A",scope:{afterFavoriteFunc:"=afterFavoriteFunc",favoritesStarExperimentId:"=favoritesStarExperimentId",favoritesStarFavoritesObject:"=favoritesStarFavoritesObject"},link:function(b,c,d){var e=$(c).closest("li").eq(0).width()+10,f=d.favoritesStarParentTag?d.favoritesStarParentTag:"li";"string"==typeof d.isFavorite&&"true"===d.isFavorite||"boolean"==typeof d.isFavorite&&d.isFavorite?($(c).closest(f).toggleClass("favorite"),$(c).attr("title","Undo Mark as Favorite")):$(c).attr("title","Mark as Favorite"),$(c).on("click",function(){var c,d,g,h,i,j=$(this);if($(".tooltip").remove(),g=j.closest(f).toggleClass("favorite"),c=g.position().left,d=g.position().top,g.hasClass("favorite"))if(a.saveFavorite(b.favoritesStarExperimentId,b.favoritesStarFavoritesObject),void 0!==b.isFavoriteFlag&&(b.isFavoriteFlag=!0),j.attr("title","Undo Mark as Favorite"),b.afterFavoriteFunc)b.afterFavoriteFunc.call(this,g,e);else{if(0===g.index())return!1;i=$("#exprSummary>li:lt("+g.index()+")"),h=g.clone().css("visibility","hidden").insertBefore(g),g.css({left:c,top:d}).addClass("moving"),i.each(function(){this.offsetLeft>450?$(this).animate({left:2*-e,top:this.offsetHeight+16},500):$(this).animate({left:e},500)}),g.animate({left:0,top:0},500),$("#exprSummary>li").promise().done(function(){$(this).css({left:0,top:0}),g.prependTo($("#exprSummary")).removeClass("moving"),h.remove()}),$(document.body,document.documentElement).animate({scrollTop:0},500)}else if(a.removeFavorite(b.favoritesStarExperimentId,b.favoritesStarFavoritesObject),j.attr("title","Mark as Favorite"),b.afterFavoriteFunc)b.afterFavoriteFunc.call(this,g);else{if(i=$("#exprSummary>li:gt("+g.index()+")").filter(".favorite"),!i.length)return!1;h=g.clone().css("visibility","hidden").insertBefore(g),g.css({left:c,top:d}).addClass("moving"),c=i.last().position().left,d=i.last().position().top,i.each(function(){0===this.offsetLeft?$(this).animate({left:2*e,top:-this.offsetHeight-16},500):$(this).animate({left:-e},500)}),g.animate({left:c,top:d},500),$("#exprSummary>li").promise().done(function(){$(this).css({left:0,top:0}),g.insertAfter(i.last()).removeClass("moving"),h.remove()})}return!1})}}}]),angular.module("wasabi.directives").directive("validateRuleValue",["UtilitiesFactory",function(a){return{require:"ngModel",link:function(b,c,d,e){c.on("blur",function(){var b=$(this);if(e.$modelValue){var c=a.validateRuleChunk(e.$modelValue,b.attr("ruleType"));c.isValid||(e.$setValidity("validRuleValue",!1),b.parent().find(".segValidationError").removeClass("ng-hide").find(".fieldError").removeClass("ng-hide"))}else e.$setValidity("validRuleValue",!0),b.parent().find(".segValidationError").addClass("ng-hide").find(".fieldError").addClass("ng-hide")}).on("focus",function(){var a=$(this);e.$setValidity("validRuleValue",!0),a.parent().find(".segValidationError").addClass("ng-hide").find(".fieldError").addClass("ng-hide")}).on("click",function(){var a=$(this);e.$setValidity("validRuleValue",!0),a.parent().find(".segValidationError").addClass("ng-hide").find(".fieldError").addClass("ng-hide")})}}}]),angular.module("wasabi.directives").directive("npsWidget",[function(){return{restrict:"A",scope:!0,link:function(a,b){$(b).on("click","li",function(){$(this).addClass("sel").siblings().removeClass("sel"),a.$parent.feedback.score=$(this).text(),a.$parent.userInteractedWithScore=!0})}}}]),angular.module("wasabi.directives").directive("feedbackGuys",[function(){return{restrict:"A",scope:{saveFunction:"=saveFunction",closeFunction:"=closeFunction"},link:function(a){(function(){function b(){c&&c.length||(c=$("div.css3-guys"),d=$("#txtFeedbackComments"),e=$("div.css3-mouth"),f=$("#chkFeedback"),function(){var a;g=[],c.find("div.inner").each(function(b){var c,d,e=$(this),f={};b%2===0?a=e:(f.eye1={},f.eye2={},f.eye1.defaultPos={top:parseInt(a.css("top"),10),left:parseInt(a.css("left"),10)},f.eye2.defaultPos={top:parseInt(e.css("top"),10),left:parseInt(e.css("left"),10)},f.eye1.$el=a,f.eye2.$el=e,f.eye1.client=a.offset(),f.eye2.client=e.offset(),c={},d={},c.$el=a.find("div.sparkle"),d.$el=e.find("div.sparkle"),c.defaultPos={top:parseInt(d.$el.css("top"),10),left:parseInt(d.$el.css("left"),10)},f.eye1.sparkle=c,f.eye2.sparkle=d,g.push(f))})}(),$("#feedbackDialog").mouseenter(function(){c.addClass("active")}).mouseleave(function(){d.is(":focus")||f.is(":checked")||$("#nps .sel").length||$("body").hasClass("hurray")||c.removeClass("active")}).on("panelBeforeShow",function(){$("body").removeClass("hurray"),e.removeClass("smile1 smile2"),c.removeClass("active"),$("#chkFeedback").removeAttr("checked")}),d.mouseenter(function(){e.addClass("smile1")}).mouseleave(function(){$("#nps .sel").length||e.removeClass("smile1")}).focusin(function(){e.addClass("smile2")}).blur(function(){setTimeout(function(){f.is(":checked")||$("body").hasClass("hurray")||e.removeClass("smile2")},100)}),f.click(function(){this.checked?e.addClass("smile2"):e.removeClass("smile2")}),$("body").on("mousemove",function(a){$.each(g,function(b,c){var d=c.eye1,e=c.eye2;a.pageX<d.client.left?(d.$el.css({left:d.defaultPos.left-2}),e.$el.css({left:e.defaultPos.left-2})):a.pageX>e.client.left?(d.$el.css({left:d.defaultPos.left+5}),e.$el.css({left:e.defaultPos.left+5})):(d.$el.css({left:d.defaultPos.left}),e.$el.css({left:e.defaultPos.left})),a.pageY<d.$el.offset().top?(d.$el.css({top:d.defaultPos.top-2}),e.$el.css({top:e.defaultPos.top-2})):a.pageY>d.$el.offset().top?(d.$el.css({top:d.defaultPos.top+2}),e.$el.css({top:e.defaultPos.top+2})):(d.$el.css({top:d.defaultPos.top}),e.$el.css({top:e.defaultPos.top}))})}),$("#nps").click(function(){setTimeout(function(){$("#nps .sel").length&&e.addClass("smile1")},15)}),$("#btnFedbackSubmit").click(function(){e.addClass("smile2"),$("body").addClass("hurray"),a.saveFunction.call(),setTimeout(function(){a.closeFunction.call(),$("body").removeClass("hurray")},800)}),$("#btnFeedbackCancel").click(function(){return e.removeClass("smile1 smile2"),c.removeClass("active"),setTimeout(function(){a.closeFunction.call()},400),!1}))}var c,d,e,f,g=[];return{init:b}})().init()}}}]),angular.module("wasabi.directives").directive("help",function(){return{restrict:"A",link:function(a,b,c){b.click(function(){$("#help").hasClass("shown")?$("#help").removeClass("shown"):($("#helpContent").html(c.helpContent),$("#help").addClass("shown"))}),$("#help").click(function(){$("#help").removeClass("shown")})}}}),angular.module("wasabi.directives").directive("rememberState",["$cookies",function(a){return{restrict:"A",scope:!0,link:function(b,c,d){var e=d.stateName;b.$watch(c,function(){c.prop("checked",a[e]&&"true"===a[e])}),c.on("click",function(){var b=$(this);a[e]=b.is(":checked")})}}}]),angular.module("wasabi.directives").directive("roleCheckboxes",function(){return{restrict:"A",link:function(a,b,c){a.$watch(function(){return $(b).is(":checked")},function(a){a===!0&&($("#"+c.roleCheckboxes)[0].checked=!0)})}}}),angular.module("wasabi.directives").directive("whenScrollEnds",function(){return{restrict:"A",link:function(a,b,c){$(window).scroll(function(){$(b).is(":visible")&&$(window).scrollTop()+$(window).height()>=$(document).height()-400&&a.$apply(c.whenScrollEnds)})}}}),angular.module("wasabi.directives").directive("initDates",function(){return{restrict:"A",link:function(a,b){var c=moment().format("MM/DD/YYYY");b.val(c).datepicker({dateFormat:"m/d/yy"})}}}),angular.module("wasabi.directives").directive("switchSearch",function(){return{restrict:"A",link:function(a,b,c){var d=c.isAdvanced,e=function(a){a?($("#experimentsList").css("marginTop",40),$("#btnNewExperiment").css("top",33),$("#checkToggleListSpan").css("top",33),$("#searchMoreLess").attr("title","Fewer Search Options").removeClass("spinLeft").addClass("open spinRight")):($("#experimentsList").css("marginTop",""),$("#btnNewExperiment").css("top",0),$("#checkToggleListSpan").css("top",0),$("#searchMoreLess").attr("title","More Search Options").removeClass("spinRight open").addClass("spinLeft"))};a.$watch("data.showAdvancedSearch",function(a){"true"===d?(a?b.fadeIn(500):b.fadeOut(500),e(a)):(a?b.fadeOut(500):b.fadeIn(500),e(!a))})}}}),angular.module("wasabi.directives").directive("sortDirectionIcon",function(){return{restrict:"A",link:function(a,b){a.$watch(function(){return a.orderByField+"|"+a.reverseSort},function(c){var d=c.split("|");b.find("th i").each(function(){$(this).removeClass()});var e=d[0],f=e.replace(".","_");a.reverseSort?(b.find("th._"+f).removeClass("sortAscending").addClass("sortDescending"),b.find("th._"+f).siblings().removeClass("sortAscending sortDescending")):(b.find("th._"+f).removeClass("sortDescending").addClass("sortAscending"),
b.find("th._"+f).siblings().removeClass("sortAscending sortDescending"))})}}}),angular.module("wasabi.directives").directive("hideRowsReshade",function(){return{restrict:"A",link:function(a,b,c){var d=c.id;a.$watch("data.hidePaused",function(a){var b,c=$("#"+d+" tr"),e=c.length;for(b=1;b<e;b++)"Stopped"===c.eq(b).find("img").eq(0).attr("alt")&&c.eq(b).css("display",a?"none":"");for(c=$("#"+d+" tr:visible"),e=c.length,b=1;b<e;b++)c.eq(b).css("background",b%2===0?"rgb(246,247,248)":"white")})}}}),angular.module("wasabi.directives").directive("setFocus",function(){return{restrict:"A",link:function(a,b,c){a.$watch(c.watchElement,function(){b.focus()})}}}),angular.module("wasabi.directives").directive("colResizeable",function(){return{restrict:"A",link:function(a,b){a.$watch(function(){return b.is(":visible")},function(){b.is(":visible")&&b.colResizable({liveDrag:!1,gripInnerHtml:"<div class='grip'></div>",draggingClass:"dragging",minWidth:40,onDrag:function(){$(window).trigger("resize")}})})}}}),angular.module("wasabi.directives").directive("hoverPopup",function(){return{restrict:"A",scope:{hoverContentSource:"=hoverContentSource"},link:function(a,b){b.mouseenter(function(b){$("#hoverPopupContent").html(a.hoverContentSource);var c=$("#hoverPopup").css("width"),d=$("#hoverPopup").css("height");c=parseInt(c.substr(0,c.length-2)),d=parseInt(d.substr(0,d.length-2)),$("#hoverPopup").css("left",b.toElement.x-c).css("top",b.toElement.y-d).show()}).mouseleave(function(){$("#hoverPopup").hide()})}}});
//# sourceMappingURL=wasabi.js.map